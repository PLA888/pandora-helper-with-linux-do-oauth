(function(){"use strict";var t={5726:function(t,e,a){var s=a(2856),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},o=[],n={name:"App"},l=n,r=a(1656),c=(0,r.A)(l,i,o,!1,null,null,null),d=c.exports,u=a(184),h=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"login-container"},[e("h1",{staticStyle:{"margin-left":"10px"}},[t._v(" Panel "),e("span",{staticClass:"toggle-icon-container",on:{mouseenter:function(e){t.showExtraIcons=!0},mouseleave:function(e){t.showExtraIcons=!1}}},[e("img",{attrs:{src:a(8902),alt:"switch",loading:"lazy"},on:{click:function(e){return t.switchToIndex()}}}),e("transition",{attrs:{name:"fade"}},[t.showExtraIcons?e("div",{staticClass:"extra-icons"},[e("img",{attrs:{src:a(7343),alt:"Icon 2",loading:"lazy"},on:{click:function(e){return t.navigateTo("pandora")}}}),e("img",{attrs:{src:a(864),alt:"Icon 1",loading:"lazy"},on:{click:function(e){return t.navigateTo("claude")}}})]):t._e()])],1)]),e("form",{on:{submit:function(e){return e.preventDefault(),t.userlogin()}}},[e("input",{attrs:{type:"text",id:"username",placeholder:"用户名",required:""}}),e("input",{attrs:{type:"password",id:"password",placeholder:"密码",required:""}}),t._m(0)]),t._m(1),e("div",{staticClass:"alternative-login"},[e("div",{staticClass:"oauth-buttons"},[e("img",{attrs:{src:a(4832),alt:"LINUX DO",loading:"lazy"},on:{click:function(e){return t.initiateOAuth()}}})]),e("button",{attrs:{type:"button"},on:{click:function(e){return t.reset()}}},[t._v("重置密码")])]),e("div",{staticClass:"footer",on:{click:function(e){return t.index()}}},[e("a",{attrs:{href:"https://github.com/Kylsky/pandora-helper-with-linux-do-oauth",target:"_blank"}},[t._v("Powered by Yeelo")])])])])},p=[function(){var t=this,e=t._self._c;return e("button",{attrs:{type:"submit"}},[e("span",{staticClass:"btn-text"},[t._v("登录")]),e("span",{staticClass:"spinner"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"divider"},[e("span",[t._v("OR")])])}],m=a(7423);const g={apiBaseUrl:"",mjBaseUrl:"https://discord.com"},f=async()=>{try{const t=await m.A.get("/oauth2/config");console.log(t.data.apiUrl),g.mjBaseUrl=t.data.mjUrl||g.mjBaseUrl}catch(t){console.error("Error loading config:",t)}};var v=g,b=(a(4114),a(2457)),y=a.n(b);const w={success(t,e=3e3){(0,b.Message)({message:t,type:"success",duration:e,showClose:!0,customClass:"custom-message"})},error(t,e=3e3){(0,b.Message)({message:t,type:"error",duration:e,showClose:!0,customClass:"custom-message"})},warning(t,e=3e3){(0,b.Message)({message:t,type:"warning",duration:e,showClose:!0,customClass:"custom-message"})},info(t,e=3e3){(0,b.Message)({message:t,type:"info",duration:e,showClose:!0,customClass:"custom-message"})},handleResponse(t,e="操作成功"){return t.data.status?(this.success(e),!0):(this.error(t.data.message||"操作失败"),!1)},handleError(t){t.response?this.error(t.response.data.message||"请求失败"):t.request?this.error("网络连接失败，请检查网络"):this.error("请求配置错误")}};var C=w;const _=m.A.create({baseURL:{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_BASE_URL,headers:{"Content-Type":"application/json"},timeout:1e4});_.interceptors.response.use((t=>t),(t=>{const{response:e}=t;if(console.log(t),e){if(302===e.status){const t=e.headers["location"];t&&(window.location.href=t)}console.log(e.config.url),401===e.status&&e.config.url.startsWith(v.apiBaseUrl)?fe.push({path:"/"}):401===e.status&&C.error("您没有权限访问该功能")}return Promise.reject(t)}));var k=_,x={name:"IndexPage",props:{},data(){return{showExtraIcons:!1}},methods:{reset(){this.$router.replace({name:"reset"})},async userlogin(){const t=document.querySelector('button[type="submit"]');t.classList.add("loading");var e=document.getElementById("username").value,a=document.getElementById("password").value;try{const s=await k.post(`${v.apiBaseUrl}/user/login`,{username:e,password:a});this.loading=!1;const i=s.data.status;if(!i)return C.error(s.data.message),t.classList.remove("loading"),!1;const o=s.data,n=o.data.jwt,l=o.data.avatarUrl;localStorage.setItem("token",n),l&&localStorage.setItem("img",l),t.classList.remove("loading"),this.$router.replace({name:"navi"})}catch(i){t.classList.remove("loading");var s=s;C.error(s)}},async initiateOAuth(){try{const e=await k.get(`${v.apiBaseUrl}/oauth2/initiate?type=panel`);var t=e;console.log(t),t.data?window.location=t.data:console.error("No redirect URL provided")}catch(e){console.error("Request failed with status:",e)}},switchToIndex(){},navigateTo(t){this.$router.replace({name:t})}}},I=x,S=(0,r.A)(I,h,p,!1,null,"4204244c",null),A=S.exports,D=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"reset"}},[e("div",{staticClass:"reset-container"},[e("h1",[t._v("重置密码")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.resetPassword()}}},[t._m(0),e("div",{staticClass:"button-group"},[t._m(1),e("button",{staticClass:"home-button",attrs:{type:"button"},on:{click:function(e){return t.goHome()}}},[t._v("返回主页")])])]),t._m(2)])])},T=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"input-group"},[e("input",{attrs:{type:"text",id:"username",placeholder:"用户名",required:""}}),e("input",{attrs:{type:"password",id:"oldPassword",placeholder:"旧密码",required:""}}),e("input",{attrs:{type:"password",id:"newPassword",placeholder:"新密码",required:""}}),e("input",{attrs:{type:"password",id:"confirmPassword",placeholder:"再次确认新密码",required:""}})])},function(){var t=this,e=t._self._c;return e("button",{staticClass:"primary-button",attrs:{type:"submit"}},[e("span",{staticClass:"btn-text"},[t._v("重置")]),e("span",{staticClass:"spinner"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"footer"},[e("span",[t._v("Powered by Yeelo")])])}],P={name:"ResetPage",methods:{async resetPassword(){var t=document.getElementById("username").value,e=document.getElementById("oldPassword").value,a=document.getElementById("newPassword").value,s=document.getElementById("confirmPassword").value;if(e===a)return alert("新密码不能和旧密码相同，请重新输入。"),!1;if(a.length<8)return alert("密码长度必须超过大于等于8位，请重新输入。"),!1;if(a!==s)return alert("两次输入的密码不一致，请重新输入。"),!1;try{const i=await k.post(`${v.apiBaseUrl}/pandora/reset`,{username:t,oldPassword:e,newPassword:a,confirmPassword:s}),o=i.data.status;o?(alert("密码重置成功！"),this.$router.replace({name:"home"})):alert(i.data.message)}catch(i){alert(i)}},async goHome(){this.$router.replace({name:"home"})}}},E=P,z=(0,r.A)(E,D,T,!1,null,"43f6b99a",null),$=z.exports,M=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"pandora"}},[e("div",{staticClass:"login-container"},[e("h1",{staticStyle:{"margin-left":"10px"}},[t._v(" Pandora "),e("span",{staticClass:"toggle-icon-container",on:{mouseenter:function(e){t.showExtraIcons=!0},mouseleave:function(e){t.showExtraIcons=!1}}},[e("img",{attrs:{src:a(8902),alt:"switch",loading:"lazy"},on:{click:function(e){return t.switchToFuclaude()}}}),e("transition",{attrs:{name:"fade"}},[t.showExtraIcons?e("div",{staticClass:"extra-icons"},[e("img",{attrs:{src:a(7343),alt:"Icon 2",loading:"lazy"},on:{click:function(e){return t.navigateTo("pandora")}}}),e("img",{attrs:{src:a(864),alt:"Icon 1",loading:"lazy"},on:{click:function(e){return t.navigateTo("claude")}}})]):t._e()])],1)]),e("form",{on:{submit:function(e){return e.preventDefault(),t.userlogin()}}},[e("input",{attrs:{type:"text",id:"username",placeholder:"用户名",required:""}}),e("input",{attrs:{type:"password",id:"password",placeholder:"密码",required:""}}),t._m(0)]),t._m(1),e("div",{staticClass:"alternative-login"},[e("div",{staticClass:"oauth-buttons"},[e("img",{attrs:{src:a(4832),alt:"LINUX DO",loading:"lazy"},on:{click:function(e){return t.initiateOAuth()}}})]),e("button",{attrs:{type:"button"},on:{click:function(e){return t.reset()}}},[t._v("重置密码")])]),t._m(2)])])},B=[function(){var t=this,e=t._self._c;return e("button",{attrs:{type:"submit"}},[e("span",{staticClass:"btn-text"},[t._v("登录")]),e("span",{staticClass:"spinner"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"divider"},[e("span",[t._v("OR")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"footer"},[e("a",{attrs:{href:"https://github.com/Kylsky/pandora-helper-with-linux-do-oauth",target:"_blank"}},[t._v("Powered by Pandora")])])}],V={name:"PandoraPage",data(){return{showExtraIcons:!1}},methods:{reset(){this.$router.replace({name:"reset"})},async userlogin(){const t=document.querySelector('button[type="submit"]');t.classList.add("loading");var e=document.getElementById("username").value,a=document.getElementById("password").value;try{const i=await k.post(`${v.apiBaseUrl}/pandora/login`,{username:e,password:a}),o=i.data.status;if(o)t.classList.remove("loading"),window.open(i.data.data);else{var s=i.data.message;t.classList.remove("loading"),C.error(s)}}catch(i){t.classList.remove("loading"),C.error(i)}},async initiateOAuth(){try{const e=await k.get(`${v.apiBaseUrl}/oauth2/initiate?type=ChatGPT`);var t=e;t.data?window.location=t.data:console.error("No redirect URL provided")}catch(e){C.error(e)}},switchToFuclaude(){this.$router.replace({name:"home"})},navigateTo(t){this.$router.replace({name:t})}}},U=V,F=(0,r.A)(U,M,B,!1,null,"c71a0b6c",null),R=F.exports,L=function(){var t=this;t._self._c;return t._m(0)},q=[function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"loading"}},[e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loader-wrapper"},[e("div",{staticClass:"loader"}),e("div",{staticClass:"loader-inner"})]),e("p",{staticClass:"message"},[t._v("正在授权，请稍候...")]),e("p",{staticClass:"sub-message"},[t._v("Loading...")])])])}],O=(a(4603),a(7566),a(8721),{name:"LoadingPage",methods:{async fetchToken(t,e){console.log(t,e);const a=await k.get(`${v.apiBaseUrl}/oauth2/callback?code=${t}&state=${e}`,{withCredentials:!0});if(a.data.status){let t=JSON.parse(a.data.data);console.log(t.avatar_url),localStorage.setItem("img",t.avatar_url),"ChatGPT"===t.shareType?await this.startGPTChat(t.username,t.jmc):"Claude"===t.shareType?await this.startClaudeChat(t.username,t.jmc):"panel"===t.shareType&&await this.startPanel(t.username,t.jmc)}},async startGPTChat(t,e){const a=await k.get(`${v.apiBaseUrl}/pandora/checkUser?username=${t}&jmc=${e}`,{withCredentials:!0});a.data.status&&a.data.data.isShared?window.open(a.data.data.address):(C.error("您的账号未激活，请联系管理员"),this.$router.replace({name:"pandora"}))},async startClaudeChat(t,e){const a=await k.get(`${v.apiBaseUrl}/fuclaude/checkUser?username=${t}&jmc=${e}`,{withCredentials:!0});a.data.status?window.open(a.data.data):(C.error("您的账号未激活，请联系管理员"),this.$router.replace({name:"claude"}))},async startPanel(t,e){console.log("hi");const a=await k.get(`${v.apiBaseUrl}/share/checkUser?username=${t}&jmc=${e}`,{withCredentials:!0});a.data.status?(localStorage.setItem("token",a.data.data),this.$router.replace({name:"navi"})):(C.error(a.data.message),this.$router.replace({name:""}))}},mounted(){const t=new URL(window.location.href),e=new URLSearchParams(t.search),a=e.get("code"),s=e.get("state");a&&s&&this.fetchToken(a,s)}}),j=O,N=(0,r.A)(j,L,q,!1,null,"26bcbb86",null),Q=N.exports,G=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"claude"}},[e("div",{staticClass:"login-container"},[e("h1",{staticStyle:{"margin-left":"10px"}},[t._v(" Fuclaude "),e("span",{staticClass:"toggle-icon-container",on:{mouseenter:function(e){t.showExtraIcons=!0},mouseleave:function(e){t.showExtraIcons=!1}}},[e("img",{attrs:{src:a(8902),alt:"switch",loading:"lazy"},on:{click:function(e){return t.switchToPandora()}}}),e("transition",{attrs:{name:"fade"}},[t.showExtraIcons?e("div",{staticClass:"extra-icons"},[e("img",{attrs:{src:a(7343),alt:"Icon 2",loading:"lazy"},on:{click:function(e){return t.navigateTo("pandora")}}}),e("img",{attrs:{src:a(864),alt:"Icon 1",loading:"lazy"},on:{click:function(e){return t.navigateTo("claude")}}})]):t._e()])],1)]),e("form",{on:{submit:function(e){return e.preventDefault(),t.userlogin()}}},[e("input",{attrs:{type:"text",id:"username",placeholder:"用户名",required:""}}),e("input",{attrs:{type:"password",id:"password",placeholder:"密码",required:""}}),t._m(0)]),t._m(1),e("div",{staticClass:"alternative-login"},[e("div",{staticClass:"oauth-buttons"},[e("img",{attrs:{src:a(4832),alt:"LINUX DO",loading:"lazy"},on:{click:function(e){return t.initiateOAuth()}}})]),e("button",{attrs:{type:"button"},on:{click:function(e){return t.reset()}}},[t._v("重置密码")])]),t._m(2)])])},K=[function(){var t=this,e=t._self._c;return e("button",{attrs:{type:"submit"}},[e("span",{staticClass:"btn-text"},[t._v("登录")]),e("span",{staticClass:"spinner"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"divider"},[e("span",[t._v("OR")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"footer"},[e("span",[t._v("Powered by Fuclaude")])])}],W={name:"ClaudePage",data(){return{showExtraIcons:!1}},methods:{reset(){this.$router.replace({name:"reset"})},async userlogin(){const t=document.querySelector('button[type="submit"]');t.classList.add("loading");var e=document.getElementById("username").value,a=document.getElementById("password").value;try{const i=await k.post(`${v.apiBaseUrl}/fuclaude/login`,{username:e,password:a}),o=i.data.status;if(o)t.classList.remove("loading"),window.open(i.data.data);else{t.classList.remove("loading");var s=i.data.message;alert(s)}}catch(i){t.classList.remove("loading"),alert(i)}},async initiateOAuth(){try{const e=await k.get(`${v.apiBaseUrl}/oauth2/initiate?type=Claude`);var t=e;console.log(t),t.data?window.location=t.data:console.error("No redirect URL provided")}catch(e){alert(e)}},switchToPandora(){this.$router.replace({name:"home"})},navigateTo(t){this.$router.replace({name:t})}}},Y=W,H=(0,r.A)(Y,G,K,!1,null,"4d7a63e3",null),X=H.exports,J=function(){var t=this,e=t._self._c;return e("el-container",{attrs:{id:"navi"}},[t.isMobile&&!t.isCollapse?e("div",{staticClass:"mobile-overlay",on:{click:t.toggleCollapse}}):t._e(),e("el-aside",{class:["sidebar",{"mobile-sidebar":t.isMobile,collapsed:t.isCollapse}],attrs:{width:t.getSidebarWidth}},[e("div",{staticClass:"sidebar-header"},[e("h2",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapse,expression:"!isCollapse"}],staticClass:"site-title"},[t._v("Pandora Helper")]),t.isMobile?t._e():e("el-button",{staticClass:"collapse-btn",attrs:{icon:t.isCollapse?"el-icon-s-unfold":"el-icon-s-fold"},on:{click:t.toggleCollapse}})],1),e("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"accountNav","background-color":"#ffffff","text-color":"#333","active-text-color":"#fff",collapse:t.isCollapse,"collapse-transition":!1},on:{select:t.handleMenuSelect}},[e("el-menu-item",{attrs:{index:"accountNav"}},[e("i",{staticClass:"el-icon-s-custom"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("账号管理")])]),e("el-menu-item",{attrs:{index:"shareNav"}},[e("i",{staticClass:"el-icon-share"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("分享管理")])]),e("el-menu-item",{attrs:{index:"redemptionNav"}},[e("i",{staticClass:"el-icon-shopping-cart-full"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("兑换码")])]),e("el-menu-item",{attrs:{index:"carNav"}},[e("i",{staticClass:"el-icon-truck"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("停车场")])]),t.showDrawModule?e("el-menu-item",{attrs:{index:"drawNav"}},[e("i",{staticClass:"el-icon-picture-outline"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("AI绘图")])]):t._e(),e("el-menu-item",{attrs:{index:"freeNav"}},[e("i",{staticClass:"el-icon-medal"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("免费号池")])])],1),e("el-dropdown",{staticClass:"user-menu",attrs:{trigger:"click",placement:"top-start"}},[e("div",{staticClass:"avatar-wrapper"},[e("el-avatar",{staticClass:"user-avatar",attrs:{size:40,src:t.avatar}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{staticClass:"dropdown-item",nativeOn:{click:function(e){return t.showModal.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-key"}),e("span",[t._v("兑换码激活")])]),e("el-dropdown-item",{staticClass:"dropdown-item",nativeOn:{click:function(e){return t.showResetModal.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-refresh"}),e("span",[t._v("重置密码")])]),e("el-dropdown-item",{staticClass:"dropdown-item",nativeOn:{click:function(e){return t.logout.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-switch-button"}),e("span",[t._v("退出登录")])])],1)],1)],1),e("el-main",{class:["main-content",{"mobile-main":t.isMobile}]},[t.isMobile&&t.isCollapse?e("div",{staticClass:"menu-trigger",on:{click:t.toggleCollapse}},[e("i",{staticClass:"el-icon-s-operation"})]):t._e(),e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue}})})),1),e("enhanced-dialog",{attrs:{isVisible:t.resetModalVisible,title:"重置密码"},on:{close:t.closeResetModal,confirm:t.submitResetForm}},t._l(t.resetFormFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleResetUpdateValue}})})),1),e(t.currentComponent,{tag:"component"})],1)],1)},Z=[],tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"form-group"},[t.field.hideLabel?t._e():e("label",{staticClass:"form-label",attrs:{for:t.field.id}},[t._v(t._s(t.field.label))]),"checkbox"===t.field.type&&!t.field.hideLabel&&"number"===t.field.type|"text"===t.field.type|"date"===t.field.type|"password"===t.field.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-input",attrs:{id:t.field.id,type:"checkbox"},domProps:{checked:Array.isArray(t.localValue)?t._i(t.localValue,null)>-1:t.localValue},on:{change:function(e){var a=t.localValue,s=e.target,i=!!s.checked;if(Array.isArray(a)){var o=null,n=t._i(a,o);s.checked?n<0&&(t.localValue=a.concat([o])):n>-1&&(t.localValue=a.slice(0,n).concat(a.slice(n+1)))}else t.localValue=i}}}):"radio"===t.field.type&&!t.field.hideLabel&&"number"===t.field.type|"text"===t.field.type|"date"===t.field.type|"password"===t.field.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-input",attrs:{id:t.field.id,type:"radio"},domProps:{checked:t._q(t.localValue,null)},on:{change:function(e){t.localValue=null}}}):!t.field.hideLabel&&"number"===t.field.type|"text"===t.field.type|"date"===t.field.type|"password"===t.field.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-input",attrs:{id:t.field.id,type:t.field.type},domProps:{value:t.localValue},on:{input:function(e){e.target.composing||(t.localValue=e.target.value)}}}):t._e(),"select"===t.field.type?e("select",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-select",attrs:{id:t.field.id},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.localValue=e.target.multiple?a:a[0]},function(e){return t.handleSelectChange(e)}]}},t._l(t.field.options,(function(a){return e("option",{key:a.value,domProps:{value:a.value}},[t._v(" "+t._s(a.text)+" ")])})),0):t._e(),"checkbox"===t.field.type?e("div",{staticClass:"switch-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"switch-input",attrs:{type:"checkbox",id:t.field.id},domProps:{checked:Array.isArray(t.localValue)?t._i(t.localValue,null)>-1:t.localValue},on:{change:function(e){var a=t.localValue,s=e.target,i=!!s.checked;if(Array.isArray(a)){var o=null,n=t._i(a,o);s.checked?n<0&&(t.localValue=a.concat([o])):n>-1&&(t.localValue=a.slice(0,n).concat(a.slice(n+1)))}else t.localValue=i}}}),e("label",{staticClass:"switch-label",attrs:{for:t.field.id}},[e("span",{staticClass:"switch-button"})])]):t._e()])},et=[],at={props:{field:Object},data(){return{localValue:this.initializeValue()}},methods:{initializeValue(){return"select"===this.field.type&&this.field.options&&this.field.options.length>0?this.field.value||this.field.options[0].value:this.field.value},handleSelectChange(t){const e=t.target.value;this.$emit("handleSelectChange",{type:1,field:this.field,value:e})}},watch:{localValue(t){this.$emit("updateValue",this.field.id,t)},field:{handler(){this.localValue=this.initializeValue()},deep:!0,immediate:!0}}},st=at,it=(0,r.A)(st,tt,et,!1,null,"2886aa49",null),ot=it.exports,nt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"modal"}},[t.isVisible?e("div",{staticClass:"modal-overlay",on:{click:t.close}},[e("div",{staticClass:"modal-content",attrs:{role:"dialog","aria-modal":"true","aria-labelledby":t.title},on:{click:function(t){t.stopPropagation()}}},[e("header",{staticClass:"modal-header"},[e("h3",{attrs:{id:t.title}},[t._v(t._s(t.title))]),e("button",{staticClass:"close-button",attrs:{"aria-label":"关闭对话框"},on:{click:t.close}},[e("svg",{staticClass:"close-icon",attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"}})])])]),e("main",{staticClass:"modal-body"},[t._t("default")],2),e("footer",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-cancel",on:{click:t.close}},[t._v("取消")]),e("button",{staticClass:"btn btn-confirm",on:{click:t.confirm}},[t._v("确认")])])])]):t._e()])},lt=[],rt={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"标题"}},mounted(){this.isVisible&&this.preventBodyScroll(),window.addEventListener("keydown",this.handleKeydown)},beforeDestroy(){this.enableBodyScroll(),window.removeEventListener("keydown",this.handleKeydown)},watch:{isVisible(t){t?this.preventBodyScroll():this.enableBodyScroll()}},methods:{close(){this.$emit("close")},confirm(){this.$emit("confirm")},handleKeydown(t){this.isVisible&&"Escape"===t.key&&this.close()},preventBodyScroll(){document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"},enableBodyScroll(){document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}}},ct=rt,dt=(0,r.A)(ct,nt,lt,!1,null,"7ff1380e",null),ut=dt.exports,ht=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"panel",attrs:{id:"accountPanel"}},[e("el-header",[e("h2",[t._v("账号管理")])]),e("el-main",[e("el-row",{staticClass:"search-bar",attrs:{gutter:20}},[e("el-col",{attrs:{xs:24,sm:24,md:18}},[e("el-input",{staticClass:"search-input",attrs:{id:"email-query",placeholder:"请输入邮箱"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1),e("el-col",{staticClass:"create-btn-wrapper",attrs:{xs:24,sm:24,md:6}},[e("el-button",{staticClass:"create-new",attrs:{type:"primary"},on:{click:function(e){return t.showModal()}}},[t._v("新增")])],1)],1),t.isMobile?e("div",{staticClass:"mobile-view"},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"mobile-card"},[e("div",{staticClass:"mobile-card-header"},[e("div",{staticClass:"email-badge"},[e("i",{staticClass:"el-icon-message"}),t._v(" "+t._s(a.email)+" ")]),e("div",{staticClass:"status-badge",class:{"status-shared":1===a.shared}},[t._v(" "+t._s(1===a.shared?"已共享":"未共享")+" ")])]),e("div",{staticClass:"mobile-card-content"},[e("div",{staticClass:"info-row"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-user"}),t._v(" 账号类型 ")]),e("div",{staticClass:"info-value"},[t._v(t._s(a.type))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-time"}),t._v(" 更新时间 ")]),e("div",{staticClass:"info-value"},[t._v(t._s(a.updateTime))])])])]),e("div",{staticClass:"mobile-card-divider"}),e("div",{staticClass:"mobile-card-actions"},[e("div",{staticClass:"action-row"},[1===a.accountType?e("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(e){return t.refresh(a.id)}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 刷新 ")]):t._e(),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showShareModal(a.id)}}},[e("i",{staticClass:"el-icon-share"}),t._v(" 共享 ")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.id)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" 编辑 ")])],1),e("div",{staticClass:"action-row"},[e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.id)}}},[e("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")])],1)])])})),0):e("div",{staticClass:"pc-view"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,fit:!0,"cell-style":{padding:"12px 0"}}},[e("el-table-column",{attrs:{prop:"email",label:"电子邮箱","min-width":"180","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"name",label:"账号名称","min-width":"120","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"type",label:"账号类型","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.type))]),"ChatGPT"===a.row.type?["plus"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#DAA520","border-color":"#DAA520"},attrs:{type:"warning",effect:"plain",size:"mini"}},[t._v("Plus")]):"free"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#67C23A","border-color":"#67C23A"},attrs:{type:"success",effect:"plain",size:"mini"}},[t._v("Free")]):"team"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#87CEEB","border-color":"#87CEEB"},attrs:{type:"info",effect:"plain",size:"mini"}},[t._v("Team")]):"pro"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#000000","border-color":"#FFD700"},attrs:{type:"info",effect:"plain",size:"mini"}},[t._v("Pro")]):e("el-tag",{staticStyle:{"margin-left":"5px",color:"#808080","border-color":"#808080"},attrs:{type:"info",effect:"plain",size:"mini"}},[t._v("已失效")])]:t._e()]}}],null,!1,4114460491)}),e("el-table-column",{attrs:{prop:"shared",label:"共享",width:"80",align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(t){return[1===t.row.shared?e("i",{staticClass:"el-icon-circle-check",staticStyle:{color:"green"}}):e("i",{staticClass:"el-icon-circle-close",staticStyle:{color:"red"}})]}}],null,!1,3895160449)}),e("el-table-column",{attrs:{prop:"updateTime",label:"更新时间","min-width":"160","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center",gap:"6px"}},[e("i",{staticClass:"el-icon-time",staticStyle:{color:"#909399","font-size":"14px"}}),e("span",{staticStyle:{color:"#606266","font-weight":"500"}},[t._v(t._s(a.row.updateTime))])])]}}],null,!1,257911990)}),e("el-table-column",{attrs:{label:"操作",width:"320",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"operation-column"},[1===a.row.accountType?e("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(e){return t.refresh(a.row.id)}}},[t._v("刷新")]):t._e(),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showShareModal(a.row.id)}}},[t._v("共享")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.row.id)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.showConfirmDialog(a.row.id)}}},[t._v("删除")])],1)]}}],null,!1,474159138)})],1)],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{staticClass:"pagination-wrapper",attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),t.modalVisible?e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue}})})),1):t._e(),e("confirm-dialog",{attrs:{visible:t.isDialogVisible,title:"确认删除",message:"你确定要删除这个账号吗？"},on:{"update:visible":function(e){t.isDialogVisible=e},confirm:t.handleDelete}}),t.chartsVisible?e("div",{staticClass:"chart-overlay"},[e("div",{staticClass:"chart-container"},[e("div",{ref:"chart",staticClass:"chart-content"}),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.closeChart}},[t._v("关闭")])],1)]):t._e()],1)],1)},pt=[],mt=a(3944),gt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"zoom"}},[t.localVisible?e("div",{staticClass:"dialog-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.handleClose.apply(null,arguments)}}},[e("div",{staticClass:"dialog-container"},[e("div",{staticClass:"dialog-header"},[e("h3",[t._v(t._s(t.title))]),e("button",{staticClass:"close-button",on:{click:t.handleClose}},[t._v("×")])]),e("div",{staticClass:"dialog-body"},[e("i",{staticClass:"icon-warning"}),e("p",[t._v(t._s(t.message))])]),e("div",{staticClass:"dialog-footer"},[e("button",{staticClass:"btn btn-confirm",on:{click:t.handleConfirm}},[t._v("确定")]),e("button",{staticClass:"btn btn-cancel",on:{click:t.handleClose}},[t._v("取消")])])])]):t._e()])},ft=[],vt={props:{visible:{type:Boolean,default:!1},title:{type:String,default:"确认"},message:{type:String,default:"你确定要执行这个操作吗？"}},data(){return{localVisible:this.visible}},watch:{visible(t){this.localVisible=t}},methods:{handleClose(){this.localVisible=!1,this.$emit("update:visible",!1)},handleConfirm(){this.$emit("confirm"),this.handleClose()}}},bt=vt,yt=(0,r.A)(bt,gt,ft,!1,null,"d393abfa",null),wt=yt.exports,Ct={name:"AccountPage",components:{ConfirmDialog:wt,EnhancedDialog:ut,FormInput:ot},data(){return{loading:!1,isMobile:!1,email:"",tableData:[],currentPage:1,shareAddFlag:!1,total:0,isDialogVisible:!1,isAccDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,chart:null,chartData:[],chartsVisible:!1,formData:{},shareFormData:{},formFields:[{id:"name",label:"账号名称",type:"text",value:"",required:!0},{id:"email",label:"邮箱地址",type:"text",value:"",required:!0},{id:"accountType",label:"账号类型",type:"select",value:"ChatGPT",options:[{value:1,text:"ChatGPT"},{value:2,text:"Claude"}],required:!0},{id:"userLimit",label:"分享人数上限",type:"text",value:"",required:!0},{id:"accessToken",label:"ACCESS_TOKEN",type:"text",value:"",required:!0},{id:"refreshToken",label:"REFRESH_TOKEN",type:"text",value:"",required:!1},{id:"shared",label:"是否共享",type:"checkbox",value:!1,required:!0},{id:"auto",label:"自动加入",type:"checkbox",value:!1,required:!0}],accountFields:[{id:"name",label:"账号名称",type:"text",value:"",required:!0},{id:"email",label:"邮箱地址",type:"text",value:"",required:!0},{id:"accountType",label:"账号类型",type:"select",value:"ChatGPT",options:[{value:1,text:"ChatGPT"},{value:2,text:"Claude"},{value:3,text:"API"}],required:!0},{id:"userLimit",label:"分享人数上限",type:"text",value:"",required:!0},{id:"accessToken",label:"ACCESS_TOKEN",type:"text",value:"",required:!0},{id:"refreshToken",label:"REFRESH_TOKEN",type:"text",value:"",hideLabel:!1},{id:"shared",label:"是否共享",type:"checkbox",value:!1,required:!0},{id:"auto",label:"自动加入",type:"checkbox",value:!1,required:!0}],shareFields:[{id:"username",label:"用户名",type:"text",value:"",required:!0},{id:"password",label:"密码",type:"password",value:"",required:!0},{id:"comment",label:"备注",type:"text",value:"",required:!0},{id:"mjEnable",label:"启用 Midjourney",type:"checkbox",value:"",required:!0},{id:"expiresAt",label:"过期时间",type:"date",value:"",required:!0}],isAdmin:!1}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},initChart(){this.chart&&this.chart.dispose(),this.$nextTick((()=>{this.chart=mt.Ts(this.$refs.chart);const t={title:{text:"GPT使用情况",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["GPT-4o","GPT-4","GPT-4o-mini","o1-preview","o1-mini"],top:"bottom"},xAxis:{type:"category",data:this.chartData.map((t=>t.uniqueName)),axisLabel:{rotate:45}},yAxis:{type:"value",name:"使用次数"},series:[{name:"GPT-4o",type:"bar",data:this.chartData.map((t=>t.usage.gpt4o)),itemStyle:{color:"#91cc75"}},{name:"GPT-4",type:"bar",data:this.chartData.map((t=>t.usage.gpt4)),itemStyle:{color:"#5470c6"}},{name:"GPT-4o-mini",type:"bar",data:this.chartData.map((t=>t.usage.gpt4omini)),itemStyle:{color:"#fac858"}},{name:"o1-preview",type:"bar",data:this.chartData.map((t=>t.usage.o1Preview)),itemStyle:{color:"#2980b9"}},{name:"o1-mini",type:"bar",data:this.chartData.map((t=>t.usage.o1Mini)),itemStyle:{color:"#f0ad5e"}}]};this.chart.setOption(t)}))},async statistic(t){try{this.chartsVisible=!0;const e=await k.get(`${v.apiBaseUrl}/account/statistic?id=${t}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?(this.chartData=e.data.data,this.initChart()):this.$message.error("获取统计数据失败")}catch(e){console.error("Error fetching statistics:",e),this.$message.error("获取统计数据时发生错误")}},closeChart(){this.chartsVisible=!1,this.chart&&(this.chart.dispose(),this.chart=null)},showConfirmDialog(t){this.currentIndex=t,this.isDialogVisible=!0},async fetchAccounts(t){try{this.loading=!0;const e=await k.get(`${v.apiBaseUrl}/account/list?page=`+this.currentPage+"&size=10&emailAddr="+t,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&e.data.data.total>0&&(this.tableData=e.data.data.data,this.total=e.data.data.total)}catch(e){console.log(e),C.error("获取账号列表失败")}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));if(-1!==a&&(this.formFields[a].value=e),"accountType"===t){const t=this.formFields.find((t=>"accessToken"===t.id)),a=this.formFields.find((t=>"refreshToken"===t.id));switch(e){case 1:t.label="ACCESS_TOKEN",a.hideLabel=!1,a.label="REFRESH_TOKEN";break;case 2:t.label="SESSION_KEY",a.hideLabel=!0;break;case 3:t.label="API_PROXY",a.hideLabel=!1,a.label="API_KEY";break;default:t.label="ChatGPT",a.hideLabel=!1,a.label="ChatGPT"}}},showModal(){this.modalTitle="新增账号",this.currentIndex=null,this.formFields=this.accountFields,this.resetFormFields(),this.modalVisible=!0},showShareModal(t){this.shareAddFlag=!0,this.modalTitle="新增共享",this.currentIndex=t,this.formFields=this.shareFields.filter((t=>!(!this.isAdmin&&"mjEnable"===t.id))),this.resetFormFields(),this.modalVisible=!0},async editItem(t){try{this.modalTitle="编辑账号",this.formFields=this.accountFields,this.currentIndex=t;const e=await k.get(`${v.apiBaseUrl}/account/getById?id=`+t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let a=e.data.data,s=1;this.formFields.forEach((t=>{t.value=a[t.id],"accountType"===t.id&&(s=t.value),this.formData[t.id]=a[t.id]}));const i=this.formFields.find((t=>"accessToken"===t.id)),o=this.formFields.find((t=>"refreshToken"===t.id));switch(s){case 1:o.hideLabel=!1,i.label="ACCESS_TOKEN",o.label="REFRESH_TOKEN";break;case 2:i.label="SESSION_KEY",o.hideLabel=!0;break;case 3:i.label="API_PROXY",o.hideLabel=!1,o.label="API_KEY";break;default:o.hideLabel=!1,o.label="ChatGPT"}this.modalVisible=!0}catch(e){C.error("获取账号信息失败")}},closeModal(){this.currentIndex=null,this.modalVisible=!1,this.shareAddFlag=!1},async submitForm(){try{const t={...this.formData};if(this.shareAddFlag){t.uniqueName=t.username,t.accountId=this.currentIndex;const e=await k.post(`${v.apiBaseUrl}/share/add`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?C.success("新增账号共享成功"):C.error(e.data.message)}else null!==this.currentIndex?(t.auto=t.auto?1:0,t.shared=t.shared?1:0,t.accountType=""===t.accountType?1:t.accountType,t.id=this.currentIndex,await k.patch(`${v.apiBaseUrl}/account/update`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),C.success("修改成功")):(t.auto=t.auto?1:0,t.shared=t.shared?1:0,t.accountType=""===t.accountType?1:t.accountType,await k.post(`${v.apiBaseUrl}/account/add`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),C.success("新增成功"));this.fetchAccounts(""),this.closeModal()}catch(t){C.error("操作失败，请稍后重试")}},resetFormFields(){this.shareAdd=!1,this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},emailQuery(){this.fetchAccounts(this.email)},async handleDelete(){try{const t=await k.delete(`${v.apiBaseUrl}/account/delete?id=`+this.currentIndex,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?C.success("删除成功"):C.error("删除失败，请稍后重试"),this.fetchAccounts(""),this.currentIndex=null,this.isDialogVisible=!1}catch(t){C.error("删除失败，请稍后重试")}},handleCurrentChange(){this.fetchAccounts("")},async refresh(t){try{const e=await k.post(`${v.apiBaseUrl}/account/refresh?id=`+t,{},{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?C.success("刷新成功"):C.error(e.data.msg)}catch(e){C.error("刷新失败，请稍后重试")}},async checkAdminStatus(){try{const t=await k.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status&&(this.isAdmin=1===t.data.data.id)}catch(t){console.error("获取用户信息失败:",t)}}},mounted(){this.fetchAccounts(""),this.checkIsMobile(),this.checkAdminStatus(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile),this.chart&&this.chart.dispose()}},_t=Ct,kt=(0,r.A)(_t,ht,pt,!1,null,"13158c52",null),xt=kt.exports,It=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"panel",attrs:{id:"sharePanel"}},[e("el-header",[e("h2",[t._v("分享管理")])]),e("el-main",[e("el-row",{staticClass:"search-bar"},[e("el-col",{attrs:{xs:24,sm:18,md:18}},[e("el-input",{attrs:{id:"email-query",placeholder:"请输入邮箱或用户名"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1)],1),e("div",{staticClass:"pc-view"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,fit:!0}},[e("el-table-column",{attrs:{prop:"uniqueName",label:"用户名","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"right",width:"220",trigger:"hover"}},[e("div",{staticClass:"expires-info"},[a.row.gptExpiresAt?e("div",[e("span",{staticClass:"info-label"},[t._v("ChatGPT过期时间：")]),e("span",[t._v(t._s(a.row.gptExpiresAt))])]):t._e(),a.row.claudeExpiresAt?e("div",[e("span",{staticClass:"info-label"},[t._v("Claude过期时间：")]),e("span",[t._v(t._s(a.row.claudeExpiresAt))])]):t._e(),a.row.apiExpiresAt?e("div",[e("span",{staticClass:"info-label"},[t._v("API过期时间：")]),e("span",[t._v(t._s(a.row.apiExpiresAt))])]):t._e()]),e("div",{staticClass:"username-cell",attrs:{slot:"reference"},slot:"reference"},[e("span",[t._v(t._s(a.row.uniqueName))])])])]}}])}),e("el-table-column",{attrs:{prop:"gptCarName",label:"ChatGPT账号","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("split-button",{attrs:{name:a.row.gptCarName,count:a.row.gptUserCount||0,type:"gpt",loading:a.row.loading,days:a.row.gptExpiresAt?t.calculateDays(a.row.gptExpiresAt):0},on:{click:function(e){return t.openChat(a.row.gptConfigId,1)}}})]}}])}),e("el-table-column",{attrs:{prop:"claudeCarName",label:"Claude账号","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("split-button",{attrs:{name:a.row.claudeCarName,count:a.row.claudeUserCount||0,type:"claude",loading:a.row.loading,days:a.row.claudeExpiresAt?t.calculateDays(a.row.claudeExpiresAt):0},on:{click:function(e){return t.openChat(a.row.claudeConfigId,2)}}})]}}])}),e("el-table-column",{attrs:{prop:"apiCarName",label:"API账号","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("split-button",{attrs:{name:a.row.apiCarName,count:a.row.apiUserCount||0,type:"api",loading:a.row.loading,days:a.row.apiExpiresAt?t.calculateDays(a.row.apiExpiresAt):0},on:{click:function(e){return t.openChat(a.row.apiConfigId,3)}}})]}}])}),e("el-table-column",{attrs:{label:"操作","min-width":"280",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"action-row"},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showShareModal(a.row.id)}}},[t._v("激活")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.row.id)}}},[t._v("编辑")]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.row.id)}}},[t._v("删除")])],1)]}}])})],1)],1),e("div",{staticClass:"mobile-view"},t._l(t.tableData,(function(a,s){return e("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"item.loading"}],key:s,staticClass:"mobile-card"},[e("div",{staticClass:"mobile-card-header"},[e("div",{staticClass:"username-badge"},[e("i",{staticClass:"el-icon-user"}),t._v(" "+t._s(a.uniqueName)+" ")]),e("div",{staticClass:"expires-badge"},[t._v(" "+t._s(a.comment)+" ")])]),e("div",{staticClass:"mobile-card-content"},[a.gptCarName?e("div",{staticClass:"account-item"},[e("div",{staticClass:"account-label"},[t._v("ChatGPT账号")]),e("div",{staticClass:"account-value"},[e("split-button",{attrs:{name:a.gptCarName,count:a.gptUserCount||0,type:"gpt",loading:a.loading,days:a.gptExpiresAt?t.calculateDays(a.gptExpiresAt):0},on:{click:function(e){return t.openChat(a.gptConfigId,1)}}})],1)]):t._e(),a.claudeCarName?e("div",{staticClass:"account-item"},[e("div",{staticClass:"account-label"},[t._v("Claude账号")]),e("div",{staticClass:"account-value"},[e("split-button",{attrs:{name:a.claudeCarName,count:a.claudeUserCount||0,type:"claude",loading:a.loading,days:a.claudeExpiresAt?t.calculateDays(a.claudeExpiresAt):0},on:{click:function(e){return t.openChat(a.claudeConfigId,2)}}})],1)]):t._e(),a.apiCarName?e("div",{staticClass:"account-item"},[e("div",{staticClass:"account-label"},[t._v("API账号")]),e("div",{staticClass:"account-value"},[e("split-button",{attrs:{name:a.apiCarName,count:a.apiUserCount||0,type:"api",loading:a.loading,days:a.apiExpiresAt?t.calculateDays(a.apiExpiresAt):0},on:{click:function(e){return t.openChat(a.apiConfigId,3)}}})],1)]):t._e()]),e("div",{staticClass:"mobile-card-divider"}),e("div",{staticClass:"mobile-card-actions"},[e("div",{staticClass:"action-row"},[e("el-button",{attrs:{type:"primary",size:"mini",loading:a.actionLoading},on:{click:function(e){return t.showShareModal(a.id)}}},[t._v("激活")]),e("el-button",{attrs:{type:"warning",size:"mini",loading:a.actionLoading},on:{click:function(e){return t.editItem(a.id)}}},[t._v("编辑")]),e("el-button",{attrs:{type:"danger",size:"mini",loading:a.actionLoading},on:{click:function(e){return t.showConfirmDialog(a.id)}}},[t._v("删除")])],1)])])})),0),e("div",{staticClass:"pagination-container"},[e("el-pagination",{staticClass:"pagination-wrapper",attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue,handleSelectChange:t.handleSelectChange}})})),1),e("confirm-dialog",{attrs:{visible:t.isDialogVisible,title:"确认删除",message:"你确定要删除这个共享账户吗？"},on:{"update:visible":function(e){t.isDialogVisible=e},confirm:t.handleDelete}})],1)],1)},St=[],At=function(){var t=this,e=t._self._c;return e("el-tooltip",{attrs:{content:t.tooltipContent,placement:"top",effect:"light"}},[e("button",{staticClass:"split-button",class:[t.type,{disabled:0===t.count}],on:{click:t.handleClick}},[e("span",{staticClass:"name-section"},[e("i",{staticClass:"type-icon",class:t.typeIcon}),t._v(" "+t._s(t.shortName)+" ")]),e("div",{staticClass:"info-section"},[e("span",{staticClass:"count-section"},[e("i",{staticClass:"el-icon-user user-icon"}),t._v(" "+t._s(t.count)+" ")]),void 0!==t.days&&"-"!==t.days?e("span",{staticClass:"days-section"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.days)+" 天 ")]):t._e()])])])},Dt=[],Tt={name:"SplitButton",props:{name:{type:String,required:!0},count:{type:[String,Number],default:0},days:{type:[String,Number],default:void 0},type:{type:String,default:"gpt",validator:function(t){return-1!==["gpt","claude","api"].indexOf(t)}},maxLength:{type:Number,default:10}},computed:{typeIcon(){const t={gpt:"el-icon-chat-dot-round",claude:"el-icon-message",api:"el-icon-connection"};return t[this.type]||"el-icon-chat-dot-round"},shortName(){return this.name.length>this.maxLength?this.name.substring(0,this.maxLength)+"...":this.name},tooltipContent(){return 0===Number(this.count)?"用户暂未拥有该类型账号":"点击开始对话"}},methods:{handleClick(){Number(this.count)>0&&this.$emit("click")}}},Pt=Tt,Et=(0,r.A)(Pt,At,Dt,!1,null,"095e123e",null),zt=Et.exports,$t={name:"SharePage",components:{ConfirmDialog:wt,EnhancedDialog:ut,FormInput:ot,SplitButton:zt},data(){return{isMobile:!1,email:"",tableData:[],currentPage:1,total:0,isDialogVisible:!1,isAccDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,activateFlag:!1,accountOpts:[],loading:!1,formData:{},shareFormData:{},formFields:[{id:"uniqueName",label:"用户名",type:"text",value:"",required:!0,readonly:"1"},{id:"comment",label:"备注",type:"text",value:"",required:!0,readonly:!0},{id:"expiresAt",label:"过期时间",type:"date",value:"",required:!0}],accountFields:[{id:"uniqueName",label:"用户名",type:"text",value:"",required:!0},{id:"comment",label:"备注",type:"text",value:"",required:!0},{id:"mjEnable",label:"启用 Midjourney",type:"checkbox",value:"",required:!0}],shareFields:[{id:"accountType",label:"账号类型",type:"select",value:"ChatGPT",options:[{value:1,text:"ChatGPT"},{value:2,text:"Claude"},{value:3,text:"API"}],required:!0},{id:"accountOptions",label:"选择账号",type:"select",value:"",options:this.accountOpts},{id:"expiresAt",label:"过期时间",type:"date",value:"",required:!0}],isAdmin:!1}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},async openChat(t,e){if(null===t)return;const a=b.Loading.service({fullscreen:!0,text:"加载中...",background:"rgba(0, 0, 0, 0.7)"});try{let a;const s={withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}};switch(e){case 1:a=await k.get(`${v.apiBaseUrl}/share/getGptShare?gptConfigId=${t}`,s);break;case 2:a=await k.get(`${v.apiBaseUrl}/share/getClaudeShare?claudeConfigId=${t}`,s);break;case 3:a=await k.get(`${v.apiBaseUrl}/share/getApiShare?apiConfigId=${t}`,s);break}a?.data?.status&&window.open(a.data.data)}catch(s){console.error("请求失败:",s),this.$message.error("操作失败，请重试")}finally{a.close()}},showConfirmDialog(t){this.currentIndex=t,this.isDialogVisible=!0},async fetchItems(t){this.loading=!0;try{const e=await k.get(`${v.apiBaseUrl}/share/list?page=${this.currentPage}&size=10&emailAddr=${t}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&(this.tableData=e.data.data.data.map((t=>({...t,loading:!1,actionLoading:!1}))),this.total=e.data.data.total)}catch(e){C.error(e)}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},showModal(){this.modalTitle="新增账号",this.currentIndex=null,this.formFields=this.accountFields,this.resetFormFields(),this.modalVisible=!0},async showShareModal(t){this.shareAddFlag=!0,this.modalTitle="激活",this.currentIndex=t,this.formFields=this.shareFields,this.resetFormFields(),this.modalVisible=!0,this.activateFlag=!0;try{const e=await k.get(`${v.apiBaseUrl}/account/options?type=1`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.accountOpts=e.data.data;const a=this.shareFields.find((t=>"accountOptions"===t.id));a&&(a.options=this.accountOpts,this.formData={accountId:parseInt(this.accountOpts[0]?.value),id:t})}catch(e){C.error("获取账号选项失败")}},async editItem(t){this.modalTitle="编辑共享",this.formFields=[{id:"uniqueName",label:"用户名",type:"text",value:"",required:!0},{id:"comment",label:"备注",type:"text",value:"",required:!0},...this.isAdmin?[{id:"mjEnable",label:"启用 Midjourney",type:"checkbox",value:"",required:!0}]:[]],this.currentIndex=t;try{const e=await k.get(`${v.apiBaseUrl}/share/getById?id=${t}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let a=e.data.data;this.formFields.forEach((t=>{t.value=a[t.id],this.formData[t.id]=a[t.id]})),this.modalVisible=!0}catch(e){C.error("获取共享信息失败")}},closeModal(){this.modalVisible=!1,this.shareAddFlag=!1,this.activateFlag=!1,this.formData={}},async submitForm(){const t={...this.formData},e=this.tableData.find((t=>t.id===this.currentIndex));e&&(e.actionLoading=!0);try{if(this.activateFlag){t.accountId=t.accountOptions?parseInt(t.accountOptions):t.accountId,t.id=this.currentIndex,t.accountType=parseInt(t.accountType);const e=await k.post(`${v.apiBaseUrl}/share/distribute`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?C.success("激活成功"):C.error(e.data.message)}else if(null!==this.currentIndex){t.id=this.currentIndex;const e=await k.patch(`${v.apiBaseUrl}/share/update`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&C.success("编辑成功")}}catch(a){C.error("操作失败")}finally{e&&(e.actionLoading=!1),await this.fetchItems(""),this.closeModal()}},resetFormFields(){this.shareAdd=!1,this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},emailQuery(){this.fetchItems(this.email)},async handleDelete(){const t=this.tableData.find((t=>t.id===this.currentIndex));t&&(t.actionLoading=!0);try{const t=await k.delete(`${v.apiBaseUrl}/share/delete?id=${this.currentIndex}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?C.success("删除成功"):C.error("删除失败，请稍后重试")}catch(e){C.error("删除失败")}finally{t&&(t.actionLoading=!1),await this.fetchItems(""),this.isDialogVisible=!1}},handleCurrentChange(){this.fetchItems("")},async handleSelectChange({type:t,field:e,value:a}){if(1===t&&"accountOptions"!==e.id)try{const t=await k.get(`${v.apiBaseUrl}/account/options?type=${a}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.accountOpts=t.data.data,e.value=a;const s=this.shareFields.find((t=>"accountOptions"===t.id));s&&(s.options=this.accountOpts)}catch(s){C.error("获取账号选项失败")}},calculateDays(t){if(!t||"-"===t)return"-";const e=new Date;e.setHours(0,0,0,0);const a=new Date(t);a.setHours(0,0,0,0);const s=a-e,i=Math.ceil(s/864e5);return Math.max(0,i)},async checkAdminRole(){try{const t=await k.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status&&(this.isAdmin=1===t.data.data.id)}catch(t){console.error("获取用户信息失败:",t)}}},mounted(){this.fetchItems(""),this.checkIsMobile(),this.checkAdminRole(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile)}},Mt=$t,Bt=(0,r.A)(Mt,It,St,!1,null,"7749cb89",null),Vt=Bt.exports,Ut=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"panel"},[e("el-header",[e("div",{staticClass:"header-content"},[e("h2",[t._v("免费号池")]),e("el-switch",{attrs:{"active-color":"#0e8f6f","active-text":"Claude","inactive-text":"ChatGPT"},on:{change:t.toggleAIType},model:{value:t.showClaude,callback:function(e){t.showClaude=e},expression:"showClaude"}})],1)]),e("el-main",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],attrs:{"element-loading-text":"加载中..."}},[t.pageLoading?e("el-skeleton",{attrs:{loading:t.pageLoading,animated:"",count:4}},[e("template",{slot:"template"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{staticStyle:{"padding-bottom":"15px"},attrs:{xs:24,sm:12,md:8,lg:6,xl:4}},[e("el-skeleton-item",{staticStyle:{height:"150px","border-radius":"8px"},attrs:{variant:"rect"}})],1)],1)],1)],2):t._e(),t.isMobile?e("div",{staticClass:"mobile-view"},[t.pageLoading?t._e():e("div",{staticClass:"mobile-cards"},t._l(t.filteredAccounts,(function(a,s){return e("div",{key:a.id,staticClass:"mobile-card",class:{busy:"1"===a.sessionToken}},[e("div",{staticClass:"mobile-card-header"},[e("div",{staticClass:"mobile-card-title"},[e("span",[t._v(t._s(a.type)+"账号 "+t._s(s+1))]),e("el-tag",{attrs:{type:""===a.sessionToken?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s(""!=a.sessionToken?"繁忙":"空闲")+" ")])],1)]),e("div",{staticClass:"mobile-card-content"},[e("el-button",{staticClass:"mobile-use-button",attrs:{type:"success",disabled:""!=a.sessionToken,size:"medium"},on:{click:function(e){return t.useAccount(a.id)}}},[t._v(" "+t._s(""!=a.sessionToken?"暂不可用":"立即使用")+" ")])],1)])})),0)]):e("div",{staticClass:"pc-view"},[t.pageLoading?t._e():e("div",{staticClass:"account-grid"},t._l(t.filteredAccounts,(function(a,s){return e("div",{key:a.id,staticClass:"account-item"},[e("el-card",{class:{busy:"1"===a.sessionToken},attrs:{shadow:"hover"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"account-title"},[t._v(t._s(a.type)+"账号 "+t._s(s+1))]),e("el-tag",{staticClass:"status-tag",attrs:{type:""===a.sessionToken?"success":"danger",size:"small",effect:"dark"}},[t._v(" "+t._s(""!=a.sessionToken?"繁忙":"空闲")+" ")])],1),e("el-button",{staticClass:"use-button",attrs:{type:"primary",disabled:""!=a.sessionToken},on:{click:function(e){return t.useAccount(a.id)}}},[t._v(" "+t._s(""!=a.sessionToken?"暂不可用":"立即使用")+" ")])],1)],1)})),0)]),t.pageLoading||0!==t.filteredAccounts.length?t._e():e("div",{staticClass:"empty-state"},[e("i",{staticClass:"el-icon-warning-outline"}),e("p",[t._v("暂无可用账号")])])],1)],1)},Ft=[],Rt={name:"App",data(){return{accounts:[],showClaude:!0,pageLoading:!0,refreshInterval:null,retryCount:0,maxRetries:3,isMobile:!1}},computed:{filteredAccounts(){return this.accounts.filter((t=>this.showClaude?"Claude"===t.type:"ChatGPT"===t.type))}},async created(){this.checkDeviceType(),window.addEventListener("resize",this.checkDeviceType),await this.initializeData(),this.startAutoRefresh()},beforeDestroy(){this.stopAutoRefresh(),window.removeEventListener("resize",this.checkDeviceType)},methods:{checkDeviceType(){this.isMobile=window.innerWidth<=768},async initializeData(){await this.fetchAccounts(),this.pageLoading=!1},startAutoRefresh(){this.refreshInterval=setInterval((()=>{this.fetchAccounts()}),3e4)},stopAutoRefresh(){this.refreshInterval&&clearInterval(this.refreshInterval)},async fetchAccounts(){try{const t=await k.get(`${v.apiBaseUrl}/account/list?type=`+(this.showClaude?2:1),{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")},timeout:1e4});if(t.data.status){const e=t.data.data.data;this.accounts=this.accounts.map((t=>{const a=e.find((e=>e.id===t.id));return a||t})),e.forEach((t=>{this.accounts.find((e=>e.id===t.id))||this.accounts.push(t)})),this.retryCount=0}}catch(t){this.retryCount<this.maxRetries?(this.retryCount++,setTimeout((()=>{this.fetchAccounts()}),2e3*this.retryCount)):C.error("获取账号列表失败，请刷新页面重试")}},async useAccount(t){try{const e=await k.get(`${v.apiBaseUrl}/account/share?id=`+t,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")},timeout:15e3});e.data.status?(window.open(e.data.data),await this.fetchAccounts()):C.error(e.data.message||"使用账号失败")}catch(e){C.error("系统错误,请稍后重试")}},async toggleAIType(){this.pageLoading=!0,this.accounts=[],await this.fetchAccounts(),this.pageLoading=!1}}},Lt=Rt,qt=(0,r.A)(Lt,Ut,Ft,!1,null,"097223a2",null),Ot=qt.exports,jt=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"panel",attrs:{id:"redemptionPanel"}},[e("el-header",[e("h2",[t._v("兑换码管理")])]),e("el-main",[e("el-row",{staticClass:"search-bar"},[e("el-col",{attrs:{xs:24,sm:18,md:18}},[e("el-input",{attrs:{id:"email-query",placeholder:"请输入邮箱"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.emailQuery.apply(null,arguments)}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1),e("el-col",{staticClass:"btn-col",attrs:{xs:24,sm:6,md:6}},[e("el-button",{staticClass:"create-new",attrs:{type:"primary"},on:{click:function(e){return t.showModal()}}},[t._v("新增")])],1)],1),t.isMobile?e("div",{staticClass:"mobile-view"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"mobile-card"},[e("div",{staticClass:"mobile-card-header"},[e("div",{staticClass:"email-badge"},[e("i",{staticClass:"el-icon-message"}),e("el-tooltip",{attrs:{content:a.email,placement:"top",effect:"light"}},[e("span",[t._v(t._s(a.email))])])],1),e("div",{staticClass:"type-badge"},[t._v(" "+t._s(a.accountType)+" ")])]),e("div",{staticClass:"mobile-card-content"},[e("div",{staticClass:"info-row"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-key"}),t._v(" 兑换码 ")]),e("div",{staticClass:"info-value"},[e("el-tooltip",{attrs:{content:a.code,placement:"top",effect:"light"}},[e("span",[t._v(t._s(a.code))])])],1)]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-time"}),t._v(" 兑换时长 ")]),e("div",{staticClass:"info-value"},[t._v(t._s(a.duration)+" 天")])])])]),e("div",{staticClass:"mobile-card-divider"}),e("div",{staticClass:"mobile-card-actions"},[e("div",{staticClass:"action-row"},[e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.id)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" 编辑 ")]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.id)}}},[e("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")])],1)])])})),0)]):e("div",{staticClass:"pc-view"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"cell-style":{padding:"12px 0"}}},[e("el-table-column",{attrs:{prop:"email",label:"名称","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center",gap:"6px"}},[e("i",{staticClass:"el-icon-user",staticStyle:{color:"#909399","font-size":"14px"}}),e("span",[t._v(t._s(a.row.email))])])]}}],null,!1,3593149176)}),e("el-table-column",{attrs:{prop:"accountType",label:"账号类型",width:"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{size:"mini",effect:"plain",type:"ChatGPT"===a.row.accountType?"success":"Claude"===a.row.accountType?"warning":"info"}},[t._v(" "+t._s(a.row.accountType)+" ")])]}}],null,!1,3942457626)}),e("el-table-column",{attrs:{prop:"code",label:"兑换码","min-width":"180","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{attrs:{content:a.row.code,placement:"top",effect:"light"}},[e("div",{staticStyle:{display:"flex","align-items":"center",gap:"6px"}},[e("i",{staticClass:"el-icon-key",staticStyle:{color:"#909399","font-size":"14px"}}),e("span",[t._v(t._s(a.row.code))])])])]}}],null,!1,1937422458)}),e("el-table-column",{attrs:{prop:"duration",label:"兑换时长",width:"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center",gap:"6px"}},[e("i",{staticClass:"el-icon-time",staticStyle:{color:"#909399","font-size":"14px"}}),e("span",[t._v(t._s(a.row.duration)+" 天")])])]}}],null,!1,2673793388)}),e("el-table-column",{attrs:{label:"操作",width:"180",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"action-row",staticStyle:{display:"flex",gap:"8px"}},[e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.row.id)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" 编辑 ")]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.row.id)}}},[e("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")])],1)]}}],null,!1,122730437)})],1)],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{staticClass:"pagination-wrapper",attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue,handleSelectChange:t.handleSelectChange}})})),1),e("confirm-dialog",{attrs:{visible:t.isDialogVisible,title:"确认删除",message:"你确定要删除这个兑换码吗？"},on:{"update:visible":function(e){t.isDialogVisible=e},confirm:t.handleDelete}})],1)],1)},Nt=[],Qt=a(2522),Gt={name:"RedemptionPage",components:{ConfirmDialog:wt,EnhancedDialog:ut,FormInput:ot},data(){return{isMobile:!1,email:"",tableData:[],currentPage:1,pageSize:10,total:0,loading:!1,isDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,formData:{},formFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],accountFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],shareFields:[{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0}]}},methods:{checkIsMobile:(0,Qt.debounce)((function(){this.isMobile=window.innerWidth<=768}),200),showConfirmDialog(t){this.currentIndex=t,this.isDialogVisible=!0},async fetchItems(t){try{this.loading=!0;const e=await k.get(`${v.apiBaseUrl}/redemption/list`,{params:{page:this.currentPage,size:this.pageSize,emailAddr:t},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});e.data.status&&(this.tableData=e.data.data.data,this.total=e.data.data.total)}catch(e){C.error(e.message||"获取数据失败")}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},async showModal(){try{this.modalTitle="新增兑换码",this.currentIndex=null,this.formFields=this.accountFields,this.resetFormFields(),this.modalVisible=!0;const t=await k.get(`${v.apiBaseUrl}/account/list`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=this.accountFields.find((t=>"accountId"===t.id));e&&t.data.status&&(e.options=t.data.data.data.map((t=>({text:`${t.name}(${1===t.accountType?"ChatGPT":2===t.accountType?"Claude":"API"})`,value:t.id}))))}catch(t){C.error(t.message||"获取账号列表失败")}},async editItem(t){try{this.modalTitle="编辑兑换码",this.formFields=this.shareFields,this.currentIndex=t;const e=await k.get(`${v.apiBaseUrl}/redemption/getById`,{params:{id:t},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.data.status){const t=e.data.data;this.formFields.forEach((e=>{e.value=t[e.id],this.$set(this.formData,e.id,t[e.id])})),this.modalVisible=!0}}catch(e){C.error(e.message||"获取兑换码详情失败")}},closeModal(){this.modalVisible=!1,this.currentIndex=null,this.formData={}},async submitForm(){try{const t={...this.formData};if(this.currentIndex){t.id=this.currentIndex,t.duration=parseInt(t.duration);const e=await k.patch(`${v.apiBaseUrl}/redemption/update`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.data.status)throw new Error("更新失败");C.success("更新成功")}else{t.accountId=parseInt(t.accountId),t.count=parseInt(t.count),t.duration=parseInt(t.duration);const e=await k.post(`${v.apiBaseUrl}/redemption/add`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.data.status)throw new Error(e.data.message);C.success("新增成功")}this.closeModal(),this.fetchItems("")}catch(t){C.error(t.message||"操作失败")}},resetFormFields(){this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.$set(this.formData,t.id,e)}))},emailQuery:(0,Qt.debounce)((function(){this.currentPage=1,this.fetchItems(this.email)}),300),async handleDelete(){try{const t=await k.delete(`${v.apiBaseUrl}/redemption/delete`,{params:{id:this.currentIndex},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.data.status)throw new Error("删除失败");C.success("删除成功"),this.fetchItems("")}catch(t){C.error(t.message||"删除失败")}finally{this.isDialogVisible=!1}},handleCurrentChange(t){this.currentPage=t,this.fetchItems(this.email)},handleSelectChange({type:t,field:e,value:a}){console.log("Select changed:",{type:t,field:e,value:a})}},mounted(){this.fetchItems(""),this.checkIsMobile(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile)}},Kt=Gt,Wt=(0,r.A)(Kt,jt,Nt,!1,null,"d5fe62ee",null),Yt=Wt.exports,Ht=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"panel",attrs:{id:"carPanel"}},[e("el-header",[e("h2",[t._v("停车场")])]),e("el-main",[e("el-row",{staticClass:"search-bar"},[e("el-col",{attrs:{xs:24,sm:18,md:18}},[e("el-input",{attrs:{id:"email-query",placeholder:"输入车主名称查询"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isMobile,expression:"!isMobile"}],staticClass:"pc-view"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"cell-style":{padding:"12px 0"}}},[e("el-table-column",{attrs:{prop:"email",label:"账号","min-width":"180","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center",gap:"6px"}},[e("i",{staticClass:"el-icon-message",staticStyle:{color:"#909399","font-size":"14px"}}),e("span",[t._v(t._s(a.row.email))])])]}}])}),e("el-table-column",{attrs:{prop:"type",label:"账号类型","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.type))]),"ChatGPT"===a.row.type?["plus"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#DAA520","border-color":"#DAA520"},attrs:{type:"warning",effect:"plain",size:"mini"}},[t._v("Plus")]):"free"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#67C23A","border-color":"#67C23A"},attrs:{type:"success",effect:"plain",size:"mini"}},[t._v("Free")]):"team"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#87CEEB","border-color":"#87CEEB"},attrs:{type:"info",effect:"plain",size:"mini"}},[t._v("Team")]):"pro"===a.row.planType?e("el-tag",{staticStyle:{"margin-left":"5px",color:"#000000","border-color":"#FFD700"},attrs:{type:"info",effect:"plain",size:"mini"}},[t._v("Pro")]):e("el-tag",{staticStyle:{"margin-left":"5px",color:"#808080","border-color":"#808080"},attrs:{type:"info",effect:"plain",size:"mini"}},[t._v("无效")])]:t._e()]}}])}),e("el-table-column",{attrs:{prop:"auto",label:"自动上车",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:["status-tag",1===a.row.auto?"status-yes":"status-no"]},[t._v(" "+t._s(1===a.row.auto?"yes!":"No")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"usernameDesc",label:"车主","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center",gap:"6px"}},[e("i",{staticClass:"el-icon-user",staticStyle:{color:"#909399","font-size":"14px"}}),e("span",[t._v(t._s(a.row.usernameDesc))])])]}}])}),e("el-table-column",{attrs:{prop:"countDesc",label:"已上车人数 / 总人数","min-width":"160",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",gap:"4px"}},[e("span",{staticStyle:{color:"#67C23A","font-weight":"600"}},[t._v(t._s(a.row.countDesc.split("/")[0]))]),e("span",{staticStyle:{color:"#909399"}},[t._v("/")]),e("span",{staticStyle:{color:"#409EFF","font-weight":"600"}},[t._v(t._s(a.row.countDesc.split("/")[1]))])])]}}])}),e("el-table-column",{attrs:{label:"操作",width:"280",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"action-buttons",staticStyle:{display:"flex",gap:"8px"}},[!0===a.row.authorized?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showModal(a.row.id)}}},[t._v("审核")]):t._e(),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.contact(a.row.username)}}},[t._v("联系车主")]),e("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){return t.applyCar(a.row.id)}}},[t._v("我要上车")])],1)]}}])})],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isMobile,expression:"isMobile"}],staticClass:"mobile-view"},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"mobile-card"},[e("div",{staticClass:"mobile-card-header"},[e("div",{staticClass:"account-badge"},[e("i",{staticClass:"el-icon-user"}),t._v(" "+t._s(a.email)+" ")]),e("div",{class:["auto-badge",1===a.auto?"auto-yes":"auto-no"]},[t._v(" "+t._s(1===a.auto?"自动上车":"审核上车")+" ")])]),e("div",{staticClass:"mobile-card-content"},[e("div",{staticClass:"info-row"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-key"}),t._v(" 账号类型 ")]),e("div",{staticClass:"info-value"},[t._v(t._s(a.type))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-user"}),t._v(" 车主 ")]),e("div",{staticClass:"info-value"},[t._v(t._s(a.usernameDesc))])]),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-label"},[e("i",{staticClass:"el-icon-s-data"}),t._v(" 上车情况 ")]),e("div",{staticClass:"info-value"},[t._v(t._s(a.countDesc))])])])]),e("div",{staticClass:"mobile-card-divider"}),e("div",{staticClass:"mobile-card-actions"},[e("div",{staticClass:"action-row"},[!0===a.authorized?e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showModal(a.id)}}},[e("i",{staticClass:"el-icon-check"}),t._v(" 审核 ")]):t._e(),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.contact(a.username)}}},[e("i",{staticClass:"el-icon-message"}),t._v(" 联系车主 ")]),e("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){return t.applyCar(a.id)}}},[e("i",{staticClass:"el-icon-plus"}),t._v(" 上车 ")])],1)])])})),0),e("div",{staticClass:"pagination-container"},[e("el-pagination",{staticClass:"pagination-wrapper",attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),e("el-dialog",{attrs:{visible:t.auditVisible,title:"审核申请",width:t.isMobile?"95%":"360px",fullscreen:!1,"custom-class":"modern-audit-dialog"},on:{"update:visible":function(e){t.auditVisible=e}}},[e("div",{staticClass:"audit-content"},[e("el-checkbox-group",{staticClass:"audit-checkbox-group",model:{value:t.auditValues,callback:function(e){t.auditValues=e},expression:"auditValues"}},t._l(t.auditOptions,(function(a){return e("el-checkbox",{key:a.value,staticClass:"audit-checkbox-item",attrs:{label:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.submitAudit(0)}}},[t._v("拒绝")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submitAudit(1)}}},[t._v("通过")])],1)])],1)],1)},Xt=[];const Jt=new s["default"];var Zt={name:"SharePage",data(){return{isMobile:!1,email:"",tableData:[],currentPage:1,total:0,isDialogVisible:!1,isAccDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,activateFlag:!1,accountOpts:[],auditVisible:!1,auditValues:[],auditOptions:[],auditCarId:null,loading:!1,formData:{},shareFormData:{},formFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],accountFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],shareFields:[{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0}]}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},async jump(){Jt.$emit("envVariableChanged","jump")},async submitAudit(t){try{const e=await k.post(`${v.apiBaseUrl}/car/audit`,{accountId:this.auditCarId,allowApply:t,ids:this.auditValues},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?C.success("审核成功"):C.error(e.data.message),this.auditVisible=!1,this.auditValues=[],this.auditCarId=null,this.fetchItems("")}catch(e){C.error(e)}},async applyCar(t){try{const e=await k.post(`${v.apiBaseUrl}/car/apply`,{accountId:t},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?C.success("申请成功"):C.error(e.data.message),this.closeModal()}catch(e){C.error(e)}},async fetchItems(t){this.loading=!0;try{const e=await k.get(`${v.apiBaseUrl}/car/list?page=${this.currentPage}&size=10&owner=${t}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&(this.tableData=e.data.data.data,this.total=e.data.data.total)}catch(e){C.error(e)}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},async showModal(t){try{this.auditVisible=!0,this.auditCarId=t;const e=await k.get(`${v.apiBaseUrl}/car/fetchApplies?accountId=${this.auditCarId}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.auditOptions=e.data.data}catch(e){C.error(e)}},contact(t){window.open("https://linux.do/u/"+t+"/summary")},closeModal(){this.modalVisible=!1,this.shareAddFlag=!1,this.currentIndex=null},async submitForm(){const t={...this.formData};try{if(this.currentIndex)t.id=this.currentIndex,t.duration=parseInt(t.duration),await k.patch(`${v.apiBaseUrl}/redemption/update`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});else{t.accountId=parseInt(t.accountId),t.count=parseInt(t.count),t.duration=parseInt(t.duration);const e=await k.post(`${v.apiBaseUrl}/redemption/add`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?C.success("新增成功"):C.error(e.data.message),this.closeModal()}this.fetchItems(""),this.closeModal()}catch(e){C.error(e)}},resetFormFields(){this.shareAdd=!1,this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},emailQuery(){this.fetchItems(this.email)},handleCurrentChange(){this.fetchItems("")},async handleSelectChange({type:t,field:e,value:a}){console.log(t,e,a)}},mounted(){this.fetchItems(""),this.checkIsMobile(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile)}},te=Zt,ee=(0,r.A)(te,Ht,Xt,!1,null,"739e59b8",null),ae=ee.exports,se=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"panel"},[t.showViewer?e("el-dialog",{attrs:{visible:t.showViewer,"append-to-body":!0,modal:!0,"show-close":!1,"close-on-click-modal":!0,"close-on-press-escape":!0,fullscreen:!0,"custom-class":"preview-dialog"},on:{"update:visible":function(e){t.showViewer=e},close:t.closeViewer}},[e("div",{staticClass:"preview-container",on:{click:function(e){return e.target!==e.currentTarget?null:t.closeViewer.apply(null,arguments)}}},[e("div",{staticClass:"preview-close",on:{click:t.closeViewer}},[e("i",{staticClass:"el-icon-close"})]),e("el-image",{staticClass:"preview-full-image",attrs:{src:t.previewUrl,fit:"contain"},on:{click:function(t){t.stopPropagation()}}})],1)]):t._e(),t.showImageEditor?e("div",{staticClass:"custom-dialog-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.handleEditorClose.apply(null,arguments)}}},[e("div",{staticClass:"custom-dialog"},[e("div",{staticClass:"custom-dialog-header"},[e("span",[t._v("图片编辑")]),e("i",{staticClass:"el-icon-close",on:{click:t.handleEditorClose}})]),e("div",{staticClass:"custom-dialog-body"},[e("div",{staticClass:"image-editor-container"},[e("div",{staticClass:"image-canvas-container"},[e("canvas",{ref:"imageCanvas",on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,mouseleave:t.handleMouseUp}})]),e("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入Prompt"},model:{value:t.editPrompt,callback:function(e){t.editPrompt=e},expression:"editPrompt"}})],1)]),e("div",{staticClass:"custom-dialog-footer"},[e("el-button",{on:{click:t.handleEditorClose}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleEditorConfirm}},[t._v("确 定")])],1)])]):t._e(),e("el-header",[e("h2",[t._v("AI绘图")])]),e("el-main",{ref:"mainContainer"},[e("div",{staticClass:"main-container"},[e("div",{staticClass:"left-panel"},[e("el-card",{staticClass:"setting-card"},[e("div",{staticClass:"setting-header",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("绘图设置")])]),e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"提示词",prop:"prompt",width:"80%",th:"100%"}},[e("el-input",{staticClass:"prompt-input",attrs:{type:"textarea",rows:3,placeholder:"请输入绘图提示词"},model:{value:t.formData.prompt,callback:function(e){t.$set(t.formData,"prompt",e)},expression:"formData.prompt"}})],1),e("el-form-item",{attrs:{label:"反向提示词"}},[e("el-input",{attrs:{type:"textarea",rows:2,placeholder:"可选，用于描述不想要的内容"},model:{value:t.formData.negativePrompt,callback:function(e){t.$set(t.formData,"negativePrompt",e)},expression:"formData.negativePrompt"}})],1),e("el-form-item",{attrs:{label:"模型选择",prop:"model"}},[e("el-select",{attrs:{placeholder:"请选择模型","popper-class":"draw-select-dropdown"},model:{value:t.formData.model,callback:function(e){t.$set(t.formData,"model",e)},expression:"formData.model"}},t._l(t.modelOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1),e("el-form-item",[e("el-button",{staticClass:"advanced-settings-btn",attrs:{type:"text"},on:{click:function(e){t.showAdvancedSettings=!0}}},[e("i",{staticClass:"el-icon-setting"}),t._v(" 高级设置 ")])],1),e("el-form-item",{staticClass:"submit-container"},[e("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading||t.permissionLoading,disabled:!t.hasPermission},on:{click:t.submitDrawing}},[t.loading||t.permissionLoading?t._e():e("i",{staticClass:"el-icon-picture-outline"}),e("span",[t._v(t._s(t.loading?"绘图中...":t.permissionLoading?"验证中...":t.hasPermission?"开始绘图":"无权限"))])])],1)],1)],1)],1),e("div",{staticClass:"right-panel"},[t.isMobile?e("div",{staticClass:"mobile-queue"},[e("div",{staticClass:"mobile-queue-header"},[e("div",{staticClass:"header-left"},[e("span",{staticClass:"queue-title"},[t._v("任务队列")]),e("el-tag",{attrs:{size:"small",type:"info"}},[t._v(t._s(t.taskQueue.length))])],1),e("el-button",{attrs:{type:"text",icon:"el-icon-refresh",loading:t.queueLoading},on:{click:t.fetchTaskQueue}},[t._v(" 刷新 ")])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.queueLoading,expression:"queueLoading"}],staticClass:"mobile-task-list"},t._l(t.taskQueue,(function(a){return e("div",{key:a.id,staticClass:"mobile-task-card",class:{"task-expanded":t.expandedRows.includes(a.id),"task-success":"SUCCESS"===a.status,"task-failed":"FAILED"===a.status,"task-locked":"🔒"===a.userId},on:{click:function(e){return t.handleRowClick(a)}}},[e("div",{staticClass:"task-main"},[e("div",{staticClass:"task-status-bar"},[e("div",{staticClass:"status-tags"},[e("el-tag",{attrs:{size:"mini",type:t.getStatusType(a.status)}},[t._v(" "+t._s(t.getStatusText(a.status))+" ")]),e("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(t.getActionText(a.action)))])],1),e("span",{staticClass:"task-time"},[t._v(t._s(t.formatTime(a.displays.submitTime)))])]),e("div",{staticClass:"task-content"},[e("div",{staticClass:"task-info"},[e("div",{staticClass:"task-prompt"},[t._v(t._s(a.prompt))]),"SUCCESS"!==a.status?e("el-progress",{attrs:{percentage:t.getProgressPercentage(a.progress),status:t.getProgressStatus(a.status),"stroke-width":4}}):t._e()],1),a.imageUrl&&t.expandedRows.includes(a.id)?e("div",{staticClass:"task-preview"},[e("el-image",{staticClass:"preview-thumbnail",attrs:{src:a.imageUrl,fit:"cover"},on:{click:function(e){return e.stopPropagation(),t.handlePreviewImage(a.imageUrl)}}},[e("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[e("i",{staticClass:"el-icon-loading"})])])],1):t._e()])]),e("transition",{attrs:{name:"slide-fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.expandedRows.includes(a.id),expression:"expandedRows.includes(task.id)"}],staticClass:"task-actions"},[a.buttons&&a.buttons.some((t=>t.customId.includes("upsample")))?e("div",{staticClass:"action-group"},[e("el-button-group",t._l(a.buttons.filter((t=>t.customId.includes("upsample"))),(function(s){return e("el-button",{key:s.customId,attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a)}}},[t._v(" "+t._s(s.label)+" ")])})),1)],1):t._e(),a.buttons&&a.buttons.some((t=>t.customId.includes("variation")))?e("div",{staticClass:"action-group"},[e("el-button-group",t._l(a.buttons.filter((t=>t.customId.includes("variation"))),(function(s){return e("el-button",{key:s.customId,attrs:{size:"mini",type:"info",plain:""},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a)}}},[t._v(" "+t._s(s.label)+" ")])})),1)],1):t._e(),a.buttons&&a.buttons.some((t=>t.customId.includes("Outpaint")||t.customId.includes("CustomZoom")))?e("div",{staticClass:"action-group"},[e("el-button-group",t._l(a.buttons.filter((t=>t.customId.includes("Outpaint")||t.customId.includes("CustomZoom"))),(function(s){return e("el-button",{key:s.customId,attrs:{size:"mini",type:"warning",plain:""},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a)}}},[t._v(" "+t._s(s.label)+" ")])})),1)],1):t._e(),a.buttons&&a.buttons.some((t=>t.customId.includes("pan")))?e("div",{staticClass:"action-group"},[e("el-button-group",t._l(a.buttons.filter((t=>t.customId.includes("pan"))),(function(s){return e("el-button",{key:s.customId,attrs:{size:"mini",type:"success",plain:""},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a)}}},[t._v(" "+t._s(s.emoji)+" ")])})),1)],1):t._e(),a.buttons&&a.buttons.some((t=>t.customId.includes("BOOKMARK")))?e("div",{staticClass:"action-group"},[e("el-button-group",t._l(a.buttons.filter((t=>t.customId.includes("BOOKMARK"))),(function(s){return e("el-button",{key:s.customId,attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a)}}},[t._v(" "+t._s(s.emoji)+" ")])})),1)],1):t._e(),e("div",{staticClass:"action-group"},[e("el-button-group",[a.imageUrl?e("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(e){return e.stopPropagation(),t.downloadImage(a.imageUrl)}}},[e("i",{staticClass:"el-icon-download"})]):t._e(),t.canCancel(a.status)?e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return e.stopPropagation(),t.handleCancel(a)}}},[e("i",{staticClass:"el-icon-close"})]):t._e()],1)],1),a.buttons&&a.buttons.some((t=>t.customId.includes("Inpaint")))?[e("el-button-group",t._l(a.buttons.filter((t=>t.customId.includes("Inpaint"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn inpaint",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(s.label)+" ")])})),1)]:t._e()],2)])],1)})),0),e("div",{staticClass:"mobile-pagination"},[e("el-pagination",{attrs:{"current-page":t.pagination.current,"page-size":t.pagination.pageSize,layout:"prev, pager, next",total:t.pagination.total},on:{"current-change":t.handlePageChange}})],1)]):e("div",{staticClass:"queue-card"},[e("div",{staticClass:"queue-header"},[e("span",[t._v("任务队列 ("+t._s(t.taskQueue.length)+")")]),e("el-button",{staticClass:"refresh-btn",attrs:{type:"text",icon:"el-icon-refresh",loading:t.queueLoading},on:{click:t.fetchTaskQueue}},[t._v(" 刷新 ")])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.queueLoading,expression:"queueLoading"}],staticStyle:{width:"100%"},attrs:{data:t.taskQueue,"max-height":500,"expand-row-keys":t.expandedRows,"row-key":t=>t.id,"row-class-name":t.getRowClassName,expandable:t.canExpand},on:{"row-click":t.handleRowClick}},[e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"expanded-row",nativeOn:{click:function(e){e.stopPropagation(),"🔒"===a.row.userId&&t.$message.warning("无权查看该任务详情")}}},["🔒"!==a.row.userId?e("div",{staticClass:"expanded-content"},[e("div",{staticClass:"expanded-image"},[a.row.imageUrl?e("el-image",{staticClass:"preview-image",attrs:{src:a.row.imageUrl,fit:"contain"},on:{click:function(e){return t.handlePreviewImage(a.row.imageUrl)}}},[e("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[e("i",{staticClass:"el-icon-loading"})]),e("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]):t._e()],1),e("div",{staticClass:"expanded-prompt"},[e("div",{staticClass:"label"},[t._v("提示词")]),e("div",{staticClass:"content"},[t._v(t._s(a.row.prompt))])]),e("div",{staticClass:"expanded-actions"},[a.row.buttons&&a.row.buttons.some((t=>t.customId.includes("upsample")))?t._l(a.row.buttons.filter((t=>t.customId.includes("upsample"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn upscale",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a.row)}}},[e("i",{staticClass:"el-icon-zoom-in"}),t._v(" "+t._s(s.label)+" ")])})):t._e(),a.row.buttons&&a.row.buttons.some((t=>t.customId.includes("variation")))?t._l(a.row.buttons.filter((t=>t.customId.includes("variation"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn variation",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a.row)}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" "+t._s(s.label)+" ")])})):t._e(),a.row.buttons&&a.row.buttons.some((t=>t.customId.includes("Inpaint")))?t._l(a.row.buttons.filter((t=>t.customId.includes("Inpaint"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn inpaint",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a.row)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(s.label)+" ")])})):t._e(),a.row.buttons&&a.row.buttons.some((t=>t.customId.includes("Outpaint")||t.customId.includes("CustomZoom")))?t._l(a.row.buttons.filter((t=>t.customId.includes("Outpaint")||t.customId.includes("CustomZoom"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn zoom",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a.row)}}},[e("i",{staticClass:"el-icon-zoom-out"}),t._v(" "+t._s(s.label)+" ")])})):t._e(),a.row.buttons&&a.row.buttons.some((t=>t.customId.includes("pan")))?t._l(a.row.buttons.filter((t=>t.customId.includes("pan"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn pan",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a.row)}}},[t._v(" "+t._s(s.emoji)+" ")])})):t._e(),a.row.buttons&&a.row.buttons.some((t=>t.customId.includes("BOOKMARK")))?t._l(a.row.buttons.filter((t=>t.customId.includes("BOOKMARK"))),(function(s){return e("el-button",{key:s.customId,staticClass:"action-btn bookmark",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleButtonAction(s,a.row)}}},[t._v(" "+t._s(s.emoji)+" ")])})):t._e(),a.row.imageUrl?e("el-button",{staticClass:"action-btn download",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.downloadImage(a.row.imageUrl)}}},[e("i",{staticClass:"el-icon-download"}),t._v(" 下载 ")]):t._e(),t.canCancel(a.row.status)?e("el-button",{staticClass:"action-btn cancel",attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleCancel(a.row)}}},[e("i",{staticClass:"el-icon-close"}),t._v(" 取消 ")]):t._e()],2)]):t._e()])]}}],null,!1,1145224102)}),e("el-table-column",{attrs:{prop:"prompt",label:"提示词",width:"180",align:"left","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"action",label:"类型",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{size:"small",type:"info"}},[t._v(" "+t._s(t.getActionText(a.row.action))+" ")])]}}],null,!1,561425344)}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getStatusType(a.row.status)}},[t._v(" "+t._s(t.getStatusText(a.row.status))+" ")])]}}],null,!1,2263538733)}),e("el-table-column",{attrs:{label:"提交时间",width:"160",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{attrs:{content:a.row.displays.submitTime,placement:"top"}},[e("span",[t._v(t._s(t.formatTime(a.row.displays.submitTime)))])])]}}],null,!1,379863814)}),e("el-table-column",{attrs:{label:"进度",width:"220",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-progress",{attrs:{percentage:t.getProgressPercentage(a.row.progress),status:t.getProgressStatus(a.row.status)}})]}}],null,!1,3678436751)})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{"current-page":t.pagination.current,"page-sizes":[8,16,24],"page-size":t.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handlePageChange}})],1)],1)])]),!t.isMobile&&t.drawingResults.length>0?e("div",{staticClass:"pc-view"},[e("el-card",{staticClass:"result-card"},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v("绘图结果")])]),e("el-row",{attrs:{gutter:20}},t._l(t.drawingResults,(function(a,s){return e("el-col",{key:s,staticClass:"result-col",attrs:{xs:24,sm:12,md:8,lg:6}},[e("el-card",{staticClass:"image-card",attrs:{shadow:"hover"}},[e("el-image",{staticClass:"result-image",attrs:{src:a.imageUrl,fit:"contain"}},[e("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]),e("div",{staticClass:"image-actions"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.downloadImage(a.imageUrl)}}},[e("i",{staticClass:"el-icon-download"}),t._v(" 下载 ")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.variateImage(a.imageUrl,a.taskId)}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 变体 ")])],1),e("div",{staticClass:"prompt-text"},[t._v(t._s(a.prompt))])],1)],1)})),1)],1)],1):t._e(),t.isMobile&&t.drawingResults.length>0?e("div",{staticClass:"mobile-view"},t._l(t.drawingResults,(function(a,s){return e("div",{key:s,staticClass:"mobile-card"},[e("div",{staticClass:"mobile-card-content"},[e("el-image",{staticClass:"mobile-image",attrs:{src:a.imageUrl,fit:"contain"}},[e("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]),e("div",{staticClass:"prompt-badge"},[e("i",{staticClass:"el-icon-chat-line-square"}),t._v(" "+t._s(a.prompt)+" ")])],1),e("div",{staticClass:"mobile-card-divider"}),e("div",{staticClass:"mobile-card-actions"},[e("div",{staticClass:"action-row"},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.downloadImage(a.imageUrl)}}},[e("i",{staticClass:"el-icon-download"}),t._v(" 下载 ")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.variateImage(a.imageUrl,a.taskId)}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 变体 ")])],1)])])})),0):t._e(),t.isMobile?e("el-backtop",{staticClass:"mobile-backtop",attrs:{right:16,bottom:16,target:".el-main"}},[e("i",{staticClass:"el-icon-arrow-up"})]):t._e(),e("el-drawer",{attrs:{title:"高级设置",visible:t.showAdvancedSettings,direction:"rtl",size:"400px","before-close":t.handleAdvancedSettingsClose,"custom-class":"advanced-settings-drawer"},on:{"update:visible":function(e){t.showAdvancedSettings=e}}},[e("div",{staticClass:"advanced-settings-form"},[e("div",{staticClass:"form-content"},[e("div",{staticClass:"settings-group"},[e("div",{staticClass:"group-title"},[e("i",{staticClass:"el-icon-setting"}),e("span",[t._v("基础设置")])]),e("el-form",{attrs:{model:t.formData,"label-position":"top","label-width":"auto"}},[e("el-form-item",{attrs:{label:"宽高比例"}},[e("el-select",{attrs:{placeholder:"选择宽高比例"},model:{value:t.formData.aspectRatio,callback:function(e){t.$set(t.formData,"aspectRatio",e)},expression:"formData.aspectRatio"}},[e("el-option",{attrs:{label:"默认",value:""}}),e("el-option",{attrs:{label:"16:9",value:"--ar 16:9"}}),e("el-option",{attrs:{label:"4:3",value:"--ar 4:3"}}),e("el-option",{attrs:{label:"1:1",value:"--ar 1:1"}}),e("el-option",{attrs:{label:"9:16",value:"--ar 9:16"}})],1)],1),e("el-form-item",{attrs:{label:"文本权重"}},[e("el-select",{attrs:{placeholder:"设置文本权重"},model:{value:t.formData.imageWeight,callback:function(e){t.$set(t.formData,"imageWeight",e)},expression:"formData.imageWeight"}},[e("el-option",{attrs:{label:"默认(0.25)",value:""}}),e("el-option",{attrs:{label:"0.5",value:"--iw 0.5"}}),e("el-option",{attrs:{label:"1.0",value:"--iw 1"}}),e("el-option",{attrs:{label:"2.0",value:"--iw 2"}})],1)],1)],1)],1),e("div",{staticClass:"settings-group"},[e("div",{staticClass:"group-title"},[e("i",{staticClass:"el-icon-magic-stick"}),e("span",[t._v("高级设置")])]),e("el-form",{attrs:{model:t.formData,"label-position":"top","label-width":"auto"}},[e("el-form-item",{attrs:{label:"随机种子"}},[e("el-input-number",{attrs:{min:0,max:4294967295,placeholder:"输入随机种子"},model:{value:t.formData.seed,callback:function(e){t.$set(t.formData,"seed",e)},expression:"formData.seed"}})],1),e("el-form-item",{attrs:{label:"渲染质量"}},[e("el-select",{attrs:{placeholder:"选择渲染质量"},model:{value:t.formData.quality,callback:function(e){t.$set(t.formData,"quality",e)},expression:"formData.quality"}},[e("el-option",{attrs:{label:"默认(1.0)",value:""}}),e("el-option",{attrs:{label:"0.25",value:"--quality 0.25"}}),e("el-option",{attrs:{label:"0.5",value:"--quality 0.5"}}),e("el-option",{attrs:{label:"2.0",value:"--quality 2"}})],1)],1),e("el-form-item",{attrs:{label:"风格强度"}},[e("el-slider",{attrs:{min:0,max:1e3,step:10},model:{value:t.formData.stylize,callback:function(e){t.$set(t.formData,"stylize",e)},expression:"formData.stylize"}})],1),e("el-form-item",{attrs:{label:"多样性"}},[e("el-slider",{attrs:{min:0,max:100},model:{value:t.formData.chaos,callback:function(e){t.$set(t.formData,"chaos",e)},expression:"formData.chaos"}})],1)],1)],1),e("div",{staticClass:"settings-group"},[e("div",{staticClass:"group-title"},[e("i",{staticClass:"el-icon-star-off"}),e("span",[t._v("特殊选项")])]),e("el-form",{attrs:{model:t.formData,"label-position":"top","label-width":"auto"}},[e("el-form-item",[e("el-checkbox-group",{model:{value:t.formData.specialOptions,callback:function(e){t.$set(t.formData,"specialOptions",e)},expression:"formData.specialOptions"}},[e("el-checkbox",{attrs:{label:"--sameseed"}},[t._v("使用相同种子")]),e("el-checkbox",{attrs:{label:"--upbeta"}},[t._v("Beta放大工具")]),e("el-checkbox",{attrs:{label:"--uplight"}},[t._v("轻量化处理")]),e("el-checkbox",{attrs:{label:"--niji"}},[t._v("动漫风格")]),e("el-checkbox",{attrs:{label:"--hd"}},[t._v("高清模式")]),e("el-checkbox",{attrs:{label:"--tile"}},[t._v("平铺模式")])],1)],1)],1)],1)]),e("div",{staticClass:"form-footer"},[e("div",{staticClass:"footer-left"},[e("span",[t._v("设置将在下次绘图时生效")])]),e("div",{staticClass:"footer-right"},[e("el-button",{attrs:{size:"small"},on:{click:t.clearAdvancedSettings}},[t._v(" 重置设置 ")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.showAdvancedSettings=!1}}},[t._v(" 确定 ")])],1)])])])],1)],1)},ie=[],oe={name:"DrawPage",data(){return{loading:!1,permissionLoading:!1,isMobile:!1,hasPermission:!1,expandedRows:[],formData:{prompt:"",negativePrompt:"",model:"MJ_V6",speed:"FAST",aspectRatio:"",imageWeight:"",seed:"",quality:"",stylize:0,chaos:0,specialOptions:[]},rules:{prompt:[{required:!0,message:"请输入提示词",trigger:"blur"}],model:[{required:!0,message:"请选择模型",trigger:"change"}]},modelOptions:[{value:"MJ_V6",text:"MJ V6"},{value:"MJ_V5.2",text:"MJ V5.2"}],speedOptions:[{value:"FAST",text:"快速"},{value:"RELAX",text:"标准"}],drawingResults:[],taskId:null,checkInterval:null,taskQueue:[],queueLoading:!1,queueTimer:null,activeCollapse:["queue"],mjApiSecret:null,showViewer:!1,previewUrl:"",pagination:{current:1,pageSize:8,total:0},showAdvancedSettings:!1,showImageEditor:!1,selectedTool:"rectangle",editPrompt:"",isDrawing:!1,startX:0,startY:0,currentTask:null,maskBase64:"",originalImage:null,selectionRect:{x:0,y:0,width:0,height:0},finalSelectionRect:null}},methods:{checkMobile(){this.isMobile=window.innerWidth<=768},async getUserInfo(){try{const e=await k.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(e.data.status){this.permissionLoading=!0,this.mjApiSecret=e.data.data.apiKey;try{const t=await k.get(`${v.apiBaseUrl}/mj/users`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),a=e.data.data.username,s=t.data.data.list||[],i=s.find((t=>t.name===a)),o=i.status;"NORMAL"===o?(this.hasPermission=!0,await this.fetchTaskQueue()):(C.error("您没有AI绘图的权限"),this.hasPermission=!1)}catch(t){console.log("AI绘图块权限验证失败:",t),this.hasPermission=!1}finally{this.permissionLoading=!1}}else C.error("获取用户信息失败")}catch(t){console.error("获取用户信息失败:",t),C.handleError(t)}},async fetchTaskQueue(){if(!this.queueLoading){this.queueLoading=!0;try{const t=await k.get(`${v.apiBaseUrl}/mj/tasks?page=`+this.pagination.current+"&size="+this.pagination.pageSize,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});200===t.status&&t.data.data.list?(this.taskQueue=t.data.data.list.map((t=>({...t,displays:t.displays||{submitTime:new Date(t.submitTime).toLocaleString(),finishTime:t.finishTime?new Date(t.finishTime).toLocaleString():"",status:t.status,action:t.action}}))),this.pagination.total=t.data.data.pagination.total):(console.error("任务列表数据格式不正确:",t.data.data),C.error("获取任务队列失败"))}catch(t){console.error("获取任务列表失败:",t),C.handleError(t)}finally{this.queueLoading=!1}}},startQueueTimer(){this.stopQueueTimer();let t=0;const e=7;this.queueTimer=setInterval((async()=>{t++,await this.fetchTaskQueue();const a=this.taskQueue.some((t=>!["SUCCESS","FAILURE","CANCEL"].includes(t.status)));(t>=e||!a)&&(this.stopQueueTimer(),console.log("停止轮询：",t>=e?"达到最大刷新次数":"所有任务已完成"))}),5e3)},stopQueueTimer(){this.queueTimer&&(clearInterval(this.queueTimer),this.queueTimer=null)},getStatusType(t){const e={NOT_START:"info",SUBMITTED:"info",IN_PROGRESS:"warning",SUCCESS:"success",FAILURE:"danger",MODAL:"warning",CANCEL:"info"};return e[t]||"info"},getStatusText(t){const e={NOT_START:"未开始",SUBMITTED:"已提交",IN_PROGRESS:"进行中",SUCCESS:"已完成",FAILURE:"失败",MODAL:"等待中",CANCEL:"取消"};return e[t]||t},getProgressStatus(t){return"SUCCESS"===t?"success":"FAILURE"===t?"exception":"CANCEL"===t?"warning":""},getProgressPercentage(t){if(!t)return 0;const e=t.match(/(\d+)%/);return e?parseInt(e[1]):0},canCancel(t){return["NOT_START","SUBMITTED","IN_PROGRESS","MODAL"].includes(t)},async cancelTask(t){try{const e=await k.post(`${v.mjBaseUrl}/mj/task/${t}/cancel`,null,{headers:{"mj-api-secret":this.mjApiSecret}});if(200===e.status){const a=e.data;if("CANCEL"===a.status){C.success("任务已取消");const e=this.taskQueue.findIndex((e=>e.id===t));-1!==e&&(this.taskQueue[e]={...this.taskQueue[e],...a,displays:{...this.taskQueue[e].displays,status:a.status}})}else C.warning(`取消失败: ${a.failReason||"未知原因"}`);await this.fetchTaskQueue()}else C.error("取消任务失败：返回数据为空")}catch(e){console.error("取消任务失败:",e),C.handleError(e)}},async submitDrawing(){try{if(!this.hasPermission)return void C.error("您没有AI绘图的权限");const t=await this.$refs.form.validate();if(!t)return;this.loading=!0;let e=this.formData.prompt;this.formData.aspectRatio&&(e+=" "+this.formData.aspectRatio),this.formData.imageWeight&&(e+=" "+this.formData.imageWeight),this.formData.seed&&(e+=` --seed ${this.formData.seed}`),this.formData.quality&&(e+=" "+this.formData.quality),this.formData.stylize>0&&(e+=` --stylize ${this.formData.stylize}`),this.formData.chaos>0&&(e+=` --chaos ${this.formData.chaos}`),this.formData.specialOptions.forEach((t=>{e+=" "+t}));const a=await k.post(`${v.mjBaseUrl}/mj/submit/imagine`,{prompt:e,negativePrompt:this.formData.negativePrompt||"",model:this.formData.model,notifyHook:"",state:""},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&1===a.data.code?(this.taskId=a.data.result,C.success(a.data.description||"提交成功，正在生成..."),await this.fetchTaskQueue(),this.startQueueTimer()):C.error(a.data?.description||"提交失败")}catch(t){C.handleError(t)}finally{this.loading=!1}},async checkProgress(){if(this.taskId)try{const t=await k.get(`${v.mjBaseUrl}/mj/task/fetch/${this.taskId}`,{headers:{"mj-api-secret":this.mjApiSecret}});if(t.data){const e=t.data;"SUCCESS"===e.status?(this.drawingResults.unshift({imageUrl:e.imageUrl,prompt:e.prompt,taskId:this.taskId}),this.stopCheckingProgress(),C.success("生成完成"),await this.fetchTaskQueue()):"FAILURE"===e.status&&(this.stopCheckingProgress(),C.error(e.failReason||"生成失败"))}}catch(t){console.error("检查进度失败:",t)}},startCheckingProgress(){this.checkInterval=setInterval(this.checkProgress,3e3)},stopCheckingProgress(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)},async downloadImage(t){try{window.open(t,"_blank")}catch(e){console.error("打开图片失败:",e),C.error("打开失败")}},async variateImage(t,e){try{this.loading=!0;const t=await k.post(`${v.mjBaseUrl}/mj/submit/change`,{taskId:e,action:"VARIATION",index:1,notifyHook:"",state:""},{headers:{"mj-api-secret":this.mjApiSecret}});t.data&&t.data.id?(this.taskId=t.data.id,C.success("变体生成已提交"),this.startCheckingProgress(),await this.fetchTaskQueue(),this.startQueueTimer()):C.error(t.data?.failReason||"提交失败")}catch(a){C.handleError(a)}finally{this.loading=!1}},getActionText(t){const e={IMAGINE:"绘图",UPSCALE:"放大",VARIATION:"变体",REROLL:"重绘"};return e[t]||t},previewImage(t){this.$alert(`<div style="text-align: center">\n                    <img src="${t.imageUrl}" style="max-width: 100%; max-height: 500px;">\n                    <p style="margin-top: 10px">${t.prompt||""}</p>\n                    <p style="margin-top: 5px; color: #666;">提交时间：${t.displays?.submitTime||""}</p>\n                    <p style="margin-top: 5px; color: #666;">完成时间：${t.displays?.finishTime||""}</p>\n                </div>`,"图片预览",{dangerouslyUseHTMLString:!0,customClass:"image-preview-dialog",showClose:!0,callback:()=>{},beforeClose:(t,e,a)=>{a()}}).catch((t=>{"cancel"!==t&&"close"!==t&&console.error("预览对话框错误:",t)}))},handleRowClick(t){"🔒"!==t.userId?this.expandedRows.includes(t.id)?this.expandedRows=[]:this.expandedRows=[t.id]:this.$message.warning("无权查看该任务详情")},getButtonIcon(t){const e={PREVIEW:"el-icon-view",DOWNLOAD:"el-icon-download",UPSCALE:"el-icon-zoom-in",VARIATION:"el-icon-refresh",REROLL:"el-icon-refresh-right",CANCEL:"el-icon-close",INPAINT:"el-icon-edit"};return e[t]||"el-icon-more"},async handleButtonAction(t,e){try{if(this.loading=!0,t.customId.includes("Inpaint")){try{const a=await k.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&21===a.data.code?(this.currentTask=e,this.editPrompt=e.prompt,this.showImageEditor=!0,this.currentTask.modalTaskId=a.data.result,this.$nextTick((()=>{console.log("Initializing canvas with image:",e.imageUrl),this.initializeCanvas(e.imageUrl)}))):this.$message.error(a.data?.description||"操作失败")}catch(a){console.error("Inpaint action error:",a),this.$message.error("操作失败，请重试")}return}if(t.customId.includes("upsample")||t.customId.includes("reroll")||t.customId.includes("variation")||t.customId.includes("BOOKMARK")||t.customId.includes("Outpaint")){try{const a=await k.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&1===a.data.code?(this.$message.success("操作成功"),await this.fetchTaskQueue()):this.$message.error(a.data?.description||"操作失败")}catch(a){C.handleError(a)}return}if(t.customId.includes("pan")){try{const s=await k.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});if(s.data&&21===s.data.code){const i=t.customId.includes("pan_left")?"向左平移":t.customId.includes("pan_right")?"向右平移":t.customId.includes("pan_up")?"向上平移":"向下平移";this.$prompt(`请输入${i}的提示词`,"平移设置",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入提示词",inputValue:s.data.properties?.finalPrompt||e.prompt,inputValidator:t=>!(!t||""===t.trim())||"提示词不能为空"}).then((async({value:t})=>{try{const e=await k.post(`${v.mjBaseUrl}/mj/submit/modal`,{taskId:s.data.result,prompt:t},{headers:{"mj-api-secret":this.mjApiSecret}});e.data&&1===e.data.code?(C.success("平移操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):C.error(e.data?.description||"提交失败")}catch(a){C.handleError(a)}})).catch((()=>{}))}else s.data&&1===s.data.code?(this.taskId=s.data.result,C.success("平移操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):C.error(s.data?.description||"提交失败")}catch(a){C.handleError(a)}return}if(t.customId.includes("CustomZoom")){try{const s=await k.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});if(s.data&&21===s.data.code){const i=t.customId.includes("CustomZoom")?"缩放":"";this.$prompt(`请输入${i}的提示词`,"设置",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入提示词",inputValue:s.data.properties?.finalPrompt||e.prompt,inputValidator:t=>!(!t||""===t.trim())||"提示词不能为空"}).then((async({value:t})=>{try{const e=await k.post(`${v.mjBaseUrl}/mj/submit/modal`,{taskId:s.data.result,prompt:t},{headers:{"mj-api-secret":this.mjApiSecret}});e.data&&1===e.data.code?(C.success("操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):C.error(e.data?.description||"提交失败")}catch(a){C.handleError(a)}})).catch((()=>{}))}else s.data&&1===s.data.code?(this.taskId=s.data.result,C.success("平移操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):C.error(s.data?.description||"提交失败")}catch(a){C.handleError(a)}return}}catch(a){console.error("Button action error:",a),this.$message.error("操作失败，请重试")}finally{this.loading=!1}},copyTaskId(t){const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),C.success("任务ID已复制")},formatTime(t){if(!t)return"";const e=new Date(t),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${a}-${s} ${i}:${o}`},handlePreviewImage(t){t&&(this.previewUrl=t,this.showViewer=!0)},closeViewer(){this.showViewer=!1,this.previewUrl=""},handlePageChange(t){this.pagination.current=t,this.fetchTaskQueue()},handleSizeChange(t){this.pagination.pageSize=t,this.pagination.current=1,this.fetchTaskQueue()},handleAdvancedSettingsClose(t){t()},clearAdvancedSettings(){this.formData.aspectRatio="",this.formData.imageWeight="",this.formData.seed="",this.formData.quality="",this.formData.stylize=0,this.formData.chaos=0,this.formData.specialOptions=[],this.$message.success("已清空所有高级设置")},getRowClassName({row:t}){const e=[];return"🔒"===t.userId&&(e.push("locked-row"),e.push("hide-expand")),e.join(" ")},renderImageEditor(t,e){return t("div",{class:"image-editor-container"},[t("div",{class:"image-canvas-container"},[t("canvas",{ref:"imageCanvas",style:{maxWidth:"100%",border:"1px solid #ddd"},on:{mousedown:this.handleMouseDown,mousemove:this.handleMouseMove,mouseup:this.handleMouseUp,mouseleave:this.handleMouseUp},hook:{insert:t=>{const a=t.elm,s=a.getContext("2d"),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{a.width=i.width,a.height=i.height,s.drawImage(i,0,0),this.originalImage=i},i.src=e.imageUrl}}})]),t("el-input",{props:{type:"textarea",rows:3,placeholder:"请输入Prompt",value:this.editPrompt||e.prompt},on:{input:t=>this.editPrompt=t}})])},handleMouseDown(t){const e=this.$refs.imageCanvas,a=e.getBoundingClientRect(),s=e.width/a.width,i=e.height/a.height;this.isDrawing=!0,this.startX=(t.clientX-a.left)*s,this.startY=(t.clientY-a.top)*i,this.selectionRect={x:this.startX,y:this.startY,width:0,height:0}},handleMouseMove(t){if(!this.isDrawing||!this.originalImage)return;const e=this.$refs.imageCanvas,a=e.getBoundingClientRect(),s=e.width/a.width,i=e.height/a.height,o=(t.clientX-a.left)*s,n=(t.clientY-a.top)*i;this.selectionRect={x:Math.min(this.startX,o),y:Math.min(this.startY,n),width:Math.abs(o-this.startX),height:Math.abs(n-this.startY)},this.redrawCanvas()},handleMouseUp(){this.isDrawing=!1,this.finalSelectionRect={...this.selectionRect}},redrawCanvas(){const t=this.$refs.imageCanvas;if(!t||!this.originalImage)return;const e=t.getContext("2d");e.save(),e.clearRect(0,0,t.width,t.height),e.drawImage(this.originalImage,0,0,t.width,t.height),this.selectionRect.width>0&&this.selectionRect.height>0&&(e.strokeStyle="#9254de",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(this.selectionRect.x,this.selectionRect.y,this.selectionRect.width,this.selectionRect.height),e.setLineDash([]),this.drawControlPoints()),e.restore()},drawControlPoints(){const t=this.$refs.imageCanvas,e=t.getContext("2d"),a=6,s=[{x:this.selectionRect.x,y:this.selectionRect.y},{x:this.selectionRect.x+this.selectionRect.width,y:this.selectionRect.y},{x:this.selectionRect.x,y:this.selectionRect.y+this.selectionRect.height},{x:this.selectionRect.x+this.selectionRect.width,y:this.selectionRect.y+this.selectionRect.height}];e.fillStyle="#9254de",s.forEach((t=>{e.beginPath(),e.arc(t.x,t.y,a,0,2*Math.PI),e.fill()}))},resetEditor(){if(this.isDrawing=!1,this.startX=0,this.startY=0,this.selectionRect={x:0,y:0,width:0,height:0},this.finalSelectionRect=null,this.editPrompt="",this.maskBase64="",this.originalImage=null,this.$refs.imageCanvas){const t=this.$refs.imageCanvas.getContext("2d");t.clearRect(0,0,this.$refs.imageCanvas.width,this.$refs.imageCanvas.height)}},generateMask(t){try{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d");return a.fillStyle="black",a.fillRect(0,0,e.width,e.height),this.finalSelectionRect&&(a.fillStyle="white",a.fillRect(this.finalSelectionRect.x,this.finalSelectionRect.y,this.finalSelectionRect.width,this.finalSelectionRect.height)),e.toDataURL("image/png").split(",")[1]}catch(e){throw console.error("生成遮罩失败:",e),new Error("生成遮罩失败，请重试")}},handleEditorClose(t){this.$confirm("确认关闭？未保存的更改将会丢失","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.resetEditor(),this.showImageEditor=!1,t()})).catch((()=>{}))},async handleEditorConfirm(){try{if(!this.editPrompt.trim())return void this.$message.warning("请输入提示词");const t=this.$refs.imageCanvas,e=this.generateMask(t);this.maskBase64=e,this.loading=!0;const a=await k.post(`${v.mjBaseUrl}/mj/submit/modal`,{taskId:this.currentTask.modalTaskId,prompt:this.editPrompt,maskBase64:"data:image/png;base64,"+this.maskBase64},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&1===a.data.code?(this.$message.success("Inpaint 操作已提交"),this.showImageEditor=!1,this.$emit("editor-closed"),await this.fetchTaskQueue(),this.startQueueTimer()):this.$message.error(a.data?.description||"提交失败")}catch(t){console.error("Inpaint 提交失败:",t),this.$message.error(t.response?.data?.description||"提交失败，请重试")}finally{this.loading=!1,this.resetEditor()}},initializeCanvas(t){const e=this.$refs.imageCanvas;if(!e)return void console.error("Canvas element not found");const a=new Image;a.onload=()=>{const t=400,s=300,i=t/a.width,o=s/a.height,n=Math.min(i,o),l=a.width*n,r=a.height*n;e.width=l,e.height=r;const c=e.getContext("2d");c.clearRect(0,0,e.width,e.height),c.drawImage(a,0,0,l,r),this.originalImage=a,this.redrawCanvas(),console.log("Canvas initialized with dimensions:",{width:l,height:r,scale:n,originalWidth:a.width,originalHeight:a.height})},a.onerror=t=>{console.error("Error loading image:",t),this.$message.error("图片加载失败，请重试")},a.src=t}},mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile),this.getUserInfo()},beforeDestroy(){this.stopCheckingProgress(),window.removeEventListener("resize",this.checkMobile)},computed:{canExpand(){return t=>"🔒"!==t.userId}}},ne=oe,le=(0,r.A)(ne,se,ie,!1,null,"7bb5d27d",null),re=le.exports,ce={components:{EnhancedDialog:ut,FormInput:ot},name:"NaviPage",data(){return{mjApiSecret:null,isMenuVisible:!1,touchStartX:0,touchStartY:0,swipeWidth:30,isMobile:!1,avatar:"img/linuxdo.webp",activeMenu:"accountNav",currentComponent:xt,modalVisible:!1,resetModalVisible:!1,itemData:"",modalTitle:"",isCollapse:!0,showDrawModule:!1,formFields:[{id:"code",label:"兑换码",type:"text",value:"",required:!0}],resetFormFields:[{id:"oldPassword",label:"旧密码",type:"password",value:"",required:!0},{id:"newPassword",label:"新密码",type:"password",value:"",required:!0},{id:"confirmPassword",label:"确认新密码",type:"password",value:"",required:!0}],resetFormData:{oldPassword:"",newPassword:"",confirmPassword:""}}},computed:{getSidebarWidth(){return this.isMobile?this.isCollapse?"0":"240px":this.isCollapse?"66px":"240px"}},methods:{async getUserInfo(){try{const t=await k.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log(t.data.data.apiKey),t.data.status?this.mjApiSecret=t.data.data.apiKey:C.error("获取用户信息失败")}catch(t){console.error("获取用户信息失败:",t),C.handleError(t)}},toggleMenu(){this.isMenuVisible=!this.isMenuVisible},handleClickOutside(t){const e=document.querySelector(".user-menu-container");e&&!e.contains(t.target)&&(this.isMenuVisible=!1)},checkMobile(){this.isMobile=window.innerWidth<=768,this.isMobile&&(this.isCollapse=!0)},toggleCollapse(){this.isCollapse=!this.isCollapse},loadAvatar(){const t=localStorage.getItem("img");t&&(this.avatar=t)},handleUpdateValue(t,e){this.itemData=e;const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},handleResetUpdateValue(t,e){this.resetFormData[t]=e;const a=this.resetFormFields.findIndex((e=>e.id===t));-1!==a&&(this.resetFormFields[a].value=e)},showModal(){this.modalTitle="兑换码激活",this.resetFormField(),this.modalVisible=!0},showResetModal(){this.resetModalVisible=!0},closeModal(){this.modalVisible=!1},closeResetModal(){this.resetModalVisible=!1,this.resetFormData={oldPassword:"",newPassword:"",confirmPassword:""}},async submitForm(){const t=await k.get(`${v.apiBaseUrl}/redemption/activate?code=`+this.itemData,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?(this.modalVisible=!1,C.success("兑换成功")):C.error(t.data.message)},async submitResetForm(){try{if(this.resetFormData.newPassword!==this.resetFormData.confirmPassword)return void C.error("两次输入的新密码不一致");const t=await k.post(`${v.apiBaseUrl}/user/reset`,{oldPassword:this.resetFormData.oldPassword,newPassword:this.resetFormData.newPassword,confirmPassword:this.resetFormData.confirmPassword},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?(C.success("密码重置成功"),this.closeResetModal()):C.error(t.data.message),this.resetFormData={oldPassword:"",newPassword:"",confirmPassword:""}}catch(t){C.error("密码重置失败")}},resetFormField(){this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},handleMenuSelect(t){switch(this.activeMenu=t,this.isMobile&&(this.isCollapse=!0),this.activeMenu=t,t){case"accountNav":this.currentComponent=xt;break;case"shareNav":this.currentComponent=Vt;break;case"redemptionNav":this.currentComponent=Yt;break;case"carNav":this.currentComponent=ae;break;case"freeNav":this.currentComponent=Ot;break;case"drawNav":this.showDrawModule?this.currentComponent=re:C.error("您没有AI绘图模块的访问权限");break;default:this.currentComponent=Vt}},logout(){this.$router.replace({name:"home"}),localStorage.removeItem("token"),localStorage.removeItem("img")},async checkUserPermission(){try{const e=await k.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.data.status)return C.error("获取用户信息失败"),void this.$router.replace({name:"home"});this.mjApiSecret=e.data.data.apiKey;try{const t=await k.get(`${v.apiBaseUrl}/mj/users`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),a=e.data.data.username;console.log(a);const s=t.data.data.list||[],i=s.find((t=>t.name===a));console.log(i);const o=i.status;if("DISABLED"===o)return void(this.showDrawModule=!1);this.showDrawModule=200===t.status}catch(t){console.log("AI绘图模块权限验证失败:",t),this.showDrawModule=!1}}catch(t){console.error("获取用户信息失败:",t),C.error("获取用户信息失败")}}},created(){this.loadAvatar(),Jt.$on("envVariableChanged",(t=>{switch(t){case"jump":this.currentComponent=Ot;break;case"car":this.currentComponent=ae;break}})),this.checkMobile(),window.addEventListener("resize",this.checkMobile),"undefined"!==typeof document&&(document.addEventListener("touchstart",this.handleTouchStart),document.addEventListener("touchend",this.handleTouchEnd))},destroyed(){window.removeEventListener("resize",this.checkMobile),"undefined"!==typeof document&&(document.removeEventListener("touchstart",this.handleTouchStart),document.removeEventListener("touchend",this.handleTouchEnd))},mounted(){this.checkUserPermission(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)}},de=ce,ue=(0,r.A)(de,J,Z,!1,null,"569ea1b9",null),he=ue.exports;s["default"].use(u.Ay);const pe=[{path:"/",component:A,name:"home",meta:{title:"首页"}},{path:"/account",component:xt,name:"account",meta:{title:"账号管理"}},{path:"/share",component:Vt,name:"share",meta:{title:"分享管理"}},{path:"/redemption",component:Yt,name:"redemption",meta:{title:"兑换码"}},{path:"/car",component:ae,name:"car",meta:{title:"停车场"}},{path:"/jump",component:Ot,name:"jump",meta:{title:"秋名山"}},{path:"/reset",component:$,name:"reset",meta:{title:"重置密码"}},{path:"/pandora",component:R,name:"pandora",meta:{title:"Pandora"}},{path:"/loading",component:Q,name:"loading",meta:{title:"Loading"}},{path:"/claude",component:X,name:"claude",meta:{title:"Fuclaude"}},{path:"/navi",component:he,name:"navi",meta:{title:"Helper"}},{path:"/draw",component:re,name:"draw",meta:{title:"AI绘图"}}],me=new u.Ay({mode:"history",routes:pe});function ge(t){let e=document.querySelector("link[rel~='icon']");e||(e=document.createElement("link"),e.rel="icon",document.getElementsByTagName("head")[0].appendChild(e)),e.href=t,e.type="iamge/svg+xml"}me.beforeEach(((t,e,a)=>{t.meta.title?(document.title=t.meta.title,ge("favicon.svg")):document.title="Pandora",a()}));var fe=me;s["default"].use(y()),s["default"].config.productionTip=!1;const ve={install(t){t.prototype.$config=v}};async function be(){await f(),new s["default"]({render:t=>t(d),router:fe}).$mount("#app")}s["default"].use(ve),be()},7343:function(t,e,a){t.exports=a.p+"img/chatgpt.7fecc220.svg"},864:function(t,e,a){t.exports=a.p+"img/claude.b7c39d41.svg"},8902:function(t,e,a){t.exports=a.p+"img/ph--user-switch.8dbf8a86.svg"},4832:function(t,e,a){t.exports=a.p+"img/linuxdo.7bff183f.webp"}},e={};function a(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(o.exports,o,o.exports,a),o.loaded=!0,o.exports}a.m=t,function(){a.amdO={}}(),function(){var t=[];a.O=function(e,s,i,o){if(!s){var n=1/0;for(d=0;d<t.length;d++){s=t[d][0],i=t[d][1],o=t[d][2];for(var l=!0,r=0;r<s.length;r++)(!1&o||n>=o)&&Object.keys(a.O).every((function(t){return a.O[t](s[r])}))?s.splice(r--,1):(l=!1,o<n&&(n=o));if(l){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[s,i,o]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){a.p="/"}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,o,n=s[0],l=s[1],r=s[2],c=0;if(n.some((function(e){return 0!==t[e]}))){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(r)var d=r(a)}for(e&&e(s);c<n.length;c++)o=n[c],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(d)},s=self["webpackChunkpandora_helper"]=self["webpackChunkpandora_helper"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(5726)}));s=a.O(s)})();
//# sourceMappingURL=app.683d277b.js.map