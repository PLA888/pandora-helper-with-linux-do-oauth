(function(){"use strict";var t={1073:function(t,e,a){var s=a(2856),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},r=[],o={name:"App"},l=o,n=a(1656),c=(0,n.A)(l,i,r,!1,null,null,null),d=c.exports,u=a(184),m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-container",on:{wheel:t.handleWheel}},[e("div",{staticClass:"cards-wrapper",style:t.wrapperStyle},t._l(t.pages,(function(a,s){return e("div",{key:s,staticClass:"card-page",class:{active:t.currentIndex===s},style:t.pageStyle(s)},[e(a,{tag:"component",on:{navigate:t.handleNavigation}})],1)})),0),e("div",{staticClass:"page-indicators"},t._l(t.pageNames,(function(a,s){return e("div",{key:s,staticClass:"indicator",class:{active:t.currentIndex===s},on:{click:function(e){return t.goToPage(s)}}},[e("span",{staticClass:"indicator-text"},[t._v(t._s(a))])])})),0)])},h=[],p=(a(4114),function(){var t=this,e=t._self._c;return e("div",{staticClass:"min-h-screen flex items-center justify-center bg-gradient-to-br from-white to-blue-700 p-5"},[e("div",{staticClass:"w-full max-w-md bg-white rounded-xl shadow-2xl p-10 transform transition-transform duration-300 hover:-translate-y-2"},[e("h1",{staticClass:"text-2xl font-semibold text-gray-800 text-center mb-8"},[t._v("Panel")]),e("form",{staticClass:"space-y-4",on:{submit:function(e){return e.preventDefault(),t.userlogin()}}},[e("input",{staticClass:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-green-400 focus:ring-2 focus:ring-green-100 outline-none transition duration-300 text-base",attrs:{type:"text",id:"username",placeholder:"用户名",required:""}}),e("input",{staticClass:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-green-400 focus:ring-2 focus:ring-green-100 outline-none transition duration-300 text-base",attrs:{type:"password",id:"password",placeholder:"密码",required:""}}),t._m(0)]),t._m(1),e("div",{staticClass:"text-center space-y-4"},[e("div",{staticClass:"flex justify-center"},[e("img",{staticClass:"w-9 h-9 cursor-pointer transition-transform duration-300 hover:scale-110",attrs:{src:a(4832),alt:"LINUX DO",loading:"lazy"},on:{click:function(e){return t.initiateOAuth()}}})]),e("button",{staticClass:"w-full bg-white text-gray-700 border-2 border-gray-200 hover:border-green-400 hover:text-green-500 py-3 px-4 rounded-lg transition duration-300",attrs:{type:"button"},on:{click:function(e){return t.reset()}}},[t._v(" 重置密码 ")])]),t._m(2)])])}),g=[function(){var t=this,e=t._self._c;return e("button",{staticClass:"w-full bg-orange-400 hover:bg-green-500 text-white py-3 px-4 rounded-lg transition duration-300 transform hover:-translate-y-0.5 relative",attrs:{type:"submit"}},[e("span",{staticClass:"btn-text inline-block"},[t._v("登录")]),e("span",{staticClass:"spinner absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"relative flex items-center justify-center my-6"},[e("div",{staticClass:"absolute w-full border-t border-gray-200"}),e("div",{staticClass:"relative bg-white px-4 text-sm text-gray-500"},[t._v("OR")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt-8 text-center"},[e("a",{staticClass:"text-sm text-gray-500 hover:text-green-500 transition duration-300",attrs:{href:"https://github.com/Kylsky/pandora-helper-with-linux-do-oauth",target:"_blank"}},[t._v(" Powered by Yeelo ")])])}],f=a(7423);const y={apiBaseUrl:"https://connect.yeelo.fun",mjBaseUrl:"https://discord.com"},b=async()=>{try{const t=await f.A.get("https://connect.yeelo.fun/oauth2/config");console.log(t.data.apiUrl),y.mjBaseUrl=t.data.mjUrl||y.mjBaseUrl}catch(t){console.error("Error loading config:",t)}};var v=y,x=a(2457),w=a.n(x);const C={success(t,e=3e3){(0,x.Message)({message:t,type:"success",duration:e,showClose:!0,customClass:"custom-message"})},error(t,e=3e3){(0,x.Message)({message:t,type:"error",duration:e,showClose:!0,customClass:"custom-message"})},warning(t,e=3e3){(0,x.Message)({message:t,type:"warning",duration:e,showClose:!0,customClass:"custom-message"})},info(t,e=3e3){(0,x.Message)({message:t,type:"info",duration:e,showClose:!0,customClass:"custom-message"})},handleResponse(t,e="操作成功"){return t.data.status?(this.success(e),!0):(this.error(t.data.message||"操作失败"),!1)},handleError(t){t.response?this.error(t.response.data.message||"请求失败"):t.request?this.error("网络连接失败，请检查网络"):this.error("请求配置错误")}};var k=C;const _=f.A.create({baseURL:{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_BASE_URL,headers:{"Content-Type":"application/json"},timeout:1e4});_.interceptors.response.use((t=>t),(t=>{const{response:e}=t;if(console.log(t),e){if(302===e.status){const t=e.headers["location"];t&&(window.location.href=t)}console.log(e.config.url),401===e.status&&e.config.url.startsWith(v.apiBaseUrl)?Ce.push({path:"/"}):401===e.status&&k.error("您没有权限访问该功能")}return Promise.reject(t)}));var I=_,S={name:"IndexPage",methods:{reset(){this.$emit("navigate",{name:"reset"})},async userlogin(){const t=document.querySelector('button[type="submit"]');t.classList.add("loading");var e=document.getElementById("username").value,a=document.getElementById("password").value;try{const s=await I.post(`${v.apiBaseUrl}/user/login`,{username:e,password:a});this.loading=!1;const i=s.data.status;if(!i)return k.error(s.data.message),t.classList.remove("loading"),!1;const r=s.data,o=r.data.jwt,l=r.data.avatarUrl;localStorage.setItem("token",o),l&&localStorage.setItem("img",l),t.classList.remove("loading"),this.$emit("navigate",{name:"navi"})}catch(s){t.classList.remove("loading"),k.error(s)}},async initiateOAuth(){try{const e=await I.get(`${v.apiBaseUrl}/oauth2/initiate?type=panel`);var t=e;t.data?window.location=t.data:console.error("No redirect URL provided")}catch(e){console.error("Request failed with status:",e)}}}},T=S,D=(0,n.A)(T,p,g,!1,null,"9e377cb4",null),A=D.exports,P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"min-h-screen flex justify-center items-center p-5 bg-gradient-to-br from-[#43cea2] to-[#185a9d]"},[e("div",{staticClass:"bg-white rounded-xl shadow-lg p-10 w-full max-w-md transform transition-transform duration-300 hover:-translate-y-2"},[e("h1",{staticClass:"text-center text-2xl font-semibold text-gray-800 mb-8"},[t._v("Pandora")]),e("form",{staticClass:"space-y-4",on:{submit:function(e){return e.preventDefault(),t.userlogin()}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.username,expression:"formData.username"}],staticClass:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-[#43cea2] focus:outline-none focus:ring-2 focus:ring-[#43cea2] focus:ring-opacity-10 text-base transition duration-300",attrs:{type:"text",placeholder:"用户名",required:""},domProps:{value:t.formData.username},on:{input:function(e){e.target.composing||t.$set(t.formData,"username",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.password,expression:"formData.password"}],staticClass:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-[#43cea2] focus:outline-none focus:ring-2 focus:ring-[#43cea2] focus:ring-opacity-10 text-base transition duration-300",attrs:{type:"password",placeholder:"密码",required:""},domProps:{value:t.formData.password},on:{input:function(e){e.target.composing||t.$set(t.formData,"password",e.target.value)}}}),e("button",{staticClass:"w-full py-3 bg-[#43cea2] hover:bg-[#3bb592] text-white rounded-lg font-medium transition duration-300 hover:-translate-y-0.5 relative flex justify-center items-center",attrs:{type:"submit"}},[e("span",{class:{invisible:t.loading}},[t._v("登录")]),t.loading?e("span",{staticClass:"absolute w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):t._e()])]),t._m(0),e("div",{staticClass:"text-center"},[e("div",{staticClass:"flex justify-center my-4"},[e("img",{staticClass:"w-9 h-9 cursor-pointer transition-transform duration-300 hover:scale-110",attrs:{src:a(4832),alt:"LINUX DO",loading:"lazy"},on:{click:function(e){return t.initiateOAuth()}}})]),e("button",{staticClass:"w-full py-3 bg-white border-2 border-gray-200 text-gray-700 rounded-lg font-medium transition duration-300 hover:border-[#43cea2] hover:text-[#43cea2]",attrs:{type:"button"},on:{click:function(e){return t.reset()}}},[t._v(" 重置密码 ")])]),t._m(1)])])},M=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"relative flex items-center justify-center my-6"},[e("div",{staticClass:"absolute w-full border-t border-gray-200"}),e("span",{staticClass:"relative px-4 bg-white text-gray-500"},[t._v("OR")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center mt-8"},[e("a",{staticClass:"text-sm text-gray-500 hover:text-[#43cea2] transition duration-300",attrs:{href:"https://github.com/Kylsky/pandora-helper-with-linux-do-oauth",target:"_blank"}},[t._v(" Powered by Pandora ")])])}],$={name:"PandoraPage",data(){return{loading:!1,formData:{username:"",password:""}}},methods:{reset(){this.$emit("navigate",{name:"reset"})},async userlogin(){this.loading=!0;try{const e=await I.post(`${v.apiBaseUrl}/pandora/login`,{username:this.formData.username,password:this.formData.password}),a=e.data.status;if(a)window.open(e.data.data);else{var t=e.data.message;k.error(t)}}catch(e){k.error(e)}finally{this.loading=!1}},async initiateOAuth(){try{const e=await I.get(`${v.apiBaseUrl}/oauth2/initiate?type=pandora`);var t=e;t.data?window.location=t.data:console.error("No redirect URL provided")}catch(e){console.error("Request failed with status:",e)}}}},z=$,E=(0,n.A)(z,P,M,!1,null,null,null),j=E.exports,R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"min-h-screen flex justify-center items-center p-5 bg-gradient-to-br from-red-500 to-blue-800 font-sans"},[e("div",{staticClass:"bg-white rounded-xl shadow-lg p-10 w-full max-w-md transform transition-transform duration-300 hover:-translate-y-2"},[e("h1",{staticClass:"text-center text-2xl font-semibold text-gray-800 mb-8"},[t._v("Fuclaude")]),e("form",{staticClass:"space-y-4",on:{submit:function(e){return e.preventDefault(),t.userlogin.apply(null,arguments)}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500/10 text-base transition-all duration-300",attrs:{type:"text",id:"username",placeholder:"用户名",required:""},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500/10 text-base transition-all duration-300",attrs:{type:"password",id:"password",placeholder:"密码",required:""},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),e("button",{staticClass:"relative w-full py-3 bg-red-500 text-white rounded-lg text-base font-medium transition-all duration-300 hover:bg-red-600 hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-red-500/50",class:{loading:t.isLoading},attrs:{type:"submit"}},[e("span",{staticClass:"btn-text"},[t._v("登录")]),t._m(0)])]),t._m(1),e("div",{staticClass:"text-center"},[e("div",{staticClass:"flex justify-center my-4"},[e("img",{staticClass:"w-9 h-9 cursor-pointer transition-transform duration-300 hover:scale-110",attrs:{src:a(4832),alt:"LINUX DO",loading:"lazy"},on:{click:function(e){return t.initiateOAuth()}}})]),e("button",{staticClass:"w-full py-3 bg-white text-gray-800 border-2 border-gray-200 rounded-lg text-base font-medium transition-all duration-300 hover:border-red-500 hover:text-red-500 focus:outline-none",attrs:{type:"button"},on:{click:function(e){return t.reset()}}},[t._v(" 重置密码 ")])]),t._m(2)])])},B=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"spinner absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden"},[e("div",{staticClass:"w-5 h-5 border-[3px] border-white/30 border-t-white rounded-full animate-spin"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"relative flex items-center justify-center my-5"},[e("div",{staticClass:"absolute w-full border-t border-gray-200"}),e("div",{staticClass:"relative px-4 bg-white text-sm text-gray-500"},[t._v("OR")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center mt-8 text-sm text-gray-500"},[e("span",[t._v("Powered by Fuclaude")])])}],U={name:"ClaudePage",data(){return{isLoading:!1,username:"",password:""}},methods:{reset(){this.$emit("navigate",{name:"reset"})},async userlogin(){this.isLoading=!0;try{const e=await I.post(`${v.apiBaseUrl}/fuclaude/login`,{username:this.username,password:this.password}),a=e.data.status;if(a)window.open(e.data.data);else{var t=e.data.message;k.error(t)}}catch(e){k.error(e)}finally{this.isLoading=!1}},async initiateOAuth(){try{const e=await I.get(`${v.apiBaseUrl}/oauth2/initiate?type=claude`);var t=e;t.data?window.location=t.data:console.error("No redirect URL provided")}catch(e){console.error("Request failed with status:",e)}}}},L=U,V=(0,n.A)(L,R,B,!1,null,"46e083ce",null),F=V.exports,q={name:"CardContainer",components:{IndexPage:A,PandoraPage:j,ClaudePage:F},data(){return{pages:[A,j,F],pageNames:["Panel","Pandora","Claude"],currentIndex:0,isScrolling:!1,transitionDuration:.8,lastWheelTime:0,wheelDelay:800}},computed:{wrapperStyle(){return{height:"100%",transform:`translateY(${100*-this.currentIndex}vh)`,transition:`all ${this.transitionDuration}s cubic-bezier(0.4, 0, 0.2, 1)`}}},methods:{pageStyle(t){const e=t-this.currentIndex,a=Math.abs(e)<=1?1-.05*Math.abs(e):.95,s=Math.abs(e)<=1?1-.2*Math.abs(e):.8;return{transform:`translateY(${100*t}vh) scale(${a})`,opacity:s,transition:`all ${this.transitionDuration}s cubic-bezier(0.4, 0, 0.2, 1)`,zIndex:this.currentIndex===t?2:1}},handleNavigation(t){this.$router.push(t)},handleWheel(t){const e=Date.now();if(e-this.lastWheelTime<this.wheelDelay)return;if(this.isScrolling)return;const a=t.deltaY;Math.abs(a)<50||(a>0&&this.currentIndex<this.pages.length-1?(this.isScrolling=!0,this.currentIndex++,this.lastWheelTime=e):a<0&&this.currentIndex>0&&(this.isScrolling=!0,this.currentIndex--,this.lastWheelTime=e),setTimeout((()=>{this.isScrolling=!1}),1e3*this.transitionDuration))},goToPage(t){this.isScrolling||(this.currentIndex=t)}}},O=q,N=(0,n.A)(O,m,h,!1,null,"7d89de77",null),Q=N.exports,W=function(){var t=this,e=t._self._c;return e("div",{staticClass:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#43cea2] to-[#185a9d] p-5"},[e("div",{staticClass:"w-full max-w-md bg-white rounded-xl shadow-lg p-8 transform transition-transform duration-300 hover:-translate-y-1"},[e("h1",{staticClass:"text-2xl md:text-3xl font-semibold text-gray-800 text-center mb-8"},[t._v("重置密码")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.resetPassword()}}},[e("div",{staticClass:"space-y-4 mb-6"},[e("input",{staticClass:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#43cea2] focus:outline-none focus:ring-2 focus:ring-[#43cea2] focus:ring-opacity-10 transition-all duration-300 disabled:opacity-50",attrs:{type:"text",id:"username",placeholder:"用户名",required:"",disabled:t.isLoading}}),e("input",{staticClass:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#43cea2] focus:outline-none focus:ring-2 focus:ring-[#43cea2] focus:ring-opacity-10 transition-all duration-300 disabled:opacity-50",attrs:{type:"password",id:"oldPassword",placeholder:"旧密码",required:"",disabled:t.isLoading}}),e("input",{staticClass:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#43cea2] focus:outline-none focus:ring-2 focus:ring-[#43cea2] focus:ring-opacity-10 transition-all duration-300 disabled:opacity-50",attrs:{type:"password",id:"newPassword",placeholder:"新密码",required:"",disabled:t.isLoading}}),e("input",{staticClass:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#43cea2] focus:outline-none focus:ring-2 focus:ring-[#43cea2] focus:ring-opacity-10 transition-all duration-300 disabled:opacity-50",attrs:{type:"password",id:"confirmPassword",placeholder:"再次确认新密码",required:"",disabled:t.isLoading}})]),e("div",{staticClass:"space-y-3"},[e("button",{staticClass:"w-full bg-[#43cea2] hover:bg-[#3bb592] text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 hover:-translate-y-0.5 relative disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0",attrs:{type:"submit",disabled:t.isLoading}},[e("span",{class:{invisible:t.isLoading}},[t._v("重置")]),e("span",{staticClass:"absolute inset-0 flex items-center justify-center",class:{hidden:!t.isLoading}},[e("svg",{staticClass:"animate-spin h-5 w-5 text-white",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"}},[e("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}}),e("path",{staticClass:"opacity-75",attrs:{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}})])])]),e("button",{staticClass:"w-full bg-white text-gray-700 font-medium py-3 px-4 rounded-lg border-2 border-gray-200 hover:border-[#43cea2] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:border-gray-200",attrs:{type:"button",disabled:t.isLoading},on:{click:function(e){return t.goHome()}}},[t._v(" 返回主页 ")])])]),t._m(0)])])},G=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center mt-8"},[e("span",{staticClass:"text-gray-500 text-sm opacity-80 hover:opacity-100 transition-opacity duration-300"},[t._v(" Powered by Yeelo ")])])}],K={name:"ResetPage",data(){return{isLoading:!1}},methods:{async resetPassword(){var t=document.getElementById("username").value,e=document.getElementById("oldPassword").value,a=document.getElementById("newPassword").value,s=document.getElementById("confirmPassword").value;if(e===a)return alert("新密码不能和旧密码相同，请重新输入。"),!1;if(a.length<8)return alert("密码长度必须超过大于等于8位，请重新输入。"),!1;if(a!==s)return alert("两次输入的密码不一致，请重新输入。"),!1;this.isLoading=!0;try{const i=await I.post(`${v.apiBaseUrl}/pandora/reset`,{username:t,oldPassword:e,newPassword:a,confirmPassword:s}),r=i.data.status;r?(alert("密码重置成功！"),this.$router.replace({name:"home"})):alert(i.data.message)}catch(i){alert(i)}finally{this.isLoading=!1}},async goHome(){this.$router.replace({name:"home"})}}},H=K,Y=(0,n.A)(H,W,G,!1,null,null,null),X=Y.exports,J=function(){var t=this;t._self._c;return t._m(0)},Z=[function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"loading"}},[e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loader-wrapper"},[e("div",{staticClass:"loader"}),e("div",{staticClass:"loader-inner"})]),e("p",{staticClass:"message"},[t._v("正在授权，请稍候...")]),e("p",{staticClass:"sub-message"},[t._v("Loading...")])])])}],tt=(a(4603),a(7566),a(8721),{name:"LoadingPage",methods:{async fetchToken(t,e){console.log(t,e);const a=await I.get(`${v.apiBaseUrl}/oauth2/callback?code=${t}&state=${e}`,{withCredentials:!0});if(a.data.status){let t=JSON.parse(a.data.data);console.log(t.avatar_url),localStorage.setItem("img",t.avatar_url),"ChatGPT"===t.shareType?await this.startGPTChat(t.username,t.jmc):"Claude"===t.shareType?await this.startClaudeChat(t.username,t.jmc):"panel"===t.shareType&&await this.startPanel(t.username,t.jmc)}},async startGPTChat(t,e){const a=await I.get(`${v.apiBaseUrl}/pandora/checkUser?username=${t}&jmc=${e}`,{withCredentials:!0});a.data.status&&a.data.data.isShared?window.open(a.data.data.address):(k.error("您的账号未激活，请联系管理员"),this.$router.replace({name:"pandora"}))},async startClaudeChat(t,e){const a=await I.get(`${v.apiBaseUrl}/fuclaude/checkUser?username=${t}&jmc=${e}`,{withCredentials:!0});a.data.status?window.open(a.data.data):(k.error("您的账号未激活，请联系管理员"),this.$router.replace({name:"claude"}))},async startPanel(t,e){console.log("hi");const a=await I.get(`${v.apiBaseUrl}/share/checkUser?username=${t}&jmc=${e}`,{withCredentials:!0});a.data.status?(localStorage.setItem("token",a.data.data),this.$router.replace({name:"navi"})):(k.error(a.data.message),this.$router.replace({name:""}))}},mounted(){const t=new URL(window.location.href),e=new URLSearchParams(t.search),a=e.get("code"),s=e.get("state");a&&s&&this.fetchToken(a,s)}}),et=tt,at=(0,n.A)(et,J,Z,!1,null,"26bcbb86",null),st=at.exports,it=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"h-screen font-sans relative",attrs:{id:"navi"}},[t.isMobile&&!t.isCollapse?e("div",{staticClass:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[1999] transition-opacity duration-300",on:{click:t.toggleCollapse}}):t._e(),e("el-aside",{staticClass:"sidebar",attrs:{width:t.getSidebarWidth}},[e("div",{staticClass:"sidebar-header"},[e("h2",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapse,expression:"!isCollapse"}],staticClass:"site-title"},[t._v("Pandora Helper")]),t.isMobile?t._e():e("el-button",{staticClass:"collapse-btn",attrs:{icon:t.isCollapse?"el-icon-s-unfold":"el-icon-s-fold"},on:{click:t.toggleCollapse}})],1),e("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"accountNav",collapse:t.isCollapse,"collapse-transition":!1},on:{select:t.handleMenuSelect}},t._l(t.filteredMenuItems,(function(a,s){return e("el-menu-item",{key:s,attrs:{index:a.index}},[e("i",{class:a.icon}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(a.title))])])})),1),e("el-dropdown",{staticClass:"user-menu",attrs:{trigger:"click",placement:"top-start"}},[e("div",{staticClass:"avatar-wrapper"},[e("el-avatar",{staticClass:"user-avatar",attrs:{size:40,src:t.avatar}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dropdownItems,(function(a,s){return e("el-dropdown-item",{key:s,staticClass:"dropdown-item",nativeOn:{click:function(t){return a.action.apply(null,arguments)}}},[e("i",{class:[a.icon]}),e("span",[t._v(t._s(a.title))])])})),1)],1)],1),e("el-main",{class:["main-content",{"mobile-main":t.isMobile}]},[t.isMobile&&t.isCollapse?e("div",{staticClass:"menu-trigger",on:{click:t.toggleCollapse}},[e("i",{staticClass:"el-icon-s-operation"})]):t._e(),e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue}})})),1),e("enhanced-dialog",{attrs:{isVisible:t.resetModalVisible,title:"重置密码"},on:{close:t.closeResetModal,confirm:t.submitResetForm}},t._l(t.resetFormFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleResetUpdateValue}})})),1),e(t.currentComponent,{tag:"component"})],1)],1)},rt=[],ot=function(){var t=this,e=t._self._c;return e("div",{staticClass:"form-group"},[t.field.hideLabel?t._e():e("label",{staticClass:"form-label",attrs:{for:t.field.id}},[t._v(t._s(t.field.label))]),"checkbox"===t.field.type&&!t.field.hideLabel&&"number"===t.field.type|"text"===t.field.type|"date"===t.field.type|"password"===t.field.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-input",attrs:{id:t.field.id,type:"checkbox"},domProps:{checked:Array.isArray(t.localValue)?t._i(t.localValue,null)>-1:t.localValue},on:{change:function(e){var a=t.localValue,s=e.target,i=!!s.checked;if(Array.isArray(a)){var r=null,o=t._i(a,r);s.checked?o<0&&(t.localValue=a.concat([r])):o>-1&&(t.localValue=a.slice(0,o).concat(a.slice(o+1)))}else t.localValue=i}}}):"radio"===t.field.type&&!t.field.hideLabel&&"number"===t.field.type|"text"===t.field.type|"date"===t.field.type|"password"===t.field.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-input",attrs:{id:t.field.id,type:"radio"},domProps:{checked:t._q(t.localValue,null)},on:{change:function(e){t.localValue=null}}}):!t.field.hideLabel&&"number"===t.field.type|"text"===t.field.type|"date"===t.field.type|"password"===t.field.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-input",attrs:{id:t.field.id,type:t.field.type},domProps:{value:t.localValue},on:{input:function(e){e.target.composing||(t.localValue=e.target.value)}}}):t._e(),"select"===t.field.type?e("select",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"form-select",attrs:{id:t.field.id},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.localValue=e.target.multiple?a:a[0]},function(e){return t.handleSelectChange(e)}]}},t._l(t.field.options,(function(a){return e("option",{key:a.value,domProps:{value:a.value}},[t._v(" "+t._s(a.text)+" ")])})),0):t._e(),"checkbox"===t.field.type?e("div",{staticClass:"switch-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"switch-input",attrs:{type:"checkbox",id:t.field.id},domProps:{checked:Array.isArray(t.localValue)?t._i(t.localValue,null)>-1:t.localValue},on:{change:function(e){var a=t.localValue,s=e.target,i=!!s.checked;if(Array.isArray(a)){var r=null,o=t._i(a,r);s.checked?o<0&&(t.localValue=a.concat([r])):o>-1&&(t.localValue=a.slice(0,o).concat(a.slice(o+1)))}else t.localValue=i}}}),e("label",{staticClass:"switch-label",attrs:{for:t.field.id}},[e("span",{staticClass:"switch-button"})])]):t._e()])},lt=[],nt={props:{field:Object},data(){return{localValue:this.initializeValue()}},methods:{initializeValue(){return"select"===this.field.type&&this.field.options&&this.field.options.length>0?this.field.value||this.field.options[0].value:this.field.value},handleSelectChange(t){const e=t.target.value;this.$emit("handleSelectChange",{type:1,field:this.field,value:e})}},watch:{localValue(t){this.$emit("updateValue",this.field.id,t)},field:{handler(){this.localValue=this.initializeValue()},deep:!0,immediate:!0}}},ct=nt,dt=(0,n.A)(ct,ot,lt,!1,null,"049bf864",null),ut=dt.exports,mt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"modal"}},[t.isVisible?e("div",{staticClass:"modal-overlay",on:{click:t.close}},[e("div",{staticClass:"modal-content",attrs:{role:"dialog","aria-modal":"true","aria-labelledby":t.title},on:{click:function(t){t.stopPropagation()}}},[e("header",{staticClass:"modal-header"},[e("h3",{attrs:{id:t.title}},[t._v(t._s(t.title))]),e("button",{staticClass:"close-button",attrs:{"aria-label":"关闭对话框"},on:{click:t.close}},[e("svg",{staticClass:"close-icon",attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"}})])])]),e("main",{staticClass:"modal-body"},[t._t("default")],2),e("footer",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-cancel",on:{click:t.close}},[t._v("取消")]),e("button",{staticClass:"btn btn-confirm",on:{click:t.confirm}},[t._v("确认")])])])]):t._e()])},ht=[],pt={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"标题"}},mounted(){this.isVisible&&this.preventBodyScroll(),window.addEventListener("keydown",this.handleKeydown)},beforeDestroy(){this.enableBodyScroll(),window.removeEventListener("keydown",this.handleKeydown)},watch:{isVisible(t){t?this.preventBodyScroll():this.enableBodyScroll()}},methods:{close(){this.$emit("close")},confirm(){this.$emit("confirm")},handleKeydown(t){this.isVisible&&"Escape"===t.key&&this.close()},preventBodyScroll(){document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"},enableBodyScroll(){document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}}},gt=pt,ft=(0,n.A)(gt,mt,ht,!1,null,"7ff1380e",null),yt=ft.exports,bt=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"bg-white dark:bg-gray-900 rounded-2xl shadow-lg m-5 min-h-[calc(100vh-40px)] flex flex-col border dark:border-gray-800",attrs:{id:"accountPanel"}},[e("header",{staticClass:"px-4 py-3"},[e("h2",{staticClass:"text-xl font-semibold text-gray-800 dark:text-gray-200"},[t._v("账号管理")])]),e("el-main",{staticClass:"flex-1"},[e("el-row",{staticClass:"mb-7",attrs:{gutter:20}},[e("el-col",{attrs:{xs:24,sm:24,md:18}},[e("el-input",{staticClass:"w-full dark-input",attrs:{id:"email-query",placeholder:"请输入邮箱"},scopedSlots:t._u([{key:"input",fn:function(){return[e("input",{staticClass:"el-input__inner dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:placeholder-gray-500",attrs:{placeholder:"请输入邮箱"},domProps:{value:t.email},on:{input:e=>t.email=e.target.value}})]},proxy:!0}]),model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{staticClass:"dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1),e("el-col",{staticClass:"flex justify-end sm:mt-4 md:mt-0",attrs:{xs:24,sm:24,md:6}},[e("el-button",{staticClass:"w-full md:w-auto bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white transition-all duration-300 transform hover:-translate-y-0.5",attrs:{type:"primary"},on:{click:function(e){return t.showModal()}}},[t._v("新增")])],1)],1),t.isMobile?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"space-y-4 md:hidden",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl border border-gray-100 dark:border-gray-700"},[e("div",{staticClass:"flex justify-between items-center mb-4"},[e("div",{staticClass:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-4 py-2 rounded-full flex items-center space-x-2 max-w-[70%] overflow-hidden"},[e("i",{staticClass:"el-icon-message"}),e("span",{staticClass:"truncate"},[t._v(t._s(a.email))])]),e("div",{staticClass:"px-3 py-1 rounded-full text-sm font-medium",class:{"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":1===a.shared,"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400":1!==a.shared}},[t._v(" "+t._s(1===a.shared?"已共享":"未共享")+" ")])]),e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v("账号类型")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[t._v(t._s(a.type))])]),e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v("更新时间")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[t._v(t._s(a.updateTime))])])])]),e("div",{staticClass:"my-4 h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"}),e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"flex space-x-2"},[1===a.accountType?e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"info",size:"mini"},on:{click:function(e){return t.refresh(a.id)}}},[e("i",{staticClass:"el-icon-refresh mr-1"}),t._v(" 刷新 ")]):t._e(),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showShareModal(a.id)}}},[e("i",{staticClass:"el-icon-share mr-1"}),t._v(" 共享 ")]),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.id)}}},[e("i",{staticClass:"el-icon-edit mr-1"}),t._v(" 编辑 ")])],1),e("div",{staticClass:"flex"},[e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.id)}}},[e("i",{staticClass:"el-icon-delete mr-1"}),t._v(" 删除 ")])],1)])])})),0):e("div",{staticClass:"hidden md:block"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,fit:!0,"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading","cell-style":{padding:"8px 0"},"header-cell-style":{padding:"8px 0"},"row-style":{height:"48px"},"header-row-style":{height:"48px"},size:"small"}},[e("el-table-column",{attrs:{prop:"email",label:"电子邮箱","min-width":"180","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2"},[e("i",{staticClass:"el-icon-message text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.email))])])]}}],null,!1,3622586208)}),e("el-table-column",{attrs:{prop:"name",label:"账号名称","min-width":"120","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.name))])]}}],null,!1,1580733797)}),e("el-table-column",{attrs:{prop:"type",label:"账号类型","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2"},[e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.type))]),"ChatGPT"===a.row.type?["plus"===a.row.planType?e("el-tag",{staticClass:"bg-yellow-50 text-yellow-600 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800",attrs:{effect:"plain",size:"mini"}},[t._v("Plus")]):"free"===a.row.planType?e("el-tag",{staticClass:"bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800",attrs:{effect:"plain",size:"mini"}},[t._v("Free")]):"team"===a.row.planType?e("el-tag",{staticClass:"bg-blue-50 text-blue-600 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800",attrs:{effect:"plain",size:"mini"}},[t._v("Team")]):"pro"===a.row.planType?e("el-tag",{staticClass:"bg-black text-yellow-400 border-yellow-500 dark:bg-black/40 dark:text-yellow-300 dark:border-yellow-600",attrs:{effect:"plain",size:"mini"}},[t._v("Pro")]):e("el-tag",{staticClass:"bg-gray-50 text-gray-600 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800",attrs:{effect:"plain",size:"mini"}},[t._v("已失效")])]:t._e()],2)]}}],null,!1,1099526144)}),e("el-table-column",{attrs:{prop:"shared",label:"共享",width:"120",align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(t){return[1===t.row.shared?e("i",{staticClass:"el-icon-circle-check text-green-500"}):e("i",{staticClass:"el-icon-circle-close text-red-500"})]}}],null,!1,781659201)}),e("el-table-column",{attrs:{prop:"updateTime",label:"更新时间","min-width":"160","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2"},[e("i",{staticClass:"el-icon-time text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-600 dark:text-gray-400 font-medium"},[t._v(t._s(a.row.updateTime))])])]}}],null,!1,155503731)}),e("el-table-column",{attrs:{label:"操作",width:"320",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex space-x-2"},[1===a.row.accountType?e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"info",size:"mini"},on:{click:function(e){return t.refresh(a.row.id)}}},[t._v("刷新")]):t._e(),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showShareModal(a.row.id)}}},[t._v("共享")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.row.id)}}},[t._v("编辑")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.showConfirmDialog(a.row.id)}}},[t._v("删除")])],1)]}}],null,!1,3533864917)})],1)],1),e("el-pagination",{class:[t.isMobile?"w-full flex justify-center py-4":"fixed bottom-8 right-8 z-10"],attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}}),t.modalVisible?e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue}})})),1):t._e(),e("confirm-dialog",{attrs:{visible:t.isDialogVisible,title:"确认删除",message:"你确定要删除这个账号吗？"},on:{"update:visible":function(e){t.isDialogVisible=e},confirm:t.handleDelete}}),t.chartsVisible?e("div",{staticClass:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999]"},[e("div",{staticClass:"bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-4xl w-[90%] mx-4 shadow-2xl relative"},[e("div",{staticClass:"absolute -top-2 -right-2 z-10"},[e("button",{staticClass:"w-8 h-8 rounded-full bg-white dark:bg-gray-700 shadow-lg flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200 border border-gray-200 dark:border-gray-600",on:{click:t.closeChart}},[e("i",{staticClass:"el-icon-close text-gray-600 dark:text-gray-300"})])]),e("div",{ref:"chart",staticClass:"w-full h-[400px]"})])]):t._e()],1)],1)},vt=[],xt=a(3944),wt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"zoom"}},[t.localVisible?e("div",{staticClass:"dialog-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.handleClose.apply(null,arguments)}}},[e("div",{staticClass:"dialog-container"},[e("div",{staticClass:"dialog-header"},[e("h3",[t._v(t._s(t.title))]),e("button",{staticClass:"close-button",on:{click:t.handleClose}},[t._v("×")])]),e("div",{staticClass:"dialog-body"},[e("i",{staticClass:"icon-warning"}),e("p",[t._v(t._s(t.message))])]),e("div",{staticClass:"dialog-footer"},[e("button",{staticClass:"btn btn-confirm",on:{click:t.handleConfirm}},[t._v("确定")]),e("button",{staticClass:"btn btn-cancel",on:{click:t.handleClose}},[t._v("取消")])])])]):t._e()])},Ct=[],kt={props:{visible:{type:Boolean,default:!1},title:{type:String,default:"确认"},message:{type:String,default:"你确定要执行这个操作吗？"}},data(){return{localVisible:this.visible}},watch:{visible(t){this.localVisible=t}},methods:{handleClose(){this.localVisible=!1,this.$emit("update:visible",!1)},handleConfirm(){this.$emit("confirm"),this.handleClose()}}},_t=kt,It=(0,n.A)(_t,wt,Ct,!1,null,"d393abfa",null),St=It.exports,Tt={name:"AccountPage",components:{ConfirmDialog:St,EnhancedDialog:yt,FormInput:ut},data(){return{loading:!1,isMobile:!1,email:"",tableData:[],currentPage:1,shareAddFlag:!1,total:0,isDialogVisible:!1,isAccDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,chart:null,chartData:[],chartsVisible:!1,formData:{},shareFormData:{},formFields:[{id:"name",label:"账号名称",type:"text",value:"",required:!0},{id:"email",label:"邮箱地址",type:"text",value:"",required:!0},{id:"accountType",label:"账号类型",type:"select",value:"ChatGPT",options:[{value:1,text:"ChatGPT"},{value:2,text:"Claude"}],required:!0},{id:"userLimit",label:"分享人数上限",type:"text",value:"",required:!0},{id:"accessToken",label:"ACCESS_TOKEN",type:"text",value:"",required:!0},{id:"refreshToken",label:"REFRESH_TOKEN",type:"text",value:"",required:!1},{id:"shared",label:"是否共享",type:"checkbox",value:!1,required:!0},{id:"auto",label:"自动加入",type:"checkbox",value:!1,required:!0}],accountFields:[{id:"name",label:"账号名称",type:"text",value:"",required:!0},{id:"email",label:"邮箱地址",type:"text",value:"",required:!0},{id:"accountType",label:"账号类型",type:"select",value:"ChatGPT",options:[{value:1,text:"ChatGPT"},{value:2,text:"Claude"},{value:3,text:"API"}],required:!0},{id:"userLimit",label:"分享人数上限",type:"text",value:"",required:!0},{id:"accessToken",label:"ACCESS_TOKEN",type:"text",value:"",required:!0},{id:"refreshToken",label:"REFRESH_TOKEN",type:"text",value:"",hideLabel:!1},{id:"shared",label:"是否共享",type:"checkbox",value:!1,required:!0},{id:"auto",label:"自动加入",type:"checkbox",value:!1,required:!0}],shareFields:[{id:"username",label:"用户名",type:"text",value:"",required:!0},{id:"password",label:"密码",type:"password",value:"",required:!0},{id:"comment",label:"备注",type:"text",value:"",required:!0},{id:"mjEnable",label:"启用 Midjourney",type:"checkbox",value:"",required:!0},{id:"expiresAt",label:"过期时间",type:"date",value:"",required:!0}],isAdmin:!1}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},initChart(){this.chart&&this.chart.dispose(),this.$nextTick((()=>{this.chart=xt.Ts(this.$refs.chart);const t={title:{text:"GPT使用情况统计",subtext:"各用户模型使用次数统计",left:"center",top:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#333"},subtextStyle:{fontSize:12,color:"#666"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#333"},formatter:function(t){let e=`<div class="font-semibold">${t[0].axisValue}</div>`;return t.forEach((t=>{t.value>0&&(e+=`<div style="display: flex; justify-content: space-between; min-width: 150px; padding: 3px 0;">\n                                        <span>${t.seriesName}:</span>\n                                        <span class="font-semibold">${t.value}</span>\n                                    </div>`)})),e}},legend:{data:["GPT-4o","GPT-4","GPT-4o-mini","o1-preview","o1-mini"],bottom:10,icon:"roundRect",itemWidth:12,itemHeight:12,textStyle:{fontSize:12,color:"#666"}},grid:{top:100,bottom:80,left:"5%",right:"5%",containLabel:!0},xAxis:{type:"category",data:this.chartData.map((t=>t.uniqueName)),axisLabel:{rotate:45,fontSize:12,color:"#666",interval:0},axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{color:"#ddd"}}},yAxis:{type:"value",name:"使用次数",nameTextStyle:{color:"#666",fontSize:12,padding:[0,0,0,40]},axisLabel:{color:"#666",fontSize:12},splitLine:{lineStyle:{color:"#eee",type:"dashed"}}},series:[{name:"GPT-4o",type:"bar",data:this.chartData.map((t=>t.usage.gpt_4o||0)),itemStyle:{color:"#67C23A",borderRadius:[4,4,0,0]},barMaxWidth:30,emphasis:{itemStyle:{color:"#85CE61"}}},{name:"GPT-4",type:"bar",data:this.chartData.map((t=>t.usage.gpt_4||0)),itemStyle:{color:"#409EFF",borderRadius:[4,4,0,0]},barMaxWidth:30,emphasis:{itemStyle:{color:"#66B1FF"}}},{name:"GPT-4o-mini",type:"bar",data:this.chartData.map((t=>t.usage.gpt_4o_mini||0)),itemStyle:{color:"#E6A23C",borderRadius:[4,4,0,0]},barMaxWidth:30,emphasis:{itemStyle:{color:"#EBB563"}}},{name:"o1-preview",type:"bar",data:this.chartData.map((t=>t.usage.o1||0)),itemStyle:{color:"#3498db",borderRadius:[4,4,0,0]},barMaxWidth:30,emphasis:{itemStyle:{color:"#5DADE2"}}},{name:"o1-mini",type:"bar",data:this.chartData.map((t=>t.usage.o1_mini||0)),itemStyle:{color:"#F56C6C",borderRadius:[4,4,0,0]},barMaxWidth:30,emphasis:{itemStyle:{color:"#F78989"}}}]};this.chart.setOption(t)}))},async statistic(t){try{this.chartsVisible=!0;const e=await I.get(`${v.apiBaseUrl}/account/statistic?id=${t}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?(this.chartData=e.data.data,this.initChart()):this.$message.error("获取统计数据失败")}catch(e){console.error("Error fetching statistics:",e),this.$message.error("获取统计数据时发生错误")}},closeChart(){this.chartsVisible=!1,this.chart&&(this.chart.dispose(),this.chart=null)},showConfirmDialog(t){this.currentIndex=t,this.isDialogVisible=!0},async fetchAccounts(t){try{this.loading=!0;const e=await I.get(`${v.apiBaseUrl}/account/list?page=`+this.currentPage+"&size=10&emailAddr="+t,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&e.data.data.total>0&&(this.tableData=e.data.data.data,this.total=e.data.data.total)}catch(e){console.log(e),k.error("获取账号列表失败")}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));if(-1!==a&&(this.formFields[a].value=e),"accountType"===t){const t=this.formFields.find((t=>"accessToken"===t.id)),a=this.formFields.find((t=>"refreshToken"===t.id));switch(e){case 1:t.label="ACCESS_TOKEN",a.hideLabel=!1,a.label="REFRESH_TOKEN";break;case 2:t.label="SESSION_KEY",a.hideLabel=!0;break;case 3:t.label="API_PROXY",a.hideLabel=!1,a.label="API_KEY";break;default:t.label="ChatGPT",a.hideLabel=!1,a.label="ChatGPT"}}},showModal(){this.modalTitle="新增账号",this.currentIndex=null,this.formFields=this.accountFields,this.resetFormFields(),this.modalVisible=!0},showShareModal(t){this.shareAddFlag=!0,this.modalTitle="新增共享",this.currentIndex=t,this.formFields=this.shareFields.filter((t=>!(!this.isAdmin&&"mjEnable"===t.id))),this.resetFormFields(),this.modalVisible=!0},async editItem(t){try{this.modalTitle="编辑账号",this.formFields=this.accountFields,this.currentIndex=t;const e=await I.get(`${v.apiBaseUrl}/account/getById?id=`+t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let a=e.data.data,s=1;this.formFields.forEach((t=>{t.value=a[t.id],"accountType"===t.id&&(s=t.value),this.formData[t.id]=a[t.id]}));const i=this.formFields.find((t=>"accessToken"===t.id)),r=this.formFields.find((t=>"refreshToken"===t.id));switch(s){case 1:r.hideLabel=!1,i.label="ACCESS_TOKEN",r.label="REFRESH_TOKEN";break;case 2:i.label="SESSION_KEY",r.hideLabel=!0;break;case 3:i.label="API_PROXY",r.hideLabel=!1,r.label="API_KEY";break;default:r.hideLabel=!1,r.label="ChatGPT"}this.modalVisible=!0}catch(e){k.error("获取账号信息失败")}},closeModal(){this.currentIndex=null,this.modalVisible=!1,this.shareAddFlag=!1},async submitForm(){try{const t={...this.formData};if(this.shareAddFlag){t.uniqueName=t.username,t.accountId=this.currentIndex;const e=await I.post(`${v.apiBaseUrl}/share/add`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?k.success("新增账号共享成功"):k.error(e.data.message)}else null!==this.currentIndex?(t.auto=t.auto?1:0,t.shared=t.shared?1:0,t.accountType=""===t.accountType?1:t.accountType,t.id=this.currentIndex,await I.patch(`${v.apiBaseUrl}/account/update`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),k.success("修改成功")):(t.auto=t.auto?1:0,t.shared=t.shared?1:0,t.accountType=""===t.accountType?1:t.accountType,await I.post(`${v.apiBaseUrl}/account/add`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),k.success("新增成功"));this.fetchAccounts(""),this.closeModal()}catch(t){k.error("操作失败，请稍后重试")}},resetFormFields(){this.shareAdd=!1,this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},emailQuery(){this.fetchAccounts(this.email)},async handleDelete(){try{const t=await I.delete(`${v.apiBaseUrl}/account/delete?id=`+this.currentIndex,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?k.success("删除成功"):k.error("删除失败，请稍后重试"),this.fetchAccounts(""),this.currentIndex=null,this.isDialogVisible=!1}catch(t){k.error("删除失败，请稍后重试")}},handleCurrentChange(){this.fetchAccounts("")},async refresh(t){try{const e=await I.post(`${v.apiBaseUrl}/account/refresh?id=`+t,{},{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?k.success("刷新成功"):k.error(e.data.msg)}catch(e){k.error("刷新失败，请稍后重试")}},async checkAdminStatus(){try{const t=await I.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status&&(this.isAdmin=1===t.data.data.id)}catch(t){console.error("获取用户信息失败:",t)}}},mounted(){this.fetchAccounts(""),this.checkIsMobile(),this.checkAdminStatus(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile),this.chart&&this.chart.dispose()}},Dt=Tt,At=(0,n.A)(Dt,bt,vt,!1,null,"aa639966",null),Pt=At.exports,Mt=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"bg-white dark:bg-gray-900 rounded-2xl shadow-lg m-5 min-h-[calc(100vh-40px)] flex flex-col border dark:border-gray-800",attrs:{id:"sharePanel"}},[e("header",{staticClass:"px-4 py-3"},[e("h2",{staticClass:"text-xl font-semibold text-gray-800 dark:text-gray-200"},[t._v("分享管理")])]),e("el-main",{staticClass:"flex-1"},[e("el-row",{staticClass:"mb-7"},[e("el-col",{attrs:{xs:24,sm:18,md:18}},[e("el-input",{staticClass:"w-full dark-input",attrs:{id:"email-query",placeholder:"请输入邮箱或用户名"},scopedSlots:t._u([{key:"input",fn:function(){return[e("input",{staticClass:"el-input__inner dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:placeholder-gray-500",attrs:{placeholder:"请输入邮箱或用户名"},domProps:{value:t.email},on:{input:e=>t.email=e.target.value}})]},proxy:!0}]),model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{staticClass:"dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1)],1),t.isMobile?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"space-y-4 md:hidden",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl border border-gray-100 dark:border-gray-700"},[e("div",{staticClass:"flex justify-between items-center mb-4"},[e("div",{staticClass:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-4 py-2 rounded-full flex items-center space-x-2 max-w-[70%] overflow-hidden"},[e("i",{staticClass:"el-icon-user"}),e("span",{staticClass:"truncate"},[t._v(t._s(a.uniqueName))])]),e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm"},[t._v(" "+t._s(a.comment)+" ")])]),e("div",{staticClass:"space-y-4"},[a.gptCarName?e("div",{staticClass:"space-y-2"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm"},[t._v("ChatGPT账号")]),e("div",{staticClass:"w-full"},[e("split-button",{attrs:{name:a.gptCarName,count:a.gptUserCount||0,type:"gpt",days:a.gptExpiresAt?t.calculateDays(a.gptExpiresAt):0,loading:a.loading},on:{click:function(e){return t.openChat(a.gptConfigId,1)}}})],1)]):t._e(),a.claudeCarName?e("div",{staticClass:"space-y-2"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm"},[t._v("Claude账号")]),e("div",{staticClass:"w-full"},[e("split-button",{attrs:{name:a.claudeCarName,count:a.claudeUserCount||0,type:"claude",days:a.claudeExpiresAt?t.calculateDays(a.claudeExpiresAt):0,loading:a.loading},on:{click:function(e){return t.openChat(a.claudeConfigId,2)}}})],1)]):t._e(),a.apiCarName?e("div",{staticClass:"space-y-2"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm"},[t._v("API账号")]),e("div",{staticClass:"w-full"},[e("split-button",{attrs:{name:a.apiCarName,count:a.apiUserCount||0,type:"api",days:a.apiExpiresAt?t.calculateDays(a.apiExpiresAt):0,loading:a.loading},on:{click:function(e){return t.openChat(a.apiConfigId,3)}}})],1)]):t._e()]),e("div",{staticClass:"my-4 h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"}),e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"flex space-x-2"},[e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"primary",size:"mini",loading:a.actionLoading},on:{click:function(e){return t.showShareModal(a.id)}}},[e("i",{staticClass:"el-icon-check mr-1"}),t._v(" 激活 ")]),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini",loading:a.actionLoading},on:{click:function(e){return t.editItem(a.id)}}},[e("i",{staticClass:"el-icon-edit mr-1"}),t._v(" 编辑 ")]),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"danger",size:"mini",loading:a.actionLoading},on:{click:function(e){return t.showConfirmDialog(a.id)}}},[e("i",{staticClass:"el-icon-delete mr-1"}),t._v(" 删除 ")])],1)])])})),0):e("div",{staticClass:"hidden md:block"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"adaptive-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,fit:!0,"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},[e("el-table-column",{attrs:{prop:"uniqueName",label:"用户名","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"right",width:"220",trigger:"hover"}},[e("div",{staticClass:"space-y-2 text-sm"},[a.row.gptExpiresAt?e("div",{staticClass:"flex items-center justify-between"},[e("span",{staticClass:"text-gray-500 dark:text-gray-400"},[t._v("ChatGPT过期时间：")]),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.gptExpiresAt))])]):t._e(),a.row.claudeExpiresAt?e("div",{staticClass:"flex items-center justify-between"},[e("span",{staticClass:"text-gray-500 dark:text-gray-400"},[t._v("Claude过期时间：")]),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.claudeExpiresAt))])]):t._e(),a.row.apiExpiresAt?e("div",{staticClass:"flex items-center justify-between"},[e("span",{staticClass:"text-gray-500 dark:text-gray-400"},[t._v("API过期时间：")]),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.apiExpiresAt))])]):t._e()]),e("div",{staticClass:"flex items-center space-x-2 px-2 py-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200",attrs:{slot:"reference"},slot:"reference"},[e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.uniqueName))])])])]}}],null,!1,3849423990)}),e("el-table-column",{attrs:{prop:"gptCarName",label:"ChatGPT账号","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("split-button",{attrs:{name:a.row.gptCarName,count:a.row.gptUserCount||0,type:"gpt",days:a.row.gptExpiresAt?t.calculateDays(a.row.gptExpiresAt):0,loading:a.row.loading},on:{click:function(e){return t.openChat(a.row.gptConfigId,1)}}})]}}],null,!1,1065539658)}),e("el-table-column",{attrs:{prop:"claudeCarName",label:"Claude账号","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("split-button",{attrs:{name:a.row.claudeCarName,count:a.row.claudeUserCount||0,type:"claude",days:a.row.claudeExpiresAt?t.calculateDays(a.row.claudeExpiresAt):0,loading:a.row.loading},on:{click:function(e){return t.openChat(a.row.claudeConfigId,2)}}})]}}],null,!1,989470057)}),e("el-table-column",{attrs:{prop:"apiCarName",label:"API账号","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("split-button",{attrs:{name:a.row.apiCarName,count:a.row.apiUserCount||0,type:"api",days:a.row.apiExpiresAt?t.calculateDays(a.row.apiExpiresAt):0,loading:a.row.loading},on:{click:function(e){return t.openChat(a.row.apiConfigId,3)}}})]}}],null,!1,4097514472)}),e("el-table-column",{attrs:{label:"操作","min-width":"280",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex space-x-2"},[e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showShareModal(a.row.id)}}},[t._v("激活")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.row.id)}}},[t._v("编辑")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.row.id)}}},[t._v("删除")])],1)]}}],null,!1,1923422123)})],1)],1),e("el-pagination",{class:[t.isMobile?"w-full flex justify-center py-4":"fixed bottom-8 right-8 z-10"],attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}}),e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue,handleSelectChange:t.handleSelectChange}})})),1),e("confirm-dialog",{attrs:{visible:t.isDialogVisible,title:"确认删除",message:"你确定要删除这个共享账户吗？"},on:{"update:visible":function(e){t.isDialogVisible=e},confirm:t.handleDelete}})],1)],1)},$t=[],zt=function(){var t=this,e=t._self._c;return e("el-tooltip",{attrs:{content:t.tooltipContent,placement:"top",effect:"light"}},[e("button",{staticClass:"split-button",class:[t.type,{disabled:0===t.count||t.loading}],on:{click:t.handleClick}},[e("span",{staticClass:"name-section"},[t.loading?e("i",{staticClass:"el-icon-loading type-icon"}):e("i",{staticClass:"type-icon",class:t.typeIcon}),t._v(" "+t._s(t.shortName)+" ")]),e("div",{staticClass:"info-section"},[e("span",{staticClass:"count-section"},[e("i",{staticClass:"el-icon-user user-icon"}),t._v(" "+t._s(t.count)+" ")]),void 0!==t.days&&"-"!==t.days?e("span",{staticClass:"days-section"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.days)+" 天 ")]):t._e()])])])},Et=[],jt={name:"SplitButton",props:{name:{type:String,required:!0},count:{type:[String,Number],default:0},days:{type:[String,Number],default:void 0},type:{type:String,default:"gpt",validator:function(t){return-1!==["gpt","claude","api"].indexOf(t)}},maxLength:{type:Number,default:10},loading:{type:Boolean,default:!1}},computed:{typeIcon(){const t={gpt:"el-icon-chat-dot-round",claude:"el-icon-message",api:"el-icon-connection"};return t[this.type]||"el-icon-chat-dot-round"},shortName(){return this.name.length>this.maxLength?this.name.substring(0,this.maxLength)+"...":this.name},tooltipContent(){return 0===Number(this.count)?"用户暂未拥有该类型账号":"点击开始对话"}},methods:{handleClick(){Number(this.count)>0&&!this.loading&&this.$emit("click")}}},Rt=jt,Bt=(0,n.A)(Rt,zt,Et,!1,null,"62e131e0",null),Ut=Bt.exports,Lt={name:"SharePage",components:{ConfirmDialog:St,EnhancedDialog:yt,FormInput:ut,SplitButton:Ut},data(){return{isMobile:!1,email:"",tableData:[],currentPage:1,total:0,isDialogVisible:!1,isAccDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,activateFlag:!1,accountOpts:[],loading:!1,formData:{},shareFormData:{},formFields:[{id:"uniqueName",label:"用户名",type:"text",value:"",required:!0,readonly:"1"},{id:"comment",label:"备注",type:"text",value:"",required:!0,readonly:!0},{id:"expiresAt",label:"过期时间",type:"date",value:"",required:!0}],accountFields:[{id:"uniqueName",label:"用户名",type:"text",value:"",required:!0},{id:"comment",label:"备注",type:"text",value:"",required:!0},{id:"mjEnable",label:"启用 Midjourney",type:"checkbox",value:"",required:!0}],shareFields:[{id:"accountType",label:"账号类型",type:"select",value:"ChatGPT",options:[{value:1,text:"ChatGPT"},{value:2,text:"Claude"},{value:3,text:"API"}],required:!0},{id:"accountOptions",label:"选择账号",type:"select",value:"",options:this.accountOpts},{id:"expiresAt",label:"过期时间",type:"date",value:"",required:!0}],isAdmin:!1}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},async openChat(t,e){if(null===t)return;const a=this.tableData.find((a=>{switch(e){case 1:return a.gptConfigId===t;case 2:return a.claudeConfigId===t;case 3:return a.apiConfigId===t}}));if(a){this.$set(a,"loading",!0);try{const a={withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}};let s;switch(e){case 1:s=await I.get(`${v.apiBaseUrl}/share/getGptShare?gptConfigId=${t}`,a);break;case 2:s=await I.get(`${v.apiBaseUrl}/share/getClaudeShare?claudeConfigId=${t}`,a);break;case 3:s=await I.get(`${v.apiBaseUrl}/share/getApiShare?apiConfigId=${t}`,a);break}s?.data?.status&&window.open(s.data.data)}catch(s){console.error("请求失败:",s),this.$message.error("操作失败，请重试")}finally{this.$set(a,"loading",!1)}}},showConfirmDialog(t){this.currentIndex=t,this.isDialogVisible=!0},async fetchItems(t){this.loading=!0;try{const e=await I.get(`${v.apiBaseUrl}/share/list?page=${this.currentPage}&size=10&emailAddr=${t}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&(this.tableData=e.data.data.data.map((t=>({...t,loading:!1}))),this.total=e.data.data.total)}catch(e){k.error(e)}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},showModal(){this.modalTitle="新增账号",this.currentIndex=null,this.formFields=this.accountFields,this.resetFormFields(),this.modalVisible=!0},async showShareModal(t){this.shareAddFlag=!0,this.modalTitle="激活",this.currentIndex=t,this.formFields=this.shareFields,this.resetFormFields(),this.modalVisible=!0,this.activateFlag=!0;try{const e=await I.get(`${v.apiBaseUrl}/account/options?type=1`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.accountOpts=e.data.data;const a=this.shareFields.find((t=>"accountOptions"===t.id));a&&(a.options=this.accountOpts,this.formData={accountId:parseInt(this.accountOpts[0]?.value),id:t})}catch(e){k.error("获取账号选项失败")}},async editItem(t){this.modalTitle="编辑共享",this.formFields=[{id:"uniqueName",label:"用户名",type:"text",value:"",required:!0},{id:"comment",label:"备注",type:"text",value:"",required:!0},...this.isAdmin?[{id:"mjEnable",label:"启用 Midjourney",type:"checkbox",value:"",required:!0}]:[]],this.currentIndex=t;try{const e=await I.get(`${v.apiBaseUrl}/share/getById?id=${t}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let a=e.data.data;this.formFields.forEach((t=>{t.value=a[t.id],this.formData[t.id]=a[t.id]})),this.modalVisible=!0}catch(e){k.error("获取共享信息失败")}},closeModal(){this.modalVisible=!1,this.shareAddFlag=!1,this.activateFlag=!1,this.formData={}},async submitForm(){const t={...this.formData},e=this.tableData.find((t=>t.id===this.currentIndex));e&&(e.actionLoading=!0);try{if(this.activateFlag){t.accountId=t.accountOptions?parseInt(t.accountOptions):t.accountId,t.id=this.currentIndex,t.accountType=parseInt(t.accountType);const e=await I.post(`${v.apiBaseUrl}/share/distribute`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?k.success("激活成功"):k.error(e.data.message)}else if(null!==this.currentIndex){t.id=this.currentIndex;const e=await I.patch(`${v.apiBaseUrl}/share/update`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&k.success("编辑成功")}}catch(a){k.error("操作失败")}finally{e&&(e.actionLoading=!1),await this.fetchItems(""),this.closeModal()}},resetFormFields(){this.shareAdd=!1,this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},emailQuery(){this.fetchItems(this.email)},async handleDelete(){const t=this.tableData.find((t=>t.id===this.currentIndex));t&&(t.actionLoading=!0);try{const t=await I.delete(`${v.apiBaseUrl}/share/delete?id=${this.currentIndex}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?k.success("删除成功"):k.error("删除失败，请稍后重试")}catch(e){k.error("删除失败")}finally{t&&(t.actionLoading=!1),await this.fetchItems(""),this.isDialogVisible=!1}},handleCurrentChange(){this.fetchItems("")},async handleSelectChange({type:t,field:e,value:a}){if(1===t&&"accountOptions"!==e.id)try{const t=await I.get(`${v.apiBaseUrl}/account/options?type=${a}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.accountOpts=t.data.data,e.value=a;const s=this.shareFields.find((t=>"accountOptions"===t.id));s&&(s.options=this.accountOpts)}catch(s){k.error("获取账号选项失败")}},calculateDays(t){if(!t||"-"===t)return"-";const e=new Date;e.setHours(0,0,0,0);const a=new Date(t);a.setHours(0,0,0,0);const s=a-e,i=Math.ceil(s/864e5);return Math.max(0,i)},async checkAdminRole(){try{const t=await I.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status&&(this.isAdmin=1===t.data.data.id)}catch(t){console.error("获取用户信息失败:",t)}}},mounted(){this.fetchItems(""),this.checkIsMobile(),this.checkAdminRole(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile)}},Vt=Lt,Ft=(0,n.A)(Vt,Mt,$t,!1,null,"5badafec",null),qt=Ft.exports,Ot=function(){var t=this,e=t._self._c;return e("div",{staticClass:"min-h-[calc(100vh-40px)] mx-5 my-[1.5%] bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-5"},[e("header",{staticClass:"mb-6"},[e("div",{staticClass:"flex items-center"},[e("h2",{staticClass:"text-2xl font-semibold text-gray-800 dark:text-gray-200 mr-6"},[t._v("免费号池")]),e("el-switch",{attrs:{"active-color":"#0e8f6f","active-text":"Claude","inactive-text":"ChatGPT"},on:{change:t.toggleAIType},model:{value:t.showClaude,callback:function(e){t.showClaude=e},expression:"showClaude"}})],1)]),e("main",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"relative",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},[t.pageLoading?e("el-skeleton",{attrs:{loading:t.pageLoading,animated:"",count:4}},[e("template",{slot:"template"},[e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5"},[e("div",{staticClass:"pb-4"},[e("div",{staticClass:"h-[150px] rounded-lg bg-gray-200 dark:bg-gray-700"})])])])],2):t._e(),t.isMobile?e("div",{staticClass:"mobile-view"},[t.pageLoading?t._e():e("div",{staticClass:"space-y-4 px-2.5"},t._l(t.filteredAccounts,(function(a,s){return e("div",{key:a.id,class:["p-4 bg-white dark:bg-gray-700/50 rounded-xl shadow-md transition-all duration-300 hover:shadow-lg dark:hover:bg-gray-700/70",{"opacity-80 bg-gray-50 dark:bg-gray-800/70":"1"===a.sessionToken}]},[e("div",{staticClass:"mb-4"},[e("div",{staticClass:"flex justify-between items-center"},[e("span",{staticClass:"text-base font-medium text-gray-700 dark:text-gray-200"},[t._v(t._s(a.type)+"账号 "+t._s(s+1))]),e("el-tag",{attrs:{type:""===a.sessionToken?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s(""!=a.sessionToken?"繁忙":"空闲")+" ")])],1)]),e("el-button",{staticClass:"!w-full !h-10 !text-base !font-medium",attrs:{type:"success",disabled:""!=a.sessionToken,loading:t.loadingAccounts[a.id],size:"medium"},on:{click:function(e){return t.useAccount(a.id)}}},[t._v(" "+t._s(""!=a.sessionToken?"暂不可用":t.loadingAccounts[a.id]?"跳转中...":"立即使用")+" ")])],1)})),0)]):e("div",{staticClass:"pc-view"},[t.pageLoading?t._e():e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 px-2.5"},t._l(t.filteredAccounts,(function(a,s){return e("div",{key:a.id,staticClass:"min-w-0"},[e("el-card",{class:["transition-all duration-300 hover:-translate-y-0.5 border-none shadow-md dark:!bg-gray-700/50 dark:hover:!bg-gray-700/70",{"opacity-80 bg-gray-50 dark:bg-gray-800/70":"1"===a.sessionToken}],attrs:{shadow:"hover"}},[e("div",{staticClass:"flex justify-between items-center",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"font-medium text-gray-700 dark:text-gray-200"},[t._v(t._s(a.type)+"账号 "+t._s(s+1))]),e("el-tag",{staticClass:"font-medium",attrs:{type:""===a.sessionToken?"success":"danger",size:"small",effect:"dark"}},[t._v(" "+t._s(""!=a.sessionToken?"繁忙":"空闲")+" ")])],1),e("el-button",{staticClass:"!w-full mt-2.5 font-medium !bg-gradient-to-r !from-emerald-600 !to-emerald-500 hover:!from-emerald-500 hover:!to-emerald-400 disabled:!opacity-70 disabled:!from-gray-600 disabled:!to-gray-500 dark:!from-emerald-500 dark:!to-emerald-400 dark:hover:!from-emerald-400 dark:hover:!to-emerald-300 !transition-all !duration-300 hover:!-translate-y-0.5 !shadow-emerald-200/20 dark:!shadow-emerald-900/30",attrs:{type:"primary",disabled:""!=a.sessionToken,loading:t.loadingAccounts[a.id],"element-loading-spinner":"el-icon-loading"},on:{click:function(e){return t.useAccount(a.id)}}},[t._v(" "+t._s(""!=a.sessionToken?"暂不可用":t.loadingAccounts[a.id]?"跳转中...":"立即使用")+" ")])],1)],1)})),0)]),t.pageLoading||0!==t.filteredAccounts.length?t._e():e("div",{staticClass:"text-center py-10 text-gray-400"},[e("i",{staticClass:"el-icon-warning-outline text-4xl mb-4"}),e("p",{staticClass:"text-base m-0"},[t._v("暂无可用账号")])])],1)])},Nt=[],Qt={name:"App",data(){return{accounts:[],showClaude:!0,pageLoading:!0,refreshInterval:null,retryCount:0,maxRetries:3,isMobile:!1,loadingAccounts:{}}},computed:{filteredAccounts(){return this.accounts.filter((t=>this.showClaude?"Claude"===t.type:"ChatGPT"===t.type))}},async created(){this.checkDeviceType(),window.addEventListener("resize",this.checkDeviceType),await this.initializeData(),this.startAutoRefresh()},beforeDestroy(){this.stopAutoRefresh(),window.removeEventListener("resize",this.checkDeviceType)},methods:{checkDeviceType(){this.isMobile=window.innerWidth<=768},async initializeData(){await this.fetchAccounts(),this.pageLoading=!1},startAutoRefresh(){this.refreshInterval=setInterval((()=>{this.fetchAccounts()}),3e4)},stopAutoRefresh(){this.refreshInterval&&clearInterval(this.refreshInterval)},async fetchAccounts(){try{const t=await I.get(`${v.apiBaseUrl}/account/list?type=`+(this.showClaude?2:1),{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")},timeout:1e4});if(t.data.status){const e=t.data.data.data;this.accounts=this.accounts.map((t=>{const a=e.find((e=>e.id===t.id));return a||t})),e.forEach((t=>{this.accounts.find((e=>e.id===t.id))||this.accounts.push(t)})),this.retryCount=0}}catch(t){this.retryCount<this.maxRetries?(this.retryCount++,setTimeout((()=>{this.fetchAccounts()}),2e3*this.retryCount)):k.error("获取账号列表失败，请刷新页面重试")}},async useAccount(t){if(!this.loadingAccounts[t]){this.loadingAccounts[t]=!0;try{const e=await I.get(`${v.apiBaseUrl}/account/share?id=`+t,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")},timeout:15e3});e.data.status?(window.open(e.data.data),this.loadingAccounts[t]=!1,await this.fetchAccounts()):(this.loadingAccounts[t]=!1,k.error(e.data.message||"使用账号失败"))}catch(e){this.loadingAccounts[t]=!1,k.error("系统错误,请稍后重试")}}},async toggleAIType(){this.pageLoading=!0,this.accounts=[],await this.fetchAccounts(),this.pageLoading=!1}}},Wt=Qt,Gt=(0,n.A)(Wt,Ot,Nt,!1,null,null,null),Kt=Gt.exports,Ht=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"bg-white dark:bg-gray-900 rounded-2xl shadow-lg m-5 min-h-[calc(100vh-40px)] flex flex-col border dark:border-gray-800",attrs:{id:"redemptionPanel"}},[e("header",{staticClass:"px-4 py-3"},[e("h2",{staticClass:"text-xl font-semibold text-gray-800 dark:text-gray-200"},[t._v("兑换码管理")])]),e("el-main",{staticClass:"flex-1"},[e("el-row",{staticClass:"mb-7"},[e("el-col",{attrs:{xs:24,sm:18,md:18}},[e("el-input",{staticClass:"w-full dark-input",attrs:{id:"email-query",placeholder:"请输入邮箱"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.emailQuery.apply(null,arguments)}},scopedSlots:t._u([{key:"input",fn:function(){return[e("input",{staticClass:"el-input__inner dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:placeholder-gray-500",attrs:{placeholder:"请输入邮箱"},domProps:{value:t.email},on:{input:e=>t.email=e.target.value}})]},proxy:!0}]),model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{staticClass:"dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1),e("el-col",{staticClass:"flex justify-end sm:mt-4 md:mt-0",attrs:{xs:24,sm:6,md:6}},[e("el-button",{staticClass:"w-full md:w-auto bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white transition-all duration-300 transform hover:-translate-y-0.5",attrs:{type:"primary"},on:{click:function(e){return t.showModal()}}},[t._v("新增")])],1)],1),e("div",{staticClass:"flex-1"},[t.isMobile?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"space-y-4 md:hidden",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl border border-gray-100 dark:border-gray-700"},[e("div",{staticClass:"flex justify-between items-center mb-4"},[e("div",{staticClass:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-4 py-2 rounded-full flex items-center space-x-2 max-w-[70%] overflow-hidden"},[e("i",{staticClass:"el-icon-message"}),e("el-tooltip",{attrs:{content:a.email,placement:"top",effect:"light"}},[e("span",{staticClass:"truncate"},[t._v(t._s(a.email))])])],1),e("div",{staticClass:"px-3 py-1 rounded-full text-sm font-medium",class:{"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400":"ChatGPT"===a.accountType,"bg-yellow-50 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400":"Claude"===a.accountType,"bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400":"API"===a.accountType}},[t._v(" "+t._s(a.accountType)+" ")])]),e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-key"}),e("span",[t._v("兑换码")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[e("el-tooltip",{attrs:{content:a.code,placement:"top",effect:"light"}},[e("span",[t._v(t._s(a.code))])])],1)]),e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v("兑换时长")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[t._v(t._s(a.duration)+" 天")])])])]),e("div",{staticClass:"my-4 h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"}),e("div",{staticClass:"flex space-x-2"},[e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.id)}}},[e("i",{staticClass:"el-icon-edit mr-1"}),t._v(" 编辑 ")]),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.id)}}},[e("i",{staticClass:"el-icon-delete mr-1"}),t._v(" 删除 ")])],1)])})),0):e("div",{staticClass:"hidden md:block"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"adaptive-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,fit:!0,"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},[e("el-table-column",{attrs:{prop:"email",label:"名称","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2"},[e("i",{staticClass:"el-icon-user text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.email))])])]}}],null,!1,1593351194)}),e("el-table-column",{attrs:{prop:"accountType",label:"账号类型","min-width":"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{class:{"bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800":"ChatGPT"===a.row.accountType,"bg-yellow-50 text-yellow-600 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800":"Claude"===a.row.accountType,"bg-blue-50 text-blue-600 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800":"API"===a.row.accountType},attrs:{size:"mini",effect:"plain"}},[t._v(" "+t._s(a.row.accountType)+" ")])]}}],null,!1,227046868)}),e("el-table-column",{attrs:{prop:"code",label:"兑换码","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{attrs:{content:a.row.code,placement:"top",effect:"light"}},[e("div",{staticClass:"flex items-center space-x-2"},[e("i",{staticClass:"el-icon-key text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.code))])])])]}}],null,!1,2201205336)}),e("el-table-column",{attrs:{prop:"duration",label:"兑换时长","min-width":"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2"},[e("i",{staticClass:"el-icon-time text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.duration)+" 天")])])]}}],null,!1,2099419278)}),e("el-table-column",{attrs:{label:"操作","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex space-x-2"},[e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.editItem(a.row.id)}}},[e("i",{staticClass:"el-icon-edit mr-1"}),t._v(" 编辑 ")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.showConfirmDialog(a.row.id)}}},[e("i",{staticClass:"el-icon-delete mr-1"}),t._v(" 删除 ")])],1)]}}],null,!1,2221091965)})],1)],1)]),e("el-pagination",{class:[t.isMobile?"w-full flex justify-center py-4":"fixed bottom-8 right-8 z-10"],attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}}),e("enhanced-dialog",{attrs:{isVisible:t.modalVisible,title:t.modalTitle},on:{close:t.closeModal,confirm:t.submitForm}},t._l(t.formFields,(function(a,s){return e("form-input",{key:s,attrs:{field:a},on:{updateValue:t.handleUpdateValue,handleSelectChange:t.handleSelectChange}})})),1),e("confirm-dialog",{attrs:{visible:t.isDialogVisible,title:"确认删除",message:"你确定要删除这个兑换码吗？"},on:{"update:visible":function(e){t.isDialogVisible=e},confirm:t.handleDelete}})],1)],1)},Yt=[],Xt=a(2522),Jt={name:"RedemptionPage",components:{ConfirmDialog:St,EnhancedDialog:yt,FormInput:ut},data(){return{isMobile:!1,email:"",tableData:[],currentPage:1,pageSize:10,total:0,loading:!1,isDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,formData:{},formFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],accountFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],shareFields:[{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0}]}},computed:{tableHeight(){return`calc(100vh - ${this.headerHeight+this.searchHeight+this.paginationHeight+this.padding}px)`}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},showConfirmDialog(t){this.currentIndex=t,this.isDialogVisible=!0},async fetchItems(t){try{this.loading=!0;const e=await I.get(`${v.apiBaseUrl}/redemption/list`,{params:{page:this.currentPage,size:this.pageSize,emailAddr:t},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});e.data.status&&(this.tableData=e.data.data.data,this.total=e.data.data.total)}catch(e){k.error(e.message||"获取数据失败")}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},async showModal(){try{this.modalTitle="新增兑换码",this.currentIndex=null,this.formFields=this.accountFields,this.resetFormFields(),this.modalVisible=!0;const t=await I.get(`${v.apiBaseUrl}/account/list`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=this.accountFields.find((t=>"accountId"===t.id));e&&t.data.status&&(e.options=t.data.data.data.map((t=>({text:`${t.name}(${1===t.accountType?"ChatGPT":2===t.accountType?"Claude":"API"})`,value:t.id}))))}catch(t){k.error(t.message||"获取账号列表失败")}},async editItem(t){try{this.modalTitle="编辑兑换码",this.formFields=this.shareFields,this.currentIndex=t;const e=await I.get(`${v.apiBaseUrl}/redemption/getById`,{params:{id:t},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.data.status){const t=e.data.data;this.formFields.forEach((e=>{e.value=t[e.id],this.$set(this.formData,e.id,t[e.id])})),this.modalVisible=!0}}catch(e){k.error(e.message||"获取兑换码详情失败")}},closeModal(){this.modalVisible=!1,this.currentIndex=null,this.formData={}},async submitForm(){try{const t={...this.formData};if(this.currentIndex){t.id=this.currentIndex,t.duration=parseInt(t.duration);const e=await I.patch(`${v.apiBaseUrl}/redemption/update`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.data.status)throw new Error("更新失败");k.success("更新成功")}else{t.accountId=parseInt(t.accountId),t.count=parseInt(t.count),t.duration=parseInt(t.duration);const e=await I.post(`${v.apiBaseUrl}/redemption/add`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.data.status)throw new Error(e.data.message);k.success("新增成功")}this.closeModal(),this.fetchItems("")}catch(t){k.error(t.message||"操作失败")}},resetFormFields(){this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.$set(this.formData,t.id,e)}))},emailQuery:(0,Xt.debounce)((function(){this.currentPage=1,this.fetchItems(this.email)}),300),async handleDelete(){try{const t=await I.delete(`${v.apiBaseUrl}/redemption/delete`,{params:{id:this.currentIndex},headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.data.status)throw new Error("删除失败");k.success("删除成功"),this.fetchItems("")}catch(t){k.error(t.message||"删除失败")}finally{this.isDialogVisible=!1}},handleCurrentChange(t){this.currentPage=t,this.fetchItems(this.email)},handleSelectChange({type:t,field:e,value:a}){console.log("Select changed:",{type:t,field:e,value:a})}},mounted(){this.fetchItems(""),this.checkIsMobile(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile)}},Zt=Jt,te=(0,n.A)(Zt,Ht,Yt,!1,null,"7c36fe6c",null),ee=te.exports,ae=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"bg-white dark:bg-gray-900 rounded-2xl shadow-lg m-5 min-h-[calc(100vh-40px)] flex flex-col border dark:border-gray-800",attrs:{id:"carPanel"}},[e("header",{staticClass:"px-4 py-3"},[e("h2",{staticClass:"text-xl font-semibold text-gray-800 dark:text-gray-200"},[t._v("停车场")])]),e("el-main",{staticClass:"flex-1"},[e("el-row",{staticClass:"mb-7"},[e("el-col",{attrs:{xs:24,sm:18,md:18}},[e("el-input",{staticClass:"w-full dark-input",attrs:{id:"email-query",placeholder:"输入车主名称查询"},scopedSlots:t._u([{key:"input",fn:function(){return[e("input",{staticClass:"el-input__inner dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:placeholder-gray-500",attrs:{placeholder:"输入车主名称查询"},domProps:{value:t.email},on:{input:e=>t.email=e.target.value}})]},proxy:!0}]),model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("el-button",{staticClass:"dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",attrs:{slot:"append"},on:{click:t.emailQuery},slot:"append"},[t._v("查询")])],1)],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isMobile,expression:"!isMobile"}],staticClass:"hidden md:block"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"adaptive-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},[e("el-table-column",{attrs:{prop:"email",label:"账号","min-width":"180","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"right",width:"220",trigger:"hover"}},[e("div",{staticClass:"space-y-2 text-sm"},[e("div",{staticClass:"flex items-center justify-between"},[e("span",{staticClass:"text-gray-500 dark:text-gray-400"},[t._v("账号类型：")]),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.type))])]),"ChatGPT"===a.row.type?e("div",{staticClass:"flex items-center justify-between"},[e("span",{staticClass:"text-gray-500 dark:text-gray-400"},[t._v("计划类型：")]),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.planType))])]):t._e()]),e("div",{staticClass:"flex items-center space-x-2 px-2 py-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"el-icon-message text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.email))])])])]}}])}),e("el-table-column",{attrs:{prop:"type",label:"账号类型","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2 px-2"},[e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.type))]),"ChatGPT"===a.row.type?["plus"===a.row.planType?e("el-tag",{staticClass:"bg-yellow-50 text-yellow-600 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800",attrs:{effect:"plain",size:"mini"}},[t._v("Plus")]):"free"===a.row.planType?e("el-tag",{staticClass:"bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800",attrs:{effect:"plain",size:"mini"}},[t._v("Free")]):"team"===a.row.planType?e("el-tag",{staticClass:"bg-blue-50 text-blue-600 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800",attrs:{effect:"plain",size:"mini"}},[t._v("Team")]):"pro"===a.row.planType?e("el-tag",{staticClass:"bg-black text-yellow-400 border-yellow-500 dark:bg-black/40 dark:text-yellow-300 dark:border-yellow-600",attrs:{effect:"plain",size:"mini"}},[t._v("Pro")]):e("el-tag",{staticClass:"bg-gray-50 text-gray-600 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800",attrs:{effect:"plain",size:"mini"}},[t._v("无效")])]:t._e()],2)]}}])}),e("el-table-column",{attrs:{prop:"auto",label:"自动上车",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:["px-3 py-1 rounded-full text-sm font-medium",1===a.row.auto?"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400":"bg-gray-50 text-gray-600 dark:bg-gray-900/20 dark:text-gray-400"]},[t._v(" "+t._s(1===a.row.auto?"yes!":"No")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"usernameDesc",label:"车主","min-width":"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center space-x-2 px-2"},[e("i",{staticClass:"el-icon-user text-gray-400 text-sm"}),e("span",{staticClass:"text-gray-700 dark:text-gray-300"},[t._v(t._s(a.row.usernameDesc))])])]}}])}),e("el-table-column",{attrs:{prop:"countDesc",label:"已上车人数 / 总人数","min-width":"160",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex items-center justify-center space-x-1"},[e("span",{staticClass:"text-green-500 font-semibold"},[t._v(t._s(a.row.countDesc.split("/")[0]))]),e("span",{staticClass:"text-gray-400"},[t._v("/")]),e("span",{staticClass:"text-blue-500 font-semibold"},[t._v(t._s(a.row.countDesc.split("/")[1]))])])]}}])}),e("el-table-column",{attrs:{label:"操作",width:"280",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"flex space-x-2"},[!0===a.row.authorized?e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showModal(a.row.id)}}},[t._v("审核")]):t._e(),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.contact(a.row.username)}}},[t._v("联系车主")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"success",size:"mini"},on:{click:function(e){return t.applyCar(a.row.id)}}},[t._v("我要上车")])],1)]}}])})],1)],1),t.isMobile?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"space-y-4 md:hidden",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"}},t._l(t.tableData,(function(a,s){return e("div",{key:s,staticClass:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl border border-gray-100 dark:border-gray-700"},[e("div",{staticClass:"flex justify-between items-center mb-4"},[e("div",{staticClass:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-4 py-2 rounded-full flex items-center space-x-2 max-w-[70%] overflow-hidden"},[e("i",{staticClass:"el-icon-user"}),e("span",{staticClass:"truncate"},[t._v(t._s(a.email))])]),e("div",{staticClass:"px-3 py-1 rounded-full text-sm font-medium",class:{"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400":1===a.auto,"bg-yellow-50 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400":1!==a.auto}},[t._v(" "+t._s(1===a.auto?"自动上车":"审核上车")+" ")])]),e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"grid grid-cols-1 sm:grid-cols-3 gap-4"},[e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-key"}),e("span",[t._v("账号类型")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[t._v(t._s(a.type))])]),e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v("车主")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[t._v(t._s(a.usernameDesc))])]),e("div",{staticClass:"space-y-1"},[e("div",{staticClass:"text-gray-500 dark:text-gray-400 text-sm flex items-center space-x-2"},[e("i",{staticClass:"el-icon-s-data"}),e("span",[t._v("上车情况")])]),e("div",{staticClass:"text-gray-900 dark:text-gray-100 font-semibold"},[t._v(t._s(a.countDesc))])])])]),e("div",{staticClass:"my-4 h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"}),e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"flex space-x-2"},[!0===a.authorized?e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showModal(a.id)}}},[e("i",{staticClass:"el-icon-check mr-1"}),t._v(" 审核 ")]):t._e(),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.contact(a.username)}}},[e("i",{staticClass:"el-icon-message mr-1"}),t._v(" 联系车主 ")]),e("el-button",{staticClass:"flex-1 hover:-translate-y-0.5 transition-transform duration-200",attrs:{type:"success",size:"mini"},on:{click:function(e){return t.applyCar(a.id)}}},[e("i",{staticClass:"el-icon-plus mr-1"}),t._v(" 上车 ")])],1)])])})),0):t._e(),e("el-pagination",{class:[t.isMobile?"w-full flex justify-center py-4":"fixed bottom-8 right-8 z-10"],attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:t.isMobile?"prev, pager, next":"total, prev, pager, next, jumper","pager-count":t.isMobile?5:7,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}}),e("el-dialog",{staticClass:"rounded-lg",attrs:{visible:t.auditVisible,title:"审核申请",width:t.isMobile?"95%":"360px",fullscreen:!1},on:{"update:visible":function(e){t.auditVisible=e}}},[e("div",{staticClass:"space-y-4"},[e("el-checkbox-group",{staticClass:"flex flex-col space-y-3",model:{value:t.auditValues,callback:function(e){t.auditValues=e},expression:"auditValues"}},t._l(t.auditOptions,(function(a){return e("el-checkbox",{key:a.value,staticClass:"!mr-0 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200",attrs:{label:a.value}},[t._v(" "+t._s(a.label)+" ")])})),1)],1),e("div",{staticClass:"flex justify-end space-x-2",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{size:"small",type:"danger"},on:{click:function(e){return t.submitAudit(0)}}},[t._v("拒绝")]),e("el-button",{staticClass:"hover:-translate-y-0.5 transition-transform duration-200",attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submitAudit(1)}}},[t._v("通过")])],1)])],1)],1)},se=[];const ie=new s["default"];var re={name:"SharePage",data(){return{isMobile:!1,email:"",tableData:[],currentPage:1,total:0,isDialogVisible:!1,isAccDialogVisible:!1,modalVisible:!1,modalTitle:"新增项目",currentIndex:null,activateFlag:!1,accountOpts:[],auditVisible:!1,auditValues:[],auditOptions:[],auditCarId:null,loading:!1,formData:{},shareFormData:{},formFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],accountFields:[{id:"accountId",label:"账号",type:"select",value:"",required:!0,readonly:"1",options:[]},{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0},{id:"count",label:"兑换数量",type:"number",value:"",required:!0}],shareFields:[{id:"duration",label:"兑换时长(天)",type:"number",value:"",required:!0,readonly:!0}]}},methods:{checkIsMobile(){this.isMobile=window.innerWidth<=768},async jump(){ie.$emit("envVariableChanged","jump")},async submitAudit(t){try{const e=await I.post(`${v.apiBaseUrl}/car/audit`,{accountId:this.auditCarId,allowApply:t,ids:this.auditValues},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?k.success("审核成功"):k.error(e.data.message),this.auditVisible=!1,this.auditValues=[],this.auditCarId=null,this.fetchItems("")}catch(e){k.error(e)}},async applyCar(t){try{const e=await I.post(`${v.apiBaseUrl}/car/apply`,{accountId:t},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?k.success("申请成功"):k.error(e.data.message),this.closeModal()}catch(e){k.error(e)}},async fetchItems(t){this.loading=!0;try{const e=await I.get(`${v.apiBaseUrl}/car/list?page=${this.currentPage}&size=10&owner=${t}`,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status&&(this.tableData=e.data.data.data,this.total=e.data.data.total)}catch(e){k.error(e)}finally{this.loading=!1}},handleUpdateValue(t,e){this.$set(this.formData,t,e);const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},async showModal(t){try{this.auditVisible=!0,this.auditCarId=t;const e=await I.get(`${v.apiBaseUrl}/car/fetchApplies?accountId=${this.auditCarId}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.auditOptions=e.data.data}catch(e){k.error(e)}},contact(t){window.open("https://linux.do/u/"+t+"/summary")},closeModal(){this.modalVisible=!1,this.shareAddFlag=!1,this.currentIndex=null},async submitForm(){const t={...this.formData};try{if(this.currentIndex)t.id=this.currentIndex,t.duration=parseInt(t.duration),await I.patch(`${v.apiBaseUrl}/redemption/update`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});else{t.accountId=parseInt(t.accountId),t.count=parseInt(t.count),t.duration=parseInt(t.duration);const e=await I.post(`${v.apiBaseUrl}/redemption/add`,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.data.status?k.success("新增成功"):k.error(e.data.message),this.closeModal()}this.fetchItems(""),this.closeModal()}catch(e){k.error(e)}},resetFormFields(){this.shareAdd=!1,this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},emailQuery(){this.fetchItems(this.email)},handleCurrentChange(){this.fetchItems("")},async handleSelectChange({type:t,field:e,value:a}){console.log(t,e,a)}},mounted(){this.fetchItems(""),this.checkIsMobile(),window.addEventListener("resize",this.checkIsMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIsMobile)}},oe=re,le=(0,n.A)(oe,ae,se,!1,null,"c984a3ce",null),ne=le.exports,ce=function(){var t=this,e=t._self._c;return e("el-container",{staticClass:"min-h-screen bg-gradient-to-br from-gray-50 via-gray-100 to-gray-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900"},[t.showViewer?e("dialog",{staticClass:"fixed inset-0 z-[9999] w-full h-full bg-black bg-opacity-75 flex items-center justify-center",on:{click:function(e){return e.target!==e.currentTarget?null:t.closeViewer.apply(null,arguments)}}},[e("div",{staticClass:"relative w-full h-full flex items-center justify-center",on:{click:function(e){return e.target!==e.currentTarget?null:t.closeViewer.apply(null,arguments)}}},[e("button",{staticClass:"absolute top-4 right-4 text-white hover:text-gray-300 z-[9999]",on:{click:t.closeViewer}},[e("i",{staticClass:"el-icon-close text-2xl"})]),e("img",{staticClass:"max-w-full max-h-full object-contain",attrs:{src:t.previewUrl},on:{click:function(t){t.stopPropagation()}}})])]):t._e(),t.showImageEditor?e("div",{staticClass:"fixed inset-0 z-[9999] overflow-y-auto"},[e("div",{staticClass:"fixed inset-0 bg-black bg-opacity-75 transition-opacity",on:{click:t.handleEditorClose}}),e("div",{staticClass:"flex min-h-full items-center justify-center p-4 text-center sm:p-0"},[e("div",{staticClass:"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-3xl"},[e("div",{staticClass:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700"},[e("h3",{staticClass:"text-lg font-medium text-gray-900 dark:text-gray-100"},[t._v("图片编辑")]),e("button",{staticClass:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors",on:{click:t.handleEditorClose}},[e("svg",{staticClass:"h-5 w-5",attrs:{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"}})])])]),e("div",{staticClass:"p-4"},[e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"w-full border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden flex items-center justify-center bg-gray-50 dark:bg-gray-900",staticStyle:{height:"calc(100vh - 400px)"}},[e("canvas",{ref:"imageCanvas",staticClass:"max-w-full max-h-full object-contain",on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,mouseleave:t.handleMouseUp}})]),e("div",{staticClass:"space-y-2"},[e("div",{staticClass:"text-sm font-medium text-gray-600 dark:text-gray-400"},[t._v("提示词")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editPrompt,expression:"editPrompt"}],staticClass:"block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100 sm:text-sm",attrs:{rows:"3",placeholder:"请输入提示词"},domProps:{value:t.editPrompt},on:{input:function(e){e.target.composing||(t.editPrompt=e.target.value)}}})])])]),e("div",{staticClass:"flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},[e("button",{staticClass:"inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",on:{click:t.handleEditorClose}},[t._v(" 取消 ")]),e("button",{staticClass:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",on:{click:t.handleEditorConfirm}},[t._v(" 确定 ")])])])])]):t._e(),e("el-main",{ref:"mainContainer",staticClass:"p-2 md:p-6"},[e("div",{staticClass:"w-full h-full"},[e("div",{staticClass:"grid grid-cols-1 xl:grid-cols-4 gap-8"},[e("div",{staticClass:"xl:col-span-1 h-full"},[e("div",{staticClass:"sticky top-6"},[e("div",{staticClass:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.1)] overflow-hidden"},[e("div",{staticClass:"px-8 py-4 border-b border-gray-100 dark:border-gray-700/50"},[e("h2",{staticClass:"text-xl font-medium text-gray-800 dark:text-gray-100"},[t._v("绘图设置")])]),e("div",{staticClass:"p-6"},[e("el-form",{ref:"form",staticClass:"space-y-4",attrs:{model:t.formData,rules:t.rules,"label-position":"top"}},[e("el-form-item",{staticClass:"mb-4",attrs:{label:"提示词",prop:"prompt"}},[e("el-input",{staticClass:"w-full !rounded-xl !border-gray-200 dark:!border-gray-700 dark:!bg-gray-800 dark:!text-gray-100 hover:!border-blue-500 dark:hover:!border-blue-400 focus:!border-blue-500 dark:focus:!border-blue-400 !shadow-sm dark:!shadow-gray-900/30 transition-colors duration-300",attrs:{type:"textarea",rows:3,placeholder:"例如：一只可爱的猫咪坐在窗台上，阳光洒在它的身上..."},model:{value:t.formData.prompt,callback:function(e){t.$set(t.formData,"prompt",e)},expression:"formData.prompt"}})],1),e("el-form-item",{staticClass:"mb-4",attrs:{label:"宽高比例"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"选择宽高比例"},model:{value:t.formData.aspectRatio,callback:function(e){t.$set(t.formData,"aspectRatio",e)},expression:"formData.aspectRatio"}},[e("el-option",{attrs:{label:"默认",value:""}}),e("el-option",{attrs:{label:"16:9",value:"--ar 16:9"}}),e("el-option",{attrs:{label:"4:3",value:"--ar 4:3"}}),e("el-option",{attrs:{label:"1:1",value:"--ar 1:1"}}),e("el-option",{attrs:{label:"9:16",value:"--ar 9:16"}})],1)],1),e("el-form-item",{staticClass:"mb-4",attrs:{label:"预设风格"}},[e("el-select",{staticClass:"w-full !rounded-xl dark:!bg-gray-800 dark:!border-gray-700",attrs:{placeholder:"选择预设风格",clearable:""},on:{change:t.handleStyleChange},model:{value:t.selectedStyle,callback:function(e){t.selectedStyle=e},expression:"selectedStyle"}},t._l(t.presetStyles,(function(a){return e("el-option",{key:a.name,staticClass:"group !h-auto dark:!bg-gray-800 dark:hover:!bg-gray-700",attrs:{label:a.name,value:a.name}},[e("div",{staticClass:"flex items-center justify-between py-2"},[e("div",{staticClass:"text-sm font-medium text-gray-800 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300"},[t._v(" "+t._s(a.name)+" ")]),e("div",{staticClass:"text-xs text-gray-500 dark:text-gray-400 ml-4 text-right"},[t._v(" "+t._s(a.description)+" ")])])])})),1)],1),e("el-form-item",{staticClass:"mb-4",attrs:{label:"参考图片"}},[e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"relative group"},[e("div",{staticClass:"border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl p-3 group-hover:border-blue-500/50 dark:group-hover:border-blue-400/50 transition-all duration-300 cursor-pointer bg-gray-50/50 dark:bg-gray-800/50",on:{click:t.triggerFileInput,dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),t.handleDrop.apply(null,arguments)}}},[e("input",{ref:"fileInput",staticClass:"hidden",attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:t.handleFileChange}}),e("div",{staticClass:"flex flex-col items-center justify-center py-1 group-hover:scale-105 transition-all duration-300"},[e("div",{staticClass:"w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center mb-1.5 group-hover:bg-blue-100 dark:group-hover:bg-blue-800/30 transition-colors duration-300"},[e("i",{staticClass:"el-icon-plus text-lg text-blue-500/80 dark:text-blue-400/80 group-hover:text-blue-600 dark:group-hover:text-blue-300 transition-colors duration-300"})]),e("span",{staticClass:"text-sm font-medium text-gray-600 dark:text-gray-300 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300"},[t._v("点击或拖拽上传")]),e("span",{staticClass:"text-xs text-gray-400 dark:text-gray-500"},[t._v("支持多张图片")])])])]),t.imageList.length>0?e("div",{staticClass:"grid grid-cols-4 gap-2 overflow-y-auto",staticStyle:{"max-height":"min(200px, calc(100vh - 45rem))"}},t._l(t.imageList,(function(a,s){return e("div",{key:s,staticClass:"relative group rounded-lg overflow-hidden ring-1 ring-gray-200 dark:ring-gray-700"},[e("img",{staticClass:"w-full h-16 object-cover transition-all duration-500 group-hover:scale-110",attrs:{src:a.url},on:{click:function(e){return t.previewImage({imageUrl:a.url})}}}),e("div",{staticClass:"absolute inset-0 bg-gradient-to-b from-transparent to-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300"},[e("div",{staticClass:"absolute inset-0 flex items-center justify-center"},[e("button",{staticClass:"p-2 bg-white/10 backdrop-blur-sm rounded-lg text-white/90 hover:bg-white/20 transition-all duration-300",on:{click:function(e){return e.stopPropagation(),t.removeImage(s)}}},[e("i",{staticClass:"el-icon-delete text-lg"})])])])])})),0):t._e()])]),e("el-form-item",{staticClass:"mb-4"},[e("el-button",{staticClass:"w-full flex items-center justify-center py-1.5 text-emerald-600 hover:text-emerald-700 dark:text-emerald-500 dark:hover:text-emerald-400 border border-dashed border-emerald-200 dark:border-emerald-800/50 hover:border-emerald-500/50 dark:hover:border-emerald-400/50 hover:bg-emerald-50/50 dark:hover:bg-emerald-900/20 rounded-lg transition-all duration-300",attrs:{type:"text"},on:{click:function(e){t.showAdvancedSettings=!0}}},[e("i",{staticClass:"el-icon-setting mr-2 text-lg"}),e("span",{staticClass:"text-sm font-medium"},[t._v("高级设置")])])],1),e("el-form-item",[e("el-button",{staticClass:"w-full h-10 !rounded-xl bg-[#1A9168] hover:bg-[#158055] border-0 text-base font-medium shadow-lg shadow-[#1A9168]/20 hover:shadow-xl hover:shadow-[#1A9168]/30 transform hover:-translate-y-0.5 transition-all duration-300 !flex !items-center !justify-center",attrs:{type:"primary",loading:t.loading||t.permissionLoading,disabled:!t.hasPermission},on:{click:t.submitDrawing}},[e("div",{staticClass:"flex items-center justify-center w-full"},[t.loading||t.permissionLoading?t._e():e("i",{staticClass:"el-icon-picture-outline mr-2"}),e("span",[t._v(t._s(t.loading?"绘图中...":t.permissionLoading?"验证中...":t.hasPermission?"开始绘图":"无权限"))])])])],1)],1)],1)])])]),e("div",{staticClass:"xl:col-span-3"},[t.showImageDetail?e("div",{staticClass:"bg-white/80 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl shadow-lg min-h-[calc(100vh-4rem)]"},[e("div",{staticClass:"flex items-center justify-between px-8 py-5 border-b border-gray-200/50 dark:border-gray-700/50"},[e("div",{staticClass:"flex items-center space-x-4"},[e("span",{staticClass:"text-xl font-semibold text-gray-800 dark:text-gray-200"},[t._v("图片编辑")]),e("el-button",{staticClass:"text-gray-600/90 hover:text-blue-500",attrs:{icon:"el-icon-back",type:"text"},on:{click:function(e){t.showImageDetail=!1}}},[t._v(" 返回任务队列 ")])],1)]),e("div",{staticClass:"p-6"},[e("div",{staticClass:"flex flex-col md:flex-row gap-6 h-[calc(100vh-12rem)]"},[e("div",{staticClass:"md:w-2/3 h-full"},[e("div",{staticClass:"relative rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 h-full flex items-center justify-center"},[t.currentTask&&t.currentTask.imageUrl?e("img",{staticClass:"max-w-full max-h-full object-contain cursor-zoom-in hover:opacity-90 transition-opacity",attrs:{src:t.currentTask.imageUrl},on:{click:function(e){return t.handlePreviewImage(t.currentTask.imageUrl)}}}):t._e()])]),e("div",{staticClass:"md:w-1/3 h-full flex flex-col"},[e("div",{staticClass:"flex-1 space-y-4 overflow-y-auto custom-scrollbar"},[e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"text-sm font-medium text-gray-600 dark:text-gray-400"},[t._v("提示词")]),e("div",{staticClass:"relative group"},[e("div",{staticClass:"p-5 bg-gray-50 dark:bg-gray-800 rounded-lg text-gray-800 dark:text-gray-200 break-words whitespace-pre-wrap max-h-32 overflow-y-auto"},[t._v(t._s(t.currentTask?t.currentTask.prompt:""))]),t.currentTask?.prompt?e("button",{staticClass:"absolute top-3 right-3 p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 bg-white dark:bg-gray-700 rounded-md shadow-sm transition-colors opacity-0 group-hover:opacity-100",on:{click:function(e){return t.copyPrompt(t.currentTask?.prompt)}}},[e("i",{staticClass:"el-icon-document-copy text-sm"})]):t._e()])]),e("div",{staticClass:"grid grid-cols-2 gap-4"},[e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"text-sm font-medium text-gray-600 dark:text-gray-400"},[t._v("任务状态")]),e("el-tag",{attrs:{type:t.getStatusType(t.currentTask?.status)}},[t._v(t._s(t.getStatusText(t.currentTask?.status)))])],1),e("div",{staticClass:"space-y-3"},[e("div",{staticClass:"text-sm font-medium text-gray-600 dark:text-gray-400"},[t._v("任务类型")]),e("el-tag",{attrs:{type:"info"}},[t._v(t._s(t.getActionText(t.currentTask?.action)))])],1)]),e("div",{staticClass:"space-y-4"},[e("div",{staticClass:"text-sm font-medium text-gray-600 dark:text-gray-400"},[t._v("可用操作")]),e("div",{staticClass:"grid grid-cols-2 gap-2"},[t.currentTask&&t.currentTask.buttons&&t.currentTask.buttons.some((t=>t.customId.includes("upsample")))?t._l(t.currentTask.buttons.filter((t=>t.customId.includes("upsample"))),(function(a){return e("button",{key:a.customId,staticClass:"flex items-center justify-center w-full h-9 px-3 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 hover:border-blue-300 transition-colors duration-200",on:{click:function(e){return t.handleButtonAction(a,t.currentTask)}}},[e("i",{staticClass:"el-icon-zoom-in mr-2"}),e("span",[t._v(t._s(a.label))])])})):t._e(),t.currentTask&&t.currentTask.buttons&&t.currentTask.buttons.some((t=>t.customId.includes("variation")))?t._l(t.currentTask.buttons.filter((t=>t.customId.includes("variation"))),(function(a){return e("button",{key:a.customId,staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-yellow-600 bg-yellow-50 border border-yellow-200 rounded-md hover:bg-yellow-100 hover:border-yellow-300 transition-colors duration-200",on:{click:function(e){return t.handleButtonAction(a,t.currentTask)}}},[e("i",{staticClass:"el-icon-refresh mr-2"}),e("span",[t._v(t._s(a.label))])])})):t._e(),t.currentTask&&t.currentTask.buttons&&t.currentTask.buttons.some((t=>t.customId.includes("Inpaint")))?t._l(t.currentTask.buttons.filter((t=>t.customId.includes("Inpaint"))),(function(a){return e("button",{key:a.customId,staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-green-600 bg-green-50 border border-green-200 rounded-md hover:bg-green-100 hover:border-green-300 transition-colors duration-200",on:{click:function(e){return t.handleButtonAction(a,t.currentTask)}}},[e("i",{staticClass:"el-icon-edit mr-2"}),e("span",[t._v(t._s(a.label))])])})):t._e(),t.currentTask&&t.currentTask.buttons&&t.currentTask.buttons.some((t=>t.customId.includes("Outpaint")||t.customId.includes("CustomZoom")))?t._l(t.currentTask.buttons.filter((t=>t.customId.includes("Outpaint")||t.customId.includes("CustomZoom"))),(function(a){return e("button",{key:a.customId,staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-yellow-600 bg-yellow-50 border border-yellow-200 rounded-md hover:bg-yellow-100 hover:border-yellow-300 transition-colors duration-200",on:{click:function(e){return t.handleButtonAction(a,t.currentTask)}}},[e("i",{staticClass:"el-icon-zoom-out mr-2"}),e("span",[t._v(t._s(a.label))])])})):t._e(),t.currentTask&&t.currentTask.buttons&&t.currentTask.buttons.some((t=>t.customId.includes("pan")))?t._l(t.currentTask.buttons.filter((t=>t.customId.includes("pan"))),(function(a){return e("button",{key:a.customId,staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 hover:border-gray-300 transition-colors duration-200",on:{click:function(e){return t.handleButtonAction(a,t.currentTask)}}},[e("span",[t._v(t._s(a.emoji))]),e("span",{staticClass:"ml-2"},[t._v(t._s(a.label))])])})):t._e(),t.currentTask&&t.currentTask.buttons&&t.currentTask.buttons.some((t=>t.customId.includes("BOOKMARK")))?t._l(t.currentTask.buttons.filter((t=>t.customId.includes("BOOKMARK"))),(function(a){return e("button",{key:a.customId,staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-red-600 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 hover:border-red-300 transition-colors duration-200",on:{click:function(e){return t.handleButtonAction(a,t.currentTask)}}},[e("span",[t._v(t._s(a.emoji))]),e("span",{staticClass:"ml-2"},[t._v(t._s(a.label))])])})):t._e(),t.currentTask&&t.currentTask.imageUrl?e("button",{staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-green-600 bg-green-50 border border-green-200 rounded-md hover:bg-green-100 hover:border-green-300 transition-colors duration-200",on:{click:function(e){return t.downloadImage(t.currentTask.imageUrl)}}},[e("i",{staticClass:"el-icon-download mr-2"}),e("span",[t._v("下载")])]):t._e(),t.currentTask&&t.canCancel(t.currentTask.status)?e("button",{staticClass:"flex items-center justify-center w-full h-9 px-3 text-sm font-medium text-red-600 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 hover:border-red-300 transition-colors duration-200",on:{click:function(e){return t.handleCancel(t.currentTask)}}},[e("i",{staticClass:"el-icon-close mr-2"}),e("span",[t._v("取消")])]):t._e()],2)])])])])])]):e("div",{staticClass:"bg-white/80 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl shadow-lg min-h-[calc(100vh-4rem)] flex flex-col"},[e("div",{staticClass:"flex items-center justify-between px-4 sm:px-8 py-4 sm:py-5 border-b border-gray-200/50 dark:border-gray-700/50"},[e("span",{staticClass:"text-lg sm:text-xl font-semibold text-gray-800 dark:text-gray-200"},[t._v("任务队列 ("+t._s(t.taskQueue.length)+")")]),e("el-button",{staticClass:"text-gray-600/90 hover:text-blue-500 dark:text-gray-400/90 dark:hover:text-blue-400 transition-colors duration-300",attrs:{type:"text",icon:"el-icon-refresh",loading:t.queueLoading},on:{click:t.fetchTaskQueue}},[t._v(" 刷新 ")])],1),e("div",{staticClass:"flex-1 flex flex-col overflow-hidden"},[e("div",{staticClass:"block sm:hidden flex-1 overflow-y-auto custom-scrollbar px-4 py-2"},t._l(t.taskQueue,(function(a){return e("div",{key:a.id,staticClass:"mb-4 p-4 bg-white dark:bg-gray-700 rounded-lg shadow-sm",on:{click:function(e){return t.handleRowClick(a)}}},[e("div",{staticClass:"flex items-center justify-between mb-2"},[e("el-tag",{attrs:{size:"small",type:"info"}},[t._v(t._s(t.getActionText(a.action)))]),"FAILURE"===a.status?e("el-tooltip",{attrs:{content:a.failReason||"未知错误",placement:"top"}},[e("el-tag",{attrs:{type:t.getStatusType(a.status)}},[t._v(t._s(t.getStatusText(a.status)))])],1):e("el-tag",{attrs:{type:t.getStatusType(a.status)}},[t._v(t._s(t.getStatusText(a.status)))])],1),e("div",{staticClass:"text-sm text-gray-700 dark:text-gray-300 mb-2 line-clamp-2"},[t._v(t._s(a.prompt))]),e("div",{staticClass:"text-xs text-gray-500 dark:text-gray-400 mb-2"},[t._v(t._s(t.formatTime(a.displays.submitTime)))]),e("el-progress",{attrs:{percentage:t.getProgressPercentage(a.progress),status:t.getProgressStatus(a.status)}})],1)})),0),e("div",{staticClass:"hidden sm:block flex-1 overflow-y-auto custom-scrollbar"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.queueLoading,expression:"queueLoading"}],staticClass:"w-full custom-table",attrs:{data:t.taskQueue,height:"calc(100vh - 16rem)","element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading"},on:{"row-click":t.handleRowClick}},[e("el-table-column",{attrs:{prop:"prompt",label:"提示词","min-width":"180",align:"left","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"action",label:"类型","min-width":"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{size:"small",type:"info"}},[t._v(" "+t._s(t.getActionText(a.row.action))+" ")])]}}],null,!1,561425344)}),e("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return["FAILURE"===a.row.status?e("el-tooltip",{attrs:{content:a.row.failReason||"未知错误",placement:"top"}},[e("el-tag",{attrs:{type:t.getStatusType(a.row.status)}},[t._v(" "+t._s(t.getStatusText(a.row.status))+" ")])],1):e("el-tag",{attrs:{type:t.getStatusType(a.row.status)}},[t._v(" "+t._s(t.getStatusText(a.row.status))+" ")])]}}],null,!1,286174912)}),e("el-table-column",{attrs:{label:"提交时间","min-width":"160",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tooltip",{attrs:{content:a.row.displays.submitTime,placement:"top"}},[e("span",[t._v(t._s(t.formatTime(a.row.displays.submitTime)))])])]}}],null,!1,379863814)}),e("el-table-column",{attrs:{label:"进度",width:"220",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-progress",{attrs:{percentage:t.getProgressPercentage(a.row.progress),status:t.getProgressStatus(a.row.status)}})]}}],null,!1,3678436751)})],1)],1),e("div",{staticClass:"flex justify-center p-4 border-t border-gray-100 dark:border-gray-700"},[e("el-pagination",{staticClass:"flex items-center",attrs:{"current-page":t.pagination.current,"page-sizes":[10,20,30],"page-size":t.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handlePageChange}})],1)])])])])]),!t.isMobile&&t.drawingResults.length>0?e("div",{staticClass:"pc-view"},[e("el-card",{staticClass:"result-card"},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v("绘图结果")])]),e("el-row",{attrs:{gutter:20}},t._l(t.drawingResults,(function(a,s){return e("el-col",{key:s,staticClass:"result-col",attrs:{xs:24,sm:12,md:8,lg:6}},[e("el-card",{staticClass:"image-card",attrs:{shadow:"hover"}},[e("el-image",{staticClass:"result-image",attrs:{src:a.imageUrl,fit:"contain"}},[e("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]),e("div",{staticClass:"image-actions"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.downloadImage(a.imageUrl)}}},[e("i",{staticClass:"el-icon-download"}),t._v(" 下载 ")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.variateImage(a.imageUrl,a.taskId)}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 变体 ")])],1),e("div",{staticClass:"prompt-text"},[t._v(t._s(a.prompt))])],1)],1)})),1)],1)],1):t._e(),t.isMobile&&t.drawingResults.length>0?e("div",{staticClass:"mobile-view"},t._l(t.drawingResults,(function(a,s){return e("div",{key:s,staticClass:"mobile-card"},[e("div",{staticClass:"mobile-card-content"},[e("el-image",{staticClass:"mobile-image",attrs:{src:a.imageUrl,fit:"contain"}},[e("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]),e("div",{staticClass:"prompt-badge"},[e("i",{staticClass:"el-icon-chat-line-square"}),t._v(" "+t._s(a.prompt)+" ")])],1),e("div",{staticClass:"mobile-card-divider"}),e("div",{staticClass:"mobile-card-actions"},[e("div",{staticClass:"action-row"},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.downloadImage(a.imageUrl)}}},[e("i",{staticClass:"el-icon-download"}),t._v(" 下载 ")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){return t.variateImage(a.imageUrl,a.taskId)}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 变体 ")])],1)])])})),0):t._e(),t.isMobile?e("el-backtop",{staticClass:"mobile-backtop",attrs:{right:16,bottom:16,target:".el-main"}},[e("i",{staticClass:"el-icon-arrow-up"})]):t._e(),e("el-drawer",{attrs:{title:"高级设置",visible:t.showAdvancedSettings,direction:"rtl",size:t.isMobile?"75%":"400px","modal-append-to-body":!1,wrapperClosable:!0,modal:!0,"custom-class":"advanced-settings-drawer dark:bg-gray-800"},on:{"update:visible":function(e){t.showAdvancedSettings=e}}},[e("div",{staticClass:"flex flex-col h-full"},[e("div",{staticClass:"flex-1 overflow-y-auto p-4 md:p-6"},[e("div",{staticClass:"space-y-6 md:space-y-8"},[e("div",{staticClass:"settings-group"},[e("div",{staticClass:"flex items-center space-x-2 mb-3 md:mb-4"},[e("i",{staticClass:"el-icon-setting text-base md:text-lg text-emerald-600"}),e("span",{staticClass:"text-sm md:text-base font-medium"},[t._v("基础设置")])]),e("el-form",{staticClass:"space-y-3 md:space-y-4",attrs:{model:t.formData,"label-position":"top","label-width":"auto"}},[e("el-form-item",{staticClass:"w-full",attrs:{label:"版本选择"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"选择版本"},model:{value:t.formData.version,callback:function(e){t.$set(t.formData,"version",e)},expression:"formData.version"}},[e("el-option",{attrs:{label:"MJ V6.1",value:"--v 6.1"}}),e("el-option",{attrs:{label:"MJ V6",value:"--v 6"}}),e("el-option",{attrs:{label:"MJ V5.2",value:"--v 5.2"}}),e("el-option",{attrs:{label:"MJ V5.1",value:"--v 5.1"}})],1)],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"文本权重"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"设置文本权重"},model:{value:t.formData.imageWeight,callback:function(e){t.$set(t.formData,"imageWeight",e)},expression:"formData.imageWeight"}},[e("el-option",{attrs:{label:"默认(0.25)",value:""}}),e("el-option",{attrs:{label:"0.5",value:"--iw 0.5"}}),e("el-option",{attrs:{label:"1.0",value:"--iw 1"}}),e("el-option",{attrs:{label:"2.0",value:"--iw 2"}})],1)],1)],1)],1),e("div",{staticClass:"settings-group"},[e("div",{staticClass:"flex items-center space-x-2 mb-3 md:mb-4"},[e("i",{staticClass:"el-icon-magic-stick text-base md:text-lg text-emerald-600"}),e("span",{staticClass:"text-sm md:text-base font-medium"},[t._v("高级设置")])]),e("el-form",{staticClass:"space-y-3 md:space-y-4",attrs:{model:t.formData,"label-position":"top","label-width":"auto"}},[e("el-form-item",{staticClass:"w-full",attrs:{label:"视角"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"选择视角"},model:{value:t.formData.perspective,callback:function(e){t.$set(t.formData,"perspective",e)},expression:"formData.perspective"}},[e("el-option",{attrs:{label:"默认",value:""}}),e("el-option",{attrs:{label:"第一人称视角",value:"first person"}}),e("el-option",{attrs:{label:"第三人称视角",value:"third person"}}),e("el-option",{attrs:{label:"俯视角",value:"top view"}}),e("el-option",{attrs:{label:"仰视角",value:"bottom view"}}),e("el-option",{attrs:{label:"侧视角",value:"side view"}}),e("el-option",{attrs:{label:"远景",value:"long shot"}}),e("el-option",{attrs:{label:"近景",value:"close-up"}})],1)],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"人物镜头"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"选择人物镜头"},model:{value:t.formData.shot,callback:function(e){t.$set(t.formData,"shot",e)},expression:"formData.shot"}},[e("el-option",{attrs:{label:"默认",value:""}}),e("el-option",{attrs:{label:"全身镜头",value:"full body"}}),e("el-option",{attrs:{label:"半身镜头",value:"half body"}}),e("el-option",{attrs:{label:"特写镜头",value:"close-up shot"}}),e("el-option",{attrs:{label:"超近特写",value:"extreme close-up"}}),e("el-option",{attrs:{label:"全景镜头",value:"wide shot"}})],1)],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"灯光"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"选择灯光效果"},model:{value:t.formData.lighting,callback:function(e){t.$set(t.formData,"lighting",e)},expression:"formData.lighting"}},[e("el-option",{attrs:{label:"默认",value:""}}),e("el-option",{attrs:{label:"自然光",value:"natural light"}}),e("el-option",{attrs:{label:"柔和光",value:"soft light"}}),e("el-option",{attrs:{label:"强光",value:"hard light"}}),e("el-option",{attrs:{label:"逆光",value:"backlight"}}),e("el-option",{attrs:{label:"环境光",value:"ambient light"}}),e("el-option",{attrs:{label:"聚光灯",value:"spotlight"}}),e("el-option",{attrs:{label:"霓虹灯",value:"neon light"}}),e("el-option",{attrs:{label:"电影灯光",value:"cinematic light"}})],1)],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"随机种子"}},[e("el-input-number",{staticClass:"w-full",attrs:{min:0,max:4294967295,placeholder:"输入随机种子"},model:{value:t.formData.seed,callback:function(e){t.$set(t.formData,"seed",e)},expression:"formData.seed"}})],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"渲染质量"}},[e("el-select",{staticClass:"w-full",attrs:{placeholder:"选择渲染质量"},model:{value:t.formData.quality,callback:function(e){t.$set(t.formData,"quality",e)},expression:"formData.quality"}},[e("el-option",{attrs:{label:"默认(1.0)",value:""}}),e("el-option",{attrs:{label:"0.25",value:"--quality 0.25"}}),e("el-option",{attrs:{label:"0.5",value:"--quality 0.5"}}),e("el-option",{attrs:{label:"2.0",value:"--quality 2"}})],1)],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"风格强度"}},[e("el-slider",{attrs:{min:0,max:1e3,step:10},model:{value:t.formData.stylize,callback:function(e){t.$set(t.formData,"stylize",e)},expression:"formData.stylize"}})],1),e("el-form-item",{staticClass:"w-full",attrs:{label:"多样性"}},[e("el-slider",{attrs:{min:0,max:100},model:{value:t.formData.chaos,callback:function(e){t.$set(t.formData,"chaos",e)},expression:"formData.chaos"}})],1)],1)],1),e("div",{staticClass:"settings-group"},[e("div",{staticClass:"flex items-center space-x-2 mb-3 md:mb-4"},[e("i",{staticClass:"el-icon-star-off text-base md:text-lg text-emerald-600"}),e("span",{staticClass:"text-sm md:text-base font-medium"},[t._v("特殊选项")])]),e("el-form",{attrs:{model:t.formData,"label-position":"top","label-width":"auto"}},[e("el-form-item",[e("el-checkbox-group",{staticClass:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",model:{value:t.formData.specialOptions,callback:function(e){t.$set(t.formData,"specialOptions",e)},expression:"formData.specialOptions"}},[e("el-checkbox",{staticClass:"!mr-0",attrs:{label:"--sameseed"}},[t._v("使用相同种子")]),e("el-checkbox",{staticClass:"!mr-0",attrs:{label:"--upbeta"}},[t._v("Beta放大工具")]),e("el-checkbox",{staticClass:"!mr-0",attrs:{label:"--uplight"}},[t._v("轻量化处理")]),e("el-checkbox",{staticClass:"!mr-0",attrs:{label:"--niji"}},[t._v("动漫风格")])],1)],1)],1)],1)])]),e("div",{staticClass:"flex-shrink-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-3 md:p-4"},[e("div",{staticClass:"flex items-center justify-between"},[e("span",{staticClass:"text-xs md:text-sm text-gray-500 dark:text-gray-400"},[t._v("设置将在下次绘图时生效")]),e("div",{staticClass:"space-x-2"},[e("el-button",{attrs:{size:"mini","md:size":"small"},on:{click:t.clearAdvancedSettings}},[t._v(" 重置设置 ")]),e("el-button",{attrs:{size:"mini","md:size":"small",type:"primary"},on:{click:function(e){t.showAdvancedSettings=!1}}},[t._v(" 确定 ")])],1)])])])])],1)],1)},de=[],ue={name:"DrawPage",data(){return{loading:!1,permissionLoading:!1,isMobile:!1,hasPermission:!1,expandedRows:[],formData:{prompt:"",bot_type:"MID_JOURNEY",state:"midjourney-proxy-admin",speed:"FAST",aspectRatio:"",imageWeight:"",version:"--v 6.1",seed:"",quality:"",stylize:0,chaos:0,specialOptions:[],perspective:"",shot:"",lighting:""},rules:{prompt:[{required:!0,message:"请输入提示词",trigger:"blur"}],model:[{required:!0,message:"请选择模型",trigger:"change"}]},modelOptions:[{value:"MJ_V6",text:"MJ V6"},{value:"MJ_V5.2",text:"MJ V5.2"}],speedOptions:[{value:"FAST",text:"快速"},{value:"RELAX",text:"标准"}],drawingResults:[],taskId:null,checkInterval:null,taskQueue:[],queueLoading:!1,queueTimer:null,activeCollapse:["queue"],mjApiSecret:null,showViewer:!1,previewUrl:"",pagination:{current:1,pageSize:10,total:0},showAdvancedSettings:!1,showImageEditor:!1,selectedTool:"rectangle",editPrompt:"",isDrawing:!1,startX:0,startY:0,currentTask:null,maskBase64:"",originalImage:null,selectionRect:{x:0,y:0,width:0,height:0},finalSelectionRect:null,imageList:[],base64Array:[],presetStyles:[{name:"写实风格",description:"注重细节的写实效果",params:{stylize:100,quality:"--quality 1",specialOptions:["--niji"],aspectRatio:"--ar 1:1"}},{name:"动漫风格",description:"日式动漫插画风格",params:{stylize:100,quality:"--quality 1",specialOptions:["--niji"],aspectRatio:"--ar 1:1"}},{name:"油画风格",description:"古典油画艺术效果",params:{stylize:250,quality:"--quality 1",specialOptions:[],aspectRatio:"--ar 4:3"}},{name:"水彩风格",description:"柔和的水彩画效果",params:{stylize:200,quality:"--quality 1",specialOptions:[],aspectRatio:"--ar 4:3"}},{name:"概念艺术",description:"现代概念设计风格",params:{stylize:150,quality:"--quality 1",specialOptions:[],aspectRatio:"--ar 16:9"}},{name:"赛博朋克",description:"未来科技感风格",params:{stylize:300,quality:"--quality 1",specialOptions:[],aspectRatio:"--ar 16:9"}},{name:"极简风格",description:"简约现代设计风格",params:{stylize:50,quality:"--quality 1",specialOptions:[],aspectRatio:"--ar 1:1"}},{name:"复古风格",description:"怀旧复古效果",params:{stylize:200,quality:"--quality 0.5",specialOptions:[],aspectRatio:"--ar 4:3"}},{name:"高清头像-写实",description:"适合制作写实风格的高清头像",params:{stylize:100,quality:"--quality 2",specialOptions:[],aspectRatio:"--ar 1:1"}},{name:"高清头像-动漫",description:"适合制作动漫风格的高清头像",params:{stylize:100,quality:"--quality 2",specialOptions:["--niji"],aspectRatio:"--ar 1:1"}},{name:"高清头像-艺术",description:"适合制作艺术风格的高清头像",params:{stylize:200,quality:"--quality 2",specialOptions:[],aspectRatio:"--ar 1:1"}},{name:"手机壁纸-写实",description:"适合制作写实风格的手机壁纸",params:{stylize:100,quality:"--quality 2",specialOptions:[],aspectRatio:"--ar 9:16"}},{name:"手机壁纸-动漫",description:"适合制作动漫风格的手机壁纸",params:{stylize:100,quality:"--quality 2",specialOptions:["--niji"],aspectRatio:"--ar 9:16"}},{name:"手机壁纸-艺术",description:"适合制作艺术风格的手机壁纸",params:{stylize:200,quality:"--quality 2",specialOptions:[],aspectRatio:"--ar 9:16"}},{name:"电脑壁纸-写实",description:"适合制作写实风格的电脑壁纸",params:{stylize:100,quality:"--quality 2",specialOptions:[],aspectRatio:"--ar 16:9"}},{name:"电脑壁纸-动漫",description:"适合制作动漫风格的电脑壁纸",params:{stylize:100,quality:"--quality 2",specialOptions:["--niji"],aspectRatio:"--ar 16:9"}},{name:"电脑壁纸-艺术",description:"适合制作艺术风格的电脑壁纸",params:{stylize:200,quality:"--quality 2",specialOptions:[],aspectRatio:"--ar 16:9"}}],selectedStyle:null,showImageDetail:!1}},methods:{checkMobile(){this.isMobile=window.innerWidth<=768},async getUserInfo(){try{const e=await I.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(e.data.status){this.permissionLoading=!0,this.mjApiSecret=e.data.data.apiKey;try{const t=await I.get(`${v.apiBaseUrl}/mj/users`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),a=e.data.data.username,s=t.data.data.list||[],i=s.find((t=>t.name===a)),r=i.status;"NORMAL"===r?(this.hasPermission=!0,await this.fetchTaskQueue()):(k.error("您没有AI绘图的权限"),this.hasPermission=!1)}catch(t){console.log("AI绘图块权限验证失败:",t),this.hasPermission=!1}finally{this.permissionLoading=!1}}else k.error("获取用户信息失败")}catch(t){console.error("获取用户信息失败:",t),k.handleError(t)}},async fetchTaskQueue(){if(!this.queueLoading){this.queueLoading=!0;try{const t=await I.get(`${v.apiBaseUrl}/mj/tasks?page=`+this.pagination.current+"&size="+this.pagination.pageSize,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});200===t.status&&t.data.data.list?(this.taskQueue=t.data.data.list.map((t=>({...t,displays:t.displays||{submitTime:new Date(t.submitTime).toLocaleString(),finishTime:t.finishTime?new Date(t.finishTime).toLocaleString():"",status:t.status,action:t.action}}))),this.pagination.total=t.data.data.pagination.total):(console.error("任务列表数据格式不正确:",t.data.data),k.error("获取任务队列失败"))}catch(t){console.error("获取任务列表失败:",t),k.handleError(t)}finally{this.queueLoading=!1}}},startQueueTimer(){this.stopQueueTimer();let t=0;const e=7;this.queueTimer=setInterval((async()=>{t++,await this.fetchTaskQueue();const a=this.taskQueue.some((t=>!["SUCCESS","FAILURE","CANCEL"].includes(t.status)));(t>=e||!a)&&(this.stopQueueTimer(),console.log("停止轮询：",t>=e?"达到最大刷新次数":"所有任务已完成"))}),5e3)},stopQueueTimer(){this.queueTimer&&(clearInterval(this.queueTimer),this.queueTimer=null)},getStatusType(t){const e={NOT_START:"info",SUBMITTED:"info",IN_PROGRESS:"warning",SUCCESS:"success",FAILURE:"danger",MODAL:"warning",CANCEL:"info"};return e[t]||"info"},getStatusText(t){const e={NOT_START:"未开始",SUBMITTED:"已提交",IN_PROGRESS:"进行中",SUCCESS:"已完成",FAILURE:"失败",MODAL:"等待中",CANCEL:"取消"};return e[t]||t},getProgressStatus(t){return"SUCCESS"===t?"success":"FAILURE"===t?"exception":"CANCEL"===t?"warning":""},getProgressPercentage(t){if(!t)return 0;const e=t.match(/(\d+)%/);return e?parseInt(e[1]):0},canCancel(t){return["NOT_START","SUBMITTED","IN_PROGRESS","MODAL"].includes(t)},async cancelTask(t){try{const e=await I.post(`${v.mjBaseUrl}/mj/task/${t}/cancel`,null,{headers:{"mj-api-secret":this.mjApiSecret}});if(200===e.status){const a=e.data;if("CANCEL"===a.status){k.success("任务已取消");const e=this.taskQueue.findIndex((e=>e.id===t));-1!==e&&(this.taskQueue[e]={...this.taskQueue[e],...a,displays:{...this.taskQueue[e].displays,status:a.status}})}else k.warning(`取消失败: ${a.failReason||"未知原因"}`);await this.fetchTaskQueue()}else k.error("取消任务失败：返回数据为空")}catch(e){console.error("取消任务失败:",e),k.handleError(e)}},async submitDrawing(){try{const t=await this.$refs.form.validate();if(!t)return;this.loading=!0;let e="";const a=[this.formData.perspective,this.formData.shot,this.formData.lighting].filter((t=>t)).join(", ");e=a?a+", "+this.formData.prompt:this.formData.prompt,this.formData.aspectRatio&&(e+=" "+this.formData.aspectRatio),this.formData.imageWeight&&(e+=" "+this.formData.imageWeight),this.formData.version&&(e+=" "+this.formData.version),this.formData.seed&&(e+=` --seed ${this.formData.seed}`),this.formData.quality&&(e+=" "+this.formData.quality),this.formData.stylize>0&&(e+=` --stylize ${this.formData.stylize}`),this.formData.chaos>0&&(e+=` --chaos ${this.formData.chaos}`),this.formData.specialOptions.forEach((t=>{e+=" "+t}));const s={prompt:e,bot_type:"MID_JOURNEY",state:"midjourney-proxy-admin",base64Array:this.base64Array,accountFilter:{}},i=await I.post(`${v.mjBaseUrl}/mj/submit/imagine`,s,{headers:{Accept:"application/json, text/plain, */*","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36","Sec-Ch-Ua":'"Google Chrome";v="131", "Chromium";v="131", "Not_A Brand";v="24"',"sec-ch-ua-mobile":"?0",Dnt:"1","sec-ch-ua-platform":'"macOS"',"mj-api-secret":this.mjApiSecret,"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},withCredentials:!0});i.data&&1===i.data.code?(this.taskId=i.data.result,k.success(i.data.description||"提交成功，正在生成..."),await this.fetchTaskQueue(),this.startQueueTimer()):k.error(i.data?.description||"提交失败")}catch(t){k.handleError(t)}finally{this.loading=!1}},async checkProgress(){if(this.taskId)try{const t=await I.get(`${v.mjBaseUrl}/mj/task/fetch/${this.taskId}`,{headers:{"mj-api-secret":this.mjApiSecret}});if(t.data){const e=t.data;"SUCCESS"===e.status?(this.drawingResults.unshift({imageUrl:e.imageUrl,prompt:e.prompt,taskId:this.taskId}),this.stopCheckingProgress(),k.success("生成完成"),await this.fetchTaskQueue()):"FAILURE"===e.status&&(this.stopCheckingProgress(),k.error(e.failReason||"生成失败"))}}catch(t){console.error("检查进度失败:",t)}},startCheckingProgress(){this.checkInterval=setInterval(this.checkProgress,3e3)},stopCheckingProgress(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)},async downloadImage(t){try{window.open(t,"_blank")}catch(e){console.error("打开图片失败:",e),k.error("打开失败")}},async variateImage(t,e){try{this.loading=!0;const t=await I.post(`${v.mjBaseUrl}/mj/submit/change`,{taskId:e,action:"VARIATION",index:1,notifyHook:"",state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});t.data&&t.data.id?(this.taskId=t.data.id,k.success("变体生成已提交"),this.startCheckingProgress(),await this.fetchTaskQueue(),this.startQueueTimer()):k.error(t.data?.failReason||"提交失败")}catch(a){k.handleError(a)}finally{this.loading=!1}},getActionText(t){const e={IMAGINE:"绘图",UPSCALE:"放大",VARIATION:"变体",REROLL:"重绘"};return e[t]||t},previewImage(t){this.$alert(`<div style="text-align: center">\n                    <img src="${t.imageUrl}" style="max-width: 100%; max-height: 500px;">\n                    <p style="margin-top: 10px">${t.prompt||""}</p>\n                    <p style="margin-top: 5px; color: #666;">提交时间：${t.displays?.submitTime||""}</p>\n                    <p style="margin-top: 5px; color: #666;">完成时间：${t.displays?.finishTime||""}</p>\n                </div>`,"图片预览",{dangerouslyUseHTMLString:!0,customClass:"image-preview-dialog",showClose:!0,callback:()=>{},beforeClose:(t,e,a)=>{a()}}).catch((t=>{"cancel"!==t&&"close"!==t&&console.error("预览对话框错误:",t)}))},handleRowClick(t){"🔒"!==t.userId?(this.currentTask=t,this.showImageDetail=!0):this.$message.warning("无权查看该任务详情")},getButtonIcon(t){const e={PREVIEW:"el-icon-view",DOWNLOAD:"el-icon-download",UPSCALE:"el-icon-zoom-in",VARIATION:"el-icon-refresh",REROLL:"el-icon-refresh-right",CANCEL:"el-icon-close",INPAINT:"el-icon-edit"};return e[t]||"el-icon-more"},async handleButtonAction(t,e){try{if(this.loading=!0,t.customId.includes("Inpaint")){try{const a=await I.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&21===a.data.code?(this.currentTask=e,this.editPrompt="",this.showImageEditor=!0,this.currentTask.modalTaskId=a.data.result,this.$nextTick((()=>{console.log("Initializing canvas with image:",e.imageUrl),this.initializeCanvas(e.imageUrl)}))):this.$message.error(a.data?.description||"操作失败")}catch(a){console.error("Inpaint action error:",a),this.$message.error("操作失败，请重试")}return}if(t.customId.includes("upsample")||t.customId.includes("reroll")||t.customId.includes("variation")||t.customId.includes("BOOKMARK")||t.customId.includes("Outpaint")){try{const a=await I.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&1===a.data.code?(this.$message.success("操作成功"),await this.fetchTaskQueue(),t.customId.includes("BOOKMARK")||this.startQueueTimer()):this.$message.error(a.data?.description||"操作失败")}catch(a){k.handleError(a)}return}if(t.customId.includes("pan")){try{const s=await I.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});if(s.data&&21===s.data.code){const i=t.customId.includes("pan_left")?"向左平移":t.customId.includes("pan_right")?"向右平移":t.customId.includes("pan_up")?"向上平移":"向下平移";this.$prompt(`请输入${i}的提示词`,"平移设置",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入提示词",inputValue:s.data.properties?.finalPrompt||e.prompt,inputValidator:t=>!(!t||""===t.trim())||"提示词不能为空"}).then((async({value:t})=>{try{const e=await I.post(`${v.mjBaseUrl}/mj/submit/modal`,{taskId:s.data.result,prompt:t},{headers:{"mj-api-secret":this.mjApiSecret}});e.data&&1===e.data.code?(k.success("平移操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):k.error(e.data?.description||"提交失败")}catch(a){k.handleError(a)}})).catch((()=>{}))}else s.data&&1===s.data.code?(this.taskId=s.data.result,k.success("平移操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):k.error(s.data?.description||"提交失败")}catch(a){k.handleError(a)}return}if(t.customId.includes("CustomZoom")){try{const s=await I.post(`${v.mjBaseUrl}/mj/submit/action`,{taskId:e.id,customId:t.customId,index:1,chooseSameChannel:!0,state:"midjourney-proxy-admin"},{headers:{"mj-api-secret":this.mjApiSecret}});if(s.data&&21===s.data.code){const e=t.customId.includes("CustomZoom")?"缩放":"";this.$prompt(`请输入${e}的提示词`,"设置",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入提示词",inputValue:"",inputValidator:t=>!(!t||""===t.trim())||"提示词不能为空"}).then((async({value:t})=>{try{const e=await I.post(`${v.mjBaseUrl}/mj/submit/modal`,{taskId:s.data.result,prompt:t},{headers:{"mj-api-secret":this.mjApiSecret}});e.data&&1===e.data.code?(k.success("操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):k.error(e.data?.description||"提交失败")}catch(a){k.handleError(a)}})).catch((()=>{}))}else s.data&&1===s.data.code?(this.taskId=s.data.result,k.success("平移操作已提交"),await this.fetchTaskQueue(),this.startQueueTimer()):k.error(s.data?.description||"提交失败")}catch(a){k.handleError(a)}return}}catch(a){console.error("Button action error:",a),this.$message.error("操作失败，请重试")}finally{this.loading=!1}},copyTaskId(t){const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),k.success("任务ID已复制")},formatTime(t){if(!t)return"";const e=new Date(t),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return`${a}-${s} ${i}:${r}`},handlePreviewImage(t){t&&(this.previewUrl=t,this.showViewer=!0)},closeViewer(){this.showViewer=!1,this.previewUrl=""},handlePageChange(t){this.pagination.current=t,this.fetchTaskQueue()},handleSizeChange(t){this.pagination.pageSize=t,this.pagination.current=1,this.fetchTaskQueue()},handleAdvancedSettingsClose(t){t()},clearAdvancedSettings(){this.formData.aspectRatio="",this.formData.imageWeight="",this.formData.version="--v 6.1",this.formData.seed="",this.formData.quality="",this.formData.stylize=0,this.formData.chaos=0,this.formData.specialOptions=[],this.formData.perspective="",this.formData.shot="",this.formData.lighting="",this.$message.success("已清空所有高级设置")},getRowClassName({row:t}){const e=[];return"🔒"===t.userId&&(e.push("locked-row"),e.push("hide-expand")),e.join(" ")},renderImageEditor(t,e){return t("div",{class:"image-editor-container"},[t("div",{class:"image-canvas-container"},[t("canvas",{ref:"imageCanvas",style:{maxWidth:"100%",border:"1px solid #ddd"},on:{mousedown:this.handleMouseDown,mousemove:this.handleMouseMove,mouseup:this.handleMouseUp,mouseleave:this.handleMouseUp},hook:{insert:t=>{const a=t.elm,s=a.getContext("2d"),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{a.width=i.width,a.height=i.height,s.drawImage(i,0,0),this.originalImage=i},i.src=e.imageUrl}}})]),t("el-input",{props:{type:"textarea",rows:3,placeholder:"请输入Prompt",value:this.editPrompt||e.prompt},on:{input:t=>this.editPrompt=t}})])},handleMouseDown(t){const e=this.$refs.imageCanvas,a=e.getBoundingClientRect(),s=e.width/a.width,i=e.height/a.height;this.isDrawing=!0,this.startX=(t.clientX-a.left)*s,this.startY=(t.clientY-a.top)*i,this.selectionRect={x:this.startX,y:this.startY,width:0,height:0}},handleMouseMove(t){if(!this.isDrawing||!this.originalImage)return;const e=this.$refs.imageCanvas,a=e.getBoundingClientRect(),s=e.width/a.width,i=e.height/a.height,r=(t.clientX-a.left)*s,o=(t.clientY-a.top)*i;this.selectionRect={x:Math.min(this.startX,r),y:Math.min(this.startY,o),width:Math.abs(r-this.startX),height:Math.abs(o-this.startY)},this.redrawCanvas()},handleMouseUp(){this.isDrawing=!1,this.finalSelectionRect={...this.selectionRect}},redrawCanvas(){const t=this.$refs.imageCanvas;if(!t||!this.originalImage)return;const e=t.getContext("2d");e.save(),e.clearRect(0,0,t.width,t.height),e.drawImage(this.originalImage,0,0,t.width,t.height),this.selectionRect.width>0&&this.selectionRect.height>0&&(e.strokeStyle="#9254de",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(this.selectionRect.x,this.selectionRect.y,this.selectionRect.width,this.selectionRect.height),e.setLineDash([]),this.drawControlPoints()),e.restore()},drawControlPoints(){const t=this.$refs.imageCanvas,e=t.getContext("2d"),a=6,s=[{x:this.selectionRect.x,y:this.selectionRect.y},{x:this.selectionRect.x+this.selectionRect.width,y:this.selectionRect.y},{x:this.selectionRect.x,y:this.selectionRect.y+this.selectionRect.height},{x:this.selectionRect.x+this.selectionRect.width,y:this.selectionRect.y+this.selectionRect.height}];e.fillStyle="#9254de",s.forEach((t=>{e.beginPath(),e.arc(t.x,t.y,a,0,2*Math.PI),e.fill()}))},resetEditor(){if(this.isDrawing=!1,this.startX=0,this.startY=0,this.selectionRect={x:0,y:0,width:0,height:0},this.finalSelectionRect=null,this.editPrompt="",this.maskBase64="",this.originalImage=null,this.$refs.imageCanvas){const t=this.$refs.imageCanvas.getContext("2d");t.clearRect(0,0,this.$refs.imageCanvas.width,this.$refs.imageCanvas.height)}},generateMask(t){try{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d");return a.fillStyle="black",a.fillRect(0,0,e.width,e.height),this.finalSelectionRect&&(a.fillStyle="white",a.fillRect(this.finalSelectionRect.x,this.finalSelectionRect.y,this.finalSelectionRect.width,this.finalSelectionRect.height)),e.toDataURL("image/png").split(",")[1]}catch(e){throw console.error("生成遮罩失败:",e),new Error("生成遮罩失败，请重试")}},handleEditorClose(){this.resetEditor(),this.showImageEditor=!1},async handleEditorConfirm(){try{if(!this.editPrompt.trim())return void this.$message.warning("请输入提示词");const t=this.$refs.imageCanvas,e=this.generateMask(t);this.maskBase64=e,this.loading=!0;const a=await I.post(`${v.mjBaseUrl}/mj/submit/modal`,{taskId:this.currentTask.modalTaskId,prompt:this.editPrompt,maskBase64:"data:image/png;base64,"+this.maskBase64},{headers:{"mj-api-secret":this.mjApiSecret}});a.data&&1===a.data.code?(this.$message.success("Inpaint 操作已提交"),this.showImageEditor=!1,this.$emit("editor-closed"),await this.fetchTaskQueue(),this.startQueueTimer()):this.$message.error(a.data?.description||"提交失败")}catch(t){console.error("Inpaint 提交失败:",t),this.$message.error(t.response?.data?.description||"提交失败，请重试")}finally{this.loading=!1,this.resetEditor()}},initializeCanvas(t){const e=this.$refs.imageCanvas;if(!e)return void console.error("Canvas element not found");const a=new Image;a.onload=()=>{const t=e.parentElement,s=t.clientWidth,i=t.clientHeight,r=s/a.width,o=i/a.height,l=Math.min(r,o);e.width=a.width,e.height=a.height;const n=e.getContext("2d");n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.clearRect(0,0,e.width,e.height),n.drawImage(a,0,0,e.width,e.height),this.originalImage=a,e.style.width=a.width*l+"px",e.style.height=a.height*l+"px",this.redrawCanvas(),console.log("Canvas initialized with dimensions:",{width:e.width,height:e.height,displayWidth:e.style.width,displayHeight:e.style.height,scale:l})},a.onerror=t=>{console.error("Error loading image:",t),this.$message.error("图片加载失败，请重试")},a.src=t},handleImageChange(t,e){this.imageList=e},handleImageRemove(t,e){this.imageList=e},triggerFileInput(){this.$refs.fileInput.click()},fileToBase64(t){return new Promise(((e,a)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>{e(s.result)},s.onerror=t=>a(t)}))},async handleFileChange(t){const e=t.target.files;for(const s of e)try{const t=await this.fileToBase64(s);this.base64Array.push(t),this.imageList.push({raw:s,url:URL.createObjectURL(s)})}catch(a){console.error("转换图片失败:",a),this.$message.error("图片处理失败")}t.target.value=""},async handleDrop(t){t.preventDefault();const e=t.dataTransfer.files;for(const s of e)try{const t=await this.fileToBase64(s);this.base64Array.push(t),this.imageList.push({raw:s,url:URL.createObjectURL(s)})}catch(a){console.error("转换图片失败:",a),this.$message.error("图片处理失败")}},removeImage(t){URL.revokeObjectURL(this.imageList[t].url),this.imageList.splice(t,1),this.base64Array.splice(t,1)},beforeDestroy(){this.imageList.forEach((t=>{URL.revokeObjectURL(t.url)})),this.base64Array=[],this.stopCheckingProgress(),window.removeEventListener("resize",this.checkMobile)},applyStyle(t){this.selectedStyle=t.name,this.formData.stylize=t.params.stylize,this.formData.quality=t.params.quality,this.formData.specialOptions=[...t.params.specialOptions],this.formData.aspectRatio=t.params.aspectRatio,this.$message({message:`已应用${t.name}的参数设置`,type:"success"})},handleStyleChange(t){if(!t)return this.formData.stylize=0,this.formData.quality="",this.formData.specialOptions=[],this.formData.aspectRatio="",void this.$message({message:"已重置风格参数",type:"info"});const e=this.presetStyles.find((e=>e.name===t));e&&(this.formData.stylize=e.params.stylize,this.formData.quality=e.params.quality,this.formData.specialOptions=[...e.params.specialOptions],this.formData.aspectRatio=e.params.aspectRatio,this.$message({message:`已应用${e.name}的参数设置`,type:"success"}))},copyPrompt(t){const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),k.success("提示词已复制")}},mounted(){this.checkMobile(),this.getUserInfo()},computed:{canExpand(){return t=>"🔒"!==t.userId}}},me=ue,he=(0,n.A)(me,ce,de,!1,null,"795964e9",null),pe=he.exports,ge={components:{EnhancedDialog:yt,FormInput:ut},name:"NaviPage",data(){return{mjApiSecret:null,isMenuVisible:!1,touchStartX:0,touchStartY:0,swipeWidth:30,isMobile:!1,avatar:"img/linuxdo.webp",activeMenu:"accountNav",currentComponent:Pt,modalVisible:!1,resetModalVisible:!1,itemData:"",modalTitle:"",isCollapse:!0,showDrawModule:!1,formFields:[{id:"code",label:"兑换码",type:"text",value:"",required:!0}],resetFormFields:[{id:"oldPassword",label:"旧密码",type:"password",value:"",required:!0},{id:"newPassword",label:"新密码",type:"password",value:"",required:!0},{id:"confirmPassword",label:"确认新密码",type:"password",value:"",required:!0}],resetFormData:{oldPassword:"",newPassword:"",confirmPassword:""},menuItems:[{index:"accountNav",icon:"el-icon-s-custom",title:"账号管理"},{index:"shareNav",icon:"el-icon-share",title:"分享管理"},{index:"redemptionNav",icon:"el-icon-shopping-cart-full",title:"兑换码"},{index:"carNav",icon:"el-icon-truck",title:"停车场"},{index:"drawNav",icon:"el-icon-picture-outline",title:"AI绘图",condition:"showDrawModule"},{index:"freeNav",icon:"el-icon-medal",title:"免费号池"}],dropdownItems:[{icon:"el-icon-key",title:"兑换码激活",action:this.showModal},{icon:"el-icon-refresh",title:"重置密码",action:this.showResetModal},{icon:"el-icon-switch-button",title:"退出登录",action:this.logout}]}},computed:{getSidebarWidth(){return this.isMobile?this.isCollapse?"0":"240px":this.isCollapse?"66px":"240px"},filteredMenuItems(){return this.menuItems.filter((t=>!t.condition||this[t.condition]))}},methods:{async getUserInfo(){try{const t=await I.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log(t.data.data.apiKey),t.data.status?this.mjApiSecret=t.data.data.apiKey:k.error("获取用户信息失败")}catch(t){console.error("获取用户信息失败:",t),k.handleError(t)}},toggleMenu(){this.isMenuVisible=!this.isMenuVisible},handleClickOutside(t){const e=document.querySelector(".user-menu-container");e&&!e.contains(t.target)&&(this.isMenuVisible=!1)},checkMobile(){this.isMobile=window.innerWidth<=768,this.isMobile&&(this.isCollapse=!0)},toggleCollapse(){this.isCollapse=!this.isCollapse},loadAvatar(){const t=localStorage.getItem("img");t&&(this.avatar=t)},handleUpdateValue(t,e){this.itemData=e;const a=this.formFields.findIndex((e=>e.id===t));-1!==a&&(this.formFields[a].value=e)},handleResetUpdateValue(t,e){this.resetFormData[t]=e;const a=this.resetFormFields.findIndex((e=>e.id===t));-1!==a&&(this.resetFormFields[a].value=e)},showModal(){this.modalTitle="兑换码激活",this.resetFormField(),this.modalVisible=!0},showResetModal(){this.resetModalVisible=!0},closeModal(){this.modalVisible=!1},closeResetModal(){this.resetModalVisible=!1,this.resetFormData={oldPassword:"",newPassword:"",confirmPassword:""}},async submitForm(){const t=await I.get(`${v.apiBaseUrl}/redemption/activate?code=`+this.itemData,{withCredentials:!0,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?(this.modalVisible=!1,k.success("兑换成功")):k.error(t.data.message)},async submitResetForm(){try{if(this.resetFormData.newPassword!==this.resetFormData.confirmPassword)return void k.error("两次输入的新密码不一致");const t=await I.post(`${v.apiBaseUrl}/user/reset`,{oldPassword:this.resetFormData.oldPassword,newPassword:this.resetFormData.newPassword,confirmPassword:this.resetFormData.confirmPassword},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});t.data.status?(k.success("密码重置成功"),this.closeResetModal()):k.error(t.data.message),this.resetFormData={oldPassword:"",newPassword:"",confirmPassword:""}}catch(t){k.error("密码重置失败")}},resetFormField(){this.formData={},this.formFields.forEach((t=>{const e="checkbox"!==t.type&&"";t.value=e,this.formData[t.id]=e}))},handleMenuSelect(t){switch(this.activeMenu=t,this.isMobile&&(this.isCollapse=!0),this.activeMenu=t,t){case"accountNav":this.currentComponent=Pt;break;case"shareNav":this.currentComponent=qt;break;case"redemptionNav":this.currentComponent=ee;break;case"carNav":this.currentComponent=ne;break;case"freeNav":this.currentComponent=Kt;break;case"drawNav":this.showDrawModule?this.currentComponent=pe:k.error("您没有AI绘图模块的访问权限");break;default:this.currentComponent=qt}},logout(){this.$router.replace({name:"home"}),localStorage.removeItem("token"),localStorage.removeItem("img")},async checkUserPermission(){try{const e=await I.get(`${v.apiBaseUrl}/user/info`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.data.status)return k.error("获取用户信息失败"),void this.$router.replace({name:"home"});this.mjApiSecret=e.data.data.apiKey;try{const t=await I.get(`${v.apiBaseUrl}/mj/users`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),a=e.data.data.username;console.log(a);const s=t.data.data.list||[],i=s.find((t=>t.name===a));console.log(i);const r=i.status;if("DISABLED"===r)return void(this.showDrawModule=!1);this.showDrawModule=200===t.status}catch(t){console.log("AI绘图模块权限验证失败:",t),this.showDrawModule=!1}}catch(t){console.error("获取用户信息失败:",t),k.error("获取用户信息失败")}}},created(){this.loadAvatar(),ie.$on("envVariableChanged",(t=>{switch(t){case"jump":this.currentComponent=Kt;break;case"car":this.currentComponent=ne;break}})),this.checkMobile(),window.addEventListener("resize",this.checkMobile),"undefined"!==typeof document&&(document.addEventListener("touchstart",this.handleTouchStart),document.addEventListener("touchend",this.handleTouchEnd))},destroyed(){window.removeEventListener("resize",this.checkMobile),"undefined"!==typeof document&&(document.removeEventListener("touchstart",this.handleTouchStart),document.removeEventListener("touchend",this.handleTouchEnd))},mounted(){this.checkUserPermission(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)}},fe=ge,ye=(0,n.A)(fe,it,rt,!1,null,"0c547952",null),be=ye.exports;s["default"].use(u.Ay);const ve=[{path:"/",component:Q,name:"home",meta:{title:"首页"}},{path:"/account",component:Pt,name:"account",meta:{title:"账号管理"}},{path:"/share",component:qt,name:"share",meta:{title:"分享管理"}},{path:"/redemption",component:ee,name:"redemption",meta:{title:"兑换码"}},{path:"/car",component:ne,name:"car",meta:{title:"停车场"}},{path:"/jump",component:Kt,name:"jump",meta:{title:"秋名山"}},{path:"/reset",component:X,name:"reset",meta:{title:"重置密码"}},{path:"/pandora",component:j,name:"pandora",meta:{title:"Pandora"}},{path:"/loading",component:st,name:"loading",meta:{title:"Loading"}},{path:"/claude",component:F,name:"claude",meta:{title:"Fuclaude"}},{path:"/navi",component:be,name:"navi",meta:{title:"Helper"}},{path:"/draw",component:pe,name:"draw",meta:{title:"AI绘图"}}],xe=new u.Ay({mode:"history",routes:ve});function we(t){let e=document.querySelector("link[rel~='icon']");e||(e=document.createElement("link"),e.rel="icon",document.getElementsByTagName("head")[0].appendChild(e)),e.href=t,e.type="iamge/svg+xml"}xe.beforeEach(((t,e,a)=>{t.meta.title?(document.title=t.meta.title,we("favicon.svg")):document.title="Pandora",a()}));var Ce=xe;s["default"].use(w()),s["default"].config.productionTip=!1;const ke={install(t){t.prototype.$config=v}};async function _e(){await b(),new s["default"]({render:t=>t(d),router:Ce}).$mount("#app")}s["default"].use(ke),_e()},4832:function(t,e,a){t.exports=a.p+"img/linuxdo.7bff183f.webp"}},e={};function a(s){var i=e[s];if(void 0!==i)return i.exports;var r=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=t,function(){a.amdO={}}(),function(){var t=[];a.O=function(e,s,i,r){if(!s){var o=1/0;for(d=0;d<t.length;d++){s=t[d][0],i=t[d][1],r=t[d][2];for(var l=!0,n=0;n<s.length;n++)(!1&r||o>=r)&&Object.keys(a.O).every((function(t){return a.O[t](s[n])}))?s.splice(n--,1):(l=!1,r<o&&(o=r));if(l){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[s,i,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){a.p="/"}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,r,o=s[0],l=s[1],n=s[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(n)var d=n(a)}for(e&&e(s);c<o.length;c++)r=o[c],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(d)},s=self["webpackChunkpandora_helper"]=self["webpackChunkpandora_helper"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(1073)}));s=a.O(s)})();
//# sourceMappingURL=app.3ea34360.js.map